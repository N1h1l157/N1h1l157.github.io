{
    "version": "https://jsonfeed.org/version/1",
    "title": "X_T • All posts by \"树莓派\" tag",
    "description": "人生如逆旅，我亦是行人",
    "home_page_url": "http://www.n1h1l157.live",
    "items": [
        {
            "id": "http://www.n1h1l157.live/2023/07/31/SAFE/%E6%A0%91%E8%8E%93%E6%B4%BE%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE/",
            "url": "http://www.n1h1l157.live/2023/07/31/SAFE/%E6%A0%91%E8%8E%93%E6%B4%BE%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE/",
            "title": "树莓派烧录系统及配置",
            "date_published": "2023-07-30T16:00:00.000Z",
            "content_html": "<p>本文包括树莓派烧录系统镜像，ssh 免密登录，frp 内网穿透，设置多个密码，移除 ssh 日志等操作。注意不需要网线、键鼠、显示器等。</p>\n<h3 id=\"准备工具\"><a class=\"markdownIt-Anchor\" href=\"#准备工具\">#</a> 准备工具</h3>\n<ul>\n<li>树莓派电路板</li>\n<li>8GB 以上的 SD 卡</li>\n<li>读卡器</li>\n<li>USB 转换器（可选）</li>\n</ul>\n<img data-src=\"/N1h1l157/Safe/image-0100000.png\" width=\"660\" alt=\"Image\">\n<h3 id=\"烧录系统至-sd卡\"><a class=\"markdownIt-Anchor\" href=\"#烧录系统至-sd卡\">#</a> 烧录系统至 SD 卡</h3>\n<ul>\n<li>\n<p>下载格式化 SD 卡工具：在<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2RjYXJkLm9yZy9kb3dubG9hZHMvZm9ybWF0dGVyL3NkLW1lbW9yeS1jYXJkLWZvcm1hdHRlci1mb3ItbWFjLWRvd25sb2FkLw==\">此链接中下载格式化 SD 卡的工具</span>，安装工具</p>\n</li>\n<li>\n<p>下载镜像：在<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFzcGJlcnJ5cGkuY29tL3NvZnR3YXJlL29wZXJhdGluZy1zeXN0ZW1zLyNyYXNwYmVycnktcGktb3MtMzItYml0\">此位置下载</span>并解压，我选择的是 2023-05-03-raspios-buster-armhf-lite.img.xz</p>\n</li>\n<li>\n<p>下载镜像烧录工具：在<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFzcGJlcnJ5cGkuY29tL3NvZnR3YXJlLw==\">此位置下载</span>，安装工具</p>\n</li>\n<li>\n<p>下载的工具截图如下图所示。</p>\n</li>\n</ul>\n<img data-src=\"/N1h1l157/Safe/image-0100015.png\" width=\"700\" alt=\"Image\">\n<p>将 SD 卡插入到读卡器，读卡器通过 USB 转换器连接至电脑。运行 SDCardFormatterv5_Mac，先对 SD 卡进行格式化。</p>\n<img data-src=\"/N1h1l157/Safe/image-0100016.png\" width=\"400\" alt=\"Image\">\n<img data-src=\"/N1h1l157/Safe/image-0100017.png\" width=\"400\" alt=\"Image\">\n<p>格式化成功之后，打开烧录系统的 imager 工具。</p>\n<img data-src=\"/N1h1l157/Safe/image-0100018.png\" width=\"520\" alt=\"Image\">\n<p>选择操作系统为刚刚下载好的 img.xz 解压后的 img，选择储存卡为 SD 卡。</p>\n<img data-src=\"/N1h1l157/Safe/image-0100001.png\" width=\"520\" alt=\"Image\">\n<p>在设置中修改主机名，开启 SSH 服务，wifi 密码，用户名密码，时区等。</p>\n<img data-src=\"/N1h1l157/Safe/image-0100002.png\" width=\"520\" alt=\"Image\">\n<p>设置成功后烧录镜像，烧录之后会自动验证。</p>\n<img data-src=\"/N1h1l157/Safe/image-0100003.png\" width=\"520\" alt=\"Image\">\n<p>提示安装成功之后，就可以将 SD 卡拔出，插入到树莓派电路板中了。</p>\n<img data-src=\"/N1h1l157/Safe/image-0100004.png\" width=\"520\" alt=\"Image\">\n<h3 id=\"ssh-连接至树莓派\"><a class=\"markdownIt-Anchor\" href=\"#ssh-连接至树莓派\">#</a> ssh 连接至树莓派</h3>\n<p>树莓派插上电源，绿灯闪烁时表示系统正常写入。等待写入成功后，搜查树莓派 ip 地址。</p>\n<p>可以通过路由器后台查看当前的联网设备有哪些，找到树莓派的 ip。</p>\n<img data-src=\"/N1h1l157/Safe/image-0100005.png\" width=\"660\" alt=\"Image\">\n<p>或者通过烧录镜像时设置的域名直接进行连接。</p>\n<img data-src=\"/N1h1l157/Safe/image-0100006.png\" width=\"660\" alt=\"Image\">\n<h3 id=\"本地化信息修改\"><a class=\"markdownIt-Anchor\" href=\"#本地化信息修改\">#</a> 本地化信息修改</h3>\n<p>默认登录后会出现 <code>-bash: warning: setlocale: LC_ALL: cannot change locale (en_US.UTF-8)</code>  的问题</p>\n<p>先将 apt-get 的源更新到最新<br>\n <code>sudo apt-get update</code> <br>\n <code>sudo apt-get upgrade</code></p>\n<img data-src=\"/N1h1l157/Safe/image-0100007.png\" width=\"700\" alt=\"Image\">\n<p>使用以下命令更新本地化<br>\n <code>sudo apt-get install locales</code> <br>\n <code>sudo dpkg-reconfigure locales</code></p>\n<img data-src=\"/N1h1l157/Safe/image-0100008.png\" width=\"660\" alt=\"Image\">\n<p>如果更新本地化信息没有解决问题，可以尝试手动设置本地化。使用以下命令：<br>\n <code>sudo nano /etc/locale.gen</code></p>\n<img data-src=\"/N1h1l157/Safe/image-0100019.png\" width=\"660\" alt=\"Image\">\n<p>在打开的文件中，将需要的本地化信息（例如 en_US.UTF-8 UTF-8）取消注释，然后保存文件并退出。</p>\n<p>接下来，运行以下命令以使更改生效：这将设置所需的本地化并解决警告信息。<br>\n <code>sudo locale-gen</code> <br>\n <code>sudo update-locale LANG=en_US.UTF-8</code></p>\n<img data-src=\"/N1h1l157/Safe/image-0100009.png\" width=\"700\" alt=\"Image\">\n<p>再次 ssh 进入树莓派，则不会收到 locale 告警信息了。</p>\n<img data-src=\"/N1h1l157/Safe/image-0100010.png\" width=\"700\" alt=\"Image\">\n<h3 id=\"设置多个-wifi-密码\"><a class=\"markdownIt-Anchor\" href=\"#设置多个-wifi-密码\">#</a> 设置多个 wifi 密码</h3>\n<p>假如我们换了一个新的 wifi 环境，如果没有配置多个 wifi 密码的能力，我们只能重置 os 重新烧录。可以通过相关的命令多设置一个 wifi 为我们的流量密码。</p>\n<p>需要指定设备的使用国。<br>\n <code>sudo raspi-config</code></p>\n<p>从菜单中选择本地化选项项目.</p>\n<img data-src=\"/N1h1l157/Safe/image-0100020.png\" width=\"660\" alt=\"Image\">\n<p>然后更改无线国家选项。</p>\n<img data-src=\"/N1h1l157/Safe/image-0100011.png\" width=\"660\" alt=\"Image\">\n<p>选择 &quot; 更改无线国家 / 地区选项。</p>\n<img data-src=\"/N1h1l157/Safe/image-0100021.png\" width=\"660\" alt=\"Image\">\n<img data-src=\"/N1h1l157/Safe/image-0100012.png\" width=\"660\" alt=\"Image\">\n<p>按 ESC 返回到命令行。</p>\n<p>接下来就是生成 psk</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">生成 psk</span></span><br><span class=\"line\">wpa_passphrase &quot;413&quot; &quot;shipeidong123&quot;</span><br><span class=\"line\">wpa_passphrase &quot;n1h1l157&quot; &quot;chentuo0&quot;</span><br></pre></td></tr></table></figure>\n<img data-src=\"/N1h1l157/Safe/image-0100013.png\" width=\"660\" alt=\"Image\">\n<p>将生成的以 ASCII 码显示的 psk 复制下来，修改 wifi 信息，保存退出。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">修改默认的网络配置及优先级</span></span><br><span class=\"line\">sudo nano /etc/wpa_supplicant/wpa_supplicant.conf</span><br></pre></td></tr></table></figure>\n<img data-src=\"/N1h1l157/Safe/image-0100022.png\" width=\"660\" alt=\"Image\">\n<p>重启树莓派（reboot 或者电源重启）后，优先级较高的 wifi 将会自动连接，可以通过将手机热点打开，让电脑和树莓派在同一局域网内登录。</p>\n<img data-src=\"/N1h1l157/Safe/image-0100014.png\" width=\"660\" alt=\"Image\">\n<p>当关闭热点后，树莓派又会重新连接到 wifi 上。</p>\n<img data-src=\"/N1h1l157/Safe/image-0100023.png\" width=\"660\" alt=\"Image\">\n<h3 id=\"移除登录的日志\"><a class=\"markdownIt-Anchor\" href=\"#移除登录的日志\">#</a> 移除登录的日志</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">ssh登录消息配置</span></span><br><span class=\"line\">sudo nano /etc/ssh/sshd_config</span><br><span class=\"line\">PrintLastLog yes</span><br><span class=\"line\">Banner none</span><br></pre></td></tr></table></figure>\n<img data-src=\"/N1h1l157/Safe/image-0100024.png\" width=\"660\" alt=\"Image\">\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 重启ssh</span><br><span class=\"line\">sudo service sshd restart</span><br><span class=\"line\"></span><br><span class=\"line\"># motd 信息</span><br><span class=\"line\">sudo rm /etc/motd</span><br></pre></td></tr></table></figure>\n<img data-src=\"/N1h1l157/Safe/image-0100025.png\" width=\"660\" alt=\"Image\">\n<h3 id=\"ssh免密登录树莓派\"><a class=\"markdownIt-Anchor\" href=\"#ssh免密登录树莓派\">#</a> ssh 免密登录树莓派</h3>\n<ul>\n<li>服务端设置</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">生成 ssh 密钥对</span></span><br><span class=\"line\">ssh-keygen -t rsa</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">修改 ssh 配置文件</span></span><br><span class=\"line\">sudo nano /etc/ssh/sshd_config</span><br><span class=\"line\">PermitRootLogin yes</span><br><span class=\"line\">PubkeyAuthentication yes</span><br><span class=\"line\">AuthorizedKeysFile\t.ssh/authorized_keys .ssh/authorized_keys2</span><br><span class=\"line\">PermitEmptyPasswords no</span><br></pre></td></tr></table></figure>\n<img data-src=\"/N1h1l157/Safe/image-0100026.png\" width=\"660\" alt=\"Image\">\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">重启 ssh 并将公钥导入</span> </span><br><span class=\"line\">service sshd restart</span><br><span class=\"line\">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">检验服务端是否免密成功</span></span><br><span class=\"line\">ssh localhost -i ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure>\n<img data-src=\"/N1h1l157/Safe/image-0100027.png\" width=\"660\" alt=\"Image\">\n<ul>\n<li>客户端设置</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 获取私钥文件</span><br><span class=\"line\">scp chentuo@raspios.local:/home/chentuo/.ssh/id_rsa ~/.ssh/n1h1l157/pi</span><br><span class=\"line\"></span><br><span class=\"line\"># 修改 ssh 别名</span><br><span class=\"line\">sudo vim ~/.ssh/config</span><br><span class=\"line\">Host raspios.local</span><br><span class=\"line\">Hostname 192.168.31.47</span><br><span class=\"line\">User chentuo</span><br><span class=\"line\">Port 22</span><br><span class=\"line\">IdentityFile ~/.ssh/n1h1l157/pi</span><br></pre></td></tr></table></figure>\n<img data-src=\"/N1h1l157/Safe/image-0100028.png\" width=\"660\" alt=\"Image\">\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 免密登录</span><br><span class=\"line\">ssh raspios.local</span><br></pre></td></tr></table></figure>\n<img data-src=\"/N1h1l157/Safe/image-0100029.png\" width=\"660\" alt=\"Image\">\n<h3 id=\"frp-内网穿透\"><a class=\"markdownIt-Anchor\" href=\"#frp-内网穿透\">#</a> frp 内网穿透</h3>\n<p>服务端设置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">下载 frp</span></span><br><span class=\"line\">wget https://github.com/fatedier/frp/releases/download/v0.51.2/frp_0.51.2_linux_amd64.tar.gz</span><br><span class=\"line\">tar -zxvf frp_0.51.2_linux_amd64.tar.gz</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">配置文件</span></span><br><span class=\"line\">[common]</span><br><span class=\"line\">bind_addr = 0.0.0.0</span><br><span class=\"line\">bind_port = 2223</span><br><span class=\"line\">token = n1h1l157</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">启动</span></span><br><span class=\"line\">nohup ./frps -c ./frps.ini &amp;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">检验</span></span><br><span class=\"line\">ps -ef | grep frp</span><br></pre></td></tr></table></figure>\n<img data-src=\"/N1h1l157/Safe/image-0100030.png\" width=\"700\" alt=\"Image\">\n<p>客户端设置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">下载 frp</span></span><br><span class=\"line\">wget https://github.com/fatedier/frp/releases/download/v0.51.2/frp_0.51.2_linux_arm.tar.gz</span><br><span class=\"line\">tar -zxvf frp_0.51.2_linux_arm.tar.gz</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">配置文件</span></span><br><span class=\"line\">[common]</span><br><span class=\"line\">server_addr = 47.102.120.55</span><br><span class=\"line\">server_port = 2223</span><br><span class=\"line\">token = n1h1l157</span><br><span class=\"line\"></span><br><span class=\"line\">[ssh]</span><br><span class=\"line\">type = tcp</span><br><span class=\"line\">local_ip = 127.0.0.1</span><br><span class=\"line\">local_port = 22</span><br><span class=\"line\">remote_port = 2224</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">启动</span></span><br><span class=\"line\">nohup ./frpc -c ./frpc.ini &amp;</span><br></pre></td></tr></table></figure>\n<img data-src=\"/N1h1l157/Safe/image-0100031.png\" width=\"700\" alt=\"Image\">\n<p>本地远程连接树莓派<br>\n <code>ssh -p 2224 chentuo@47.102.102.55 -i ~/.ssh/n1h1l157/pi</code></p>\n<p><strong>就到这里</strong></p>\n",
            "tags": [
                "树莓派"
            ]
        }
    ]
}